<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buyzo Cart - Admin Panel</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #64748b;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --light: #f8fafc;
      --dark: #0f172a;
      --sidebar-width: 250px;
      --header-height: 70px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: #f1f5f9;
      color: #334155;
      display: flex;
      min-height: 100vh;
    }

    /* Login Styles */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      width: 100%;
    }

    .login-card {
      background: white;
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
      width: 100%;
      max-width: 400px;
      animation: fadeIn 0.5s ease;
    }

    .login-logo {
      text-align: center;
      margin-bottom: 32px;
    }

    .login-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--dark);
    }

    .login-subtitle {
      color: var(--secondary);
      margin-bottom: 24px;
    }

    /* Sidebar Styles */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--dark);
      color: white;
      height: 100vh;
      position: fixed;
      transition: all 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid #334155;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sidebar-header h2 {
      font-size: 1.5rem;
    }

    .sidebar-menu {
      padding: 15px 0;
      list-style: none;
    }

    .menu-item {
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      border-left: 3px solid transparent;
      text-decoration: none;
      color: #94a3b8;
    }

    .menu-item:hover {
      background-color: #1e293b;
      color: white;
    }

    .menu-item.active {
      background-color: #1e293b;
      border-left-color: var(--primary);
      color: white;
    }

    .menu-item i {
      width: 20px;
      text-align: center;
    }

    .sidebar-close {
      display: none;
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 24px;
      color: #94a3b8;
      cursor: pointer;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      transition: all 0.3s ease;
    }

    /* Header */
    .header {
      height: var(--header-height);
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 30px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .menu-toggle {
      display: none;
      background: var(--primary);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
    }

    .header-left h1 {
      font-size: 1.8rem;
      color: var(--dark);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    /* Content Area */
    .content {
      padding: 30px;
    }

    /* Dashboard Stats */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      display: flex;
      align-items: center;
      gap: 15px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
    }

    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: white;
    }

    .stat-info h3 {
      font-size: 1.8rem;
      margin-bottom: 5px;
    }

    .stat-info p {
      color: var(--secondary);
      font-size: 0.9rem;
    }

    /* Earnings Section */
    .earnings-section {
      margin-bottom: 24px;
    }

    .earnings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .earnings-title {
      font-size: 18px;
      font-weight: 600;
    }

    .earnings-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
    }

    .earnings-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .earnings-value {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .earnings-label {
      color: var(--secondary);
      font-size: 14px;
      margin-bottom: 12px;
    }

    .earnings-comparison {
      display: flex;
      align-items: center;
      font-size: 14px;
    }

    .earnings-trend {
      display: flex;
      align-items: center;
      margin-right: 8px;
    }

    .trend-up {
      color: var(--success);
    }

    .trend-down {
      color: var(--danger);
    }

    /* Tables */
    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      margin-bottom: 30px;
      overflow: hidden;
    }

    .card-header {
      padding: 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-header h2 {
      font-size: 1.3rem;
    }

    .card-body {
      padding: 20px;
    }

    .table-responsive {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }

    th {
      background-color: #f8fafc;
      font-weight: 600;
      color: var(--dark);
    }

    tr:hover {
      background-color: #f8fafc;
    }

    /* Product Image in Table */
    .product-image {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 4px;
      border: 1px solid #e2e8f0;
    }

    /* Buttons */
    .btn {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: all 0.2s ease;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-warning {
      background: var(--warning);
      color: white;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 0.85rem;
    }

    /* Forms */
    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .form-control {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.2s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .form-row {
      display: flex;
      gap: 15px;
    }

    .form-row .form-group {
      flex: 1;
    }

    /* Currency Input */
    .currency-input {
      position: relative;
    }

    .currency-symbol {
      position: absolute;
      left: 12px;
      top: 10px;
      color: var(--secondary);
      font-weight: 500;
    }

    .currency-input .form-control {
      padding-left: 30px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      padding: 20px;
      border-top: 1px solid #e2e8f0;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--secondary);
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid #e2e8f0;
      margin-bottom: 20px;
    }

    .tab {
      padding: 12px 20px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease;
    }

    .tab.active {
      border-bottom-color: var(--primary);
      color: var(--primary);
      font-weight: 500;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Status Badges */
    .badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge-success {
      background: #dcfce7;
      color: #166534;
    }

    .badge-warning {
      background: #fef3c7;
      color: #92400e;
    }

    .badge-danger {
      background: #fee2e2;
      color: #991b1b;
    }

    .badge-info {
      background: #dbeafe;
      color: #1e40af;
    }

    /* Image Preview */
    .image-preview {
      width: 100px;
      height: 100px;
      border: 1px dashed #d1d5db;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      margin-top: 10px;
    }

    .image-preview img {
      max-width: 100%;
      max-height: 100%;
    }

    /* Search and Filters */
    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .search-box input {
      flex: 1;
    }

    /* Alert Messages */
    .alert {
      padding: 12px 15px;
      border-radius: 6px;
      margin-bottom: 20px;
    }

    .alert-success {
      background: #dcfce7;
      color: #166534;
      border: 1px solid #bbf7d0;
    }

    .alert-error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fecaca;
    }

    /* Bulk Actions */
    .bulk-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      gap: 5px;
    }

    .page-item {
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      cursor: pointer;
    }

    .page-item.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* Multiple Image Upload */
    .image-upload-container {
      border: 1px dashed #d1d5db;
      border-radius: 6px;
      padding: 15px;
      margin-top: 10px;
    }

    .image-preview-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .image-preview-item {
      position: relative;
      width: 80px;
      height: 80px;
    }

    .image-preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 4px;
      border: 1px solid #e2e8f0;
    }

    .image-preview-item .remove-image {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      cursor: pointer;
      border: none;
    }

    /* Checkbox */
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 15px;
    }

    .checkbox-group input {
      width: auto;
    }

    /* Similar Products Styles */
    .selected-similar-products {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
      padding: 10px;
      border: 1px dashed #d1d5db;
      border-radius: 6px;
      min-height: 60px;
    }

    .similar-product-chip {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #e0f2fe;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
    }

    .similar-product-chip img {
      width: 30px;
      height: 30px;
      border-radius: 4px;
      object-fit: cover;
    }

    .similar-product-chip .remove-chip {
      background: none;
      border: none;
      color: #64748b;
      cursor: pointer;
      font-size: 16px;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .similar-product-chip .remove-chip:hover {
      color: #ef4444;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
        width: 280px;
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .menu-toggle {
        display: flex;
      }
      
      .sidebar-close {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .header {
        padding: 0 15px;
      }

      .content {
        padding: 15px;
      }

      .stats-container {
        grid-template-columns: 1fr;
      }

      .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .earnings-cards {
        grid-template-columns: 1fr;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.5s ease;
    }
  </style>
</head>
<body>
  <!-- Admin Login Page -->
  <div id="adminLoginPage" class="login-container">
    <div class="login-card">
      <div class="login-logo">
        <h1 class="login-title">Buyzo Cart</h1>
        <p class="login-subtitle">Admin Panel Login</p>
      </div>
      
      <div class="form-group">
        <label for="adminEmail">Email</label>
        <input type="email" id="adminEmail" placeholder="admin@example.com" class="form-control">
      </div>
      
      <div class="form-group">
        <label for="adminPassword">Password</label>
        <input type="password" id="adminPassword" placeholder="Enter your password" class="form-control">
      </div>
      
      <button class="btn btn-primary" style="width: 100%" onclick="adminLogin()">Login</button>
    </div>
  </div>

  <!-- Admin Panel (initially hidden) -->
  <div id="adminPanel" style="display: none">
    <!-- Sidebar -->
    <div class="sidebar" id="adminSidebar">
      <div class="sidebar-header">
        <i class="fas fa-shopping-cart"></i>
        <h2>Buyzo Admin</h2>
        <button class="sidebar-close" onclick="toggleSidebar()">&times;</button>
      </div>
      <ul class="sidebar-menu">
        <li><a href="#" class="menu-item active" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li>
        <li><a href="#" class="menu-item" data-tab="products"><i class="fas fa-box"></i><span>Products</span></a></li>
        <li><a href="#" class="menu-item" data-tab="categories"><i class="fas fa-tags"></i><span>Categories</span></a></li>
        <li><a href="#" class="menu-item" data-tab="orders"><i class="fas fa-shopping-bag"></i><span>Orders</span></a></li>
        <li><a href="#" class="menu-item" data-tab="trending"><i class="fas fa-fire"></i><span>Trending Products</span></a></li>
        <li><a href="#" class="menu-item" data-tab="similar-products"><i class="fas fa-random"></i><span>Similar Products</span></a></li>
        <li><a href="#" class="menu-item" data-tab="customers"><i class="fas fa-users"></i><span>Customers</span></a></li>
        <li><a href="#" class="menu-item" data-tab="banners"><i class="fas fa-image"></i><span>Banners</span></a></li>
        <li><a href="#" class="menu-item" data-tab="policies"><i class="fas fa-file-alt"></i><span>Policies</span></a></li>
        <li><a href="#" class="menu-item" data-tab="settings"><i class="fas fa-cog"></i><span>Settings</span></a></li>
        <li><a href="#" class="menu-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a></li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Header -->
      <div class="header">
        <div class="header-left">
          <button class="menu-toggle" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
          </button>
          <h1 id="adminPageTitle">Dashboard</h1>
        </div>
        <div class="header-right">
          <div class="user-profile">
            <div class="user-avatar">A</div>
            <div>Admin User</div>
          </div>
        </div>
      </div>

      <!-- Content Area -->
      <div class="content">
        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
          <div class="stats-container">
            <div class="stat-card">
              <div class="stat-icon" style="background: var(--primary);">
                <i class="fas fa-box"></i>
              </div>
              <div class="stat-info">
                <h3 id="totalProducts">0</h3>
                <p>Total Products</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background: var(--success);">
                <i class="fas fa-shopping-cart"></i>
              </div>
              <div class="stat-info">
                <h3 id="totalOrders">0</h3>
                <p>Total Orders</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background: var(--warning);">
                <i class="fas fa-clock"></i>
              </div>
              <div class="stat-info">
                <h3 id="pendingOrders">0</h3>
                <p>Pending Orders</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background: var(--danger);">
                <i class="fas fa-fire"></i>
              </div>
              <div class="stat-info">
                <h3 id="trendingProducts">0</h3>
                <p>Trending Products</p>
              </div>
            </div>
          </div>

          <!-- Earnings Section -->
          <div class="earnings-section">
            <div class="earnings-header">
              <h2 class="earnings-title">Revenue & Earnings</h2>
            </div>
            <div class="earnings-cards">
              <div class="earnings-card">
                <div class="earnings-value" id="totalEarnings">₹0</div>
                <div class="earnings-label">Total Earnings</div>
                <div class="earnings-comparison">
                  <span class="earnings-trend" id="totalEarningsTrend">
                    <i class="fas fa-caret-up trend-up"></i>
                    <span>0%</span>
                  </span>
                  <span>vs lifetime</span>
                </div>
              </div>
              
              <div class="earnings-card">
                <div class="earnings-value" id="lastWeekEarnings">₹0</div>
                <div class="earnings-label">Last Week Earnings</div>
                <div class="earnings-comparison">
                  <span class="earnings-trend" id="lastWeekTrend">
                    <i class="fas fa-caret-up trend-up"></i>
                    <span>0%</span>
                  </span>
                  <span>vs previous week</span>
                </div>
              </div>
              
              <div class="earnings-card">
                <div class="earnings-value" id="lastMonthEarnings">₹0</div>
                <div class="earnings-label">Last Month Earnings</div>
                <div class="earnings-comparison">
                  <span class="earnings-trend" id="lastMonthTrend">
                    <i class="fas fa-caret-up trend-up"></i>
                    <span>0%</span>
                  </span>
                  <span>vs previous month</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h2>Recent Orders</h2>
              <button class="btn btn-primary" onclick="showTab('orders')">View All</button>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table id="recentOrdersTable">
                  <thead>
                    <tr>
                      <th>Order ID</th>
                      <th>Customer</th>
                      <th>Product</th>
                      <th>Amount</th>
                      <th>Status</th>
                      <th>Date</th>
                    </tr>
                  </thead>
                  <tbody id="recentOrders">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Products Tab -->
        <div class="tab-content" id="products">
          <div class="card">
            <div class="card-header">
              <h2>Product Management</h2>
              <button class="btn btn-primary" onclick="showAddProductModal()"><i class="fas fa-plus"></i> Add Product</button>
            </div>
            <div class="card-body">
              <div class="search-box">
                <input type="text" class="form-control" id="productSearch" placeholder="Search products...">
                <button class="btn btn-primary" onclick="filterProducts()">Search</button>
              </div>
              <div class="table-responsive">
                <table id="productsTable">
                  <thead>
                    <tr>
                      <th>Image</th>
                      <th>Name</th>
                      <th>Category</th>
                      <th>Price</th>
                      <th>Delivery Charge</th>
                      <th>Stock</th>
                      <th>Trending</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="productsTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
              <div class="pagination" id="productsPagination">
                <!-- Pagination will be generated here -->
              </div>
            </div>
          </div>
        </div>
        
        <!-- Categories Tab -->
        <div class="tab-content" id="categories">
          <div class="card">
            <div class="card-header">
              <h2>Category Management</h2>
              <button class="btn btn-primary" onclick="showAddCategoryModal()"><i class="fas fa-plus"></i> Add Category</button>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table id="categoriesTable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Image</th>
                      <th>Category Name</th>
                      <th>Description</th>
                      <th>Products</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="categoriesTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Orders Tab -->
        <div class="tab-content" id="orders">
          <div class="card">
            <div class="card-header">
              <h2>Order Management</h2>
              <button class="btn btn-primary" onclick="exportOrders()"><i class="fas fa-download"></i> Export</button>
            </div>
            <div class="card-body">
              <div class="search-box">
                <input type="text" class="form-control" id="orderSearch" placeholder="Search orders...">
                <button class="btn btn-primary" onclick="filterOrders()">Search</button>
              </div>
              <div class="table-responsive">
                <table id="ordersTable">
                  <thead>
                    <tr>
                      <th><input type="checkbox" id="selectAllOrders"></th>
                      <th>Order ID</th>
                      <th>Customer</th>
                      <th>Product</th>
                      <th>Amount</th>
                      <th>Status</th>
                      <th>Date</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="ordersTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
              <div style="margin-top: 16px">
                <select id="bulkStatusAction" style="width: auto; margin-right: 12px" class="form-control">
                  <option value="">Bulk Action</option>
                  <option value="Confirmed">Mark as Confirmed</option>
                  <option value="Shipped">Mark as Shipped</option>
                  <option value="Delivered">Mark as Delivered</option>
                  <option value="Cancelled">Mark as Cancelled</option>
                </select>
                <button class="btn btn-primary" onclick="applyBulkAction()">Apply</button>
              </div>
              <div class="pagination" id="ordersPagination">
                <!-- Pagination will be generated here -->
              </div>
            </div>
          </div>
        </div>
        
        <!-- Trending Tab -->
        <div class="tab-content" id="trending">
          <div class="card">
            <div class="card-header">
              <h2>Trending Products Control</h2>
            </div>
            <div class="card-body">
              <p style="margin-bottom: 16px">Select products to feature in the "Trending Now" section on the website.</p>
              <div class="table-responsive">
                <table id="trendingTable">
                  <thead>
                    <tr>
                      <th>Image</th>
                      <th>Name</th>
                      <th>Price</th>
                      <th>Trending</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="trendingTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Similar Products Tab (NEW ADDITION) -->
        <div class="tab-content" id="similar-products">
          <div class="card">
            <div class="card-header">
              <h2>Similar Products Management</h2>
              <button class="btn btn-primary" onclick="showAddSimilarProductsModal()">
                <i class="fas fa-plus"></i> Link Similar Products
              </button>
            </div>
            <div class="card-body">
              <div class="search-box">
                <input type="text" class="form-control" id="similarProductsSearch" placeholder="Search main product...">
                <button class="btn btn-primary" onclick="filterSimilarProducts()">Search</button>
              </div>
              <div class="table-responsive">
                <table id="similarProductsTable">
                  <thead>
                    <tr>
                      <th>Main Product</th>
                      <th>Main Product Image</th>
                      <th>Similar Products Count</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="similarProductsTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
              <div class="pagination" id="similarProductsPagination">
                <!-- Pagination will be generated here -->
              </div>
            </div>
          </div>
        </div>
        
        <!-- Customers Tab -->
        <div class="tab-content" id="customers">
          <div class="card">
            <div class="card-header">
              <h2>Customer Data</h2>
              <button class="btn btn-primary" onclick="exportCustomers()"><i class="fas fa-download"></i> Export CSV</button>
            </div>
            <div class="card-body">
              <div class="search-box">
                <input type="text" class="form-control" id="customerSearch" placeholder="Search customers...">
                <button class="btn btn-primary" onclick="filterCustomers()">Search</button>
              </div>
              <div class="table-responsive">
                <table id="customersTable">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Mobile</th>
                      <th>Email</th>
                      <th>Location</th>
                      <th>Orders</th>
                      <th>Last Order</th>
                    </tr>
                  </thead>
                  <tbody id="customersTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
              <div class="pagination" id="customersPagination">
                <!-- Pagination will be generated here -->
              </div>
            </div>
          </div>
        </div>
        
        <!-- Banners Tab -->
        <div class="tab-content" id="banners">
          <div class="card">
            <div class="card-header">
              <h2>Banner Management</h2>
              <button class="btn btn-primary" onclick="showAddBannerModal()"><i class="fas fa-plus"></i> Add Banner</button>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table id="bannersTable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Banner Image</th>
                      <th>Title</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="bannersTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Policies Tab -->
        <div class="tab-content" id="policies">
          <div class="card">
            <div class="card-header">
              <h2>Store Policies</h2>
            </div>
            <div class="card-body">
              <div class="tabs">
                <div class="tab active" data-policy="about">About Us</div>
                <div class="tab" data-policy="refund">Refund Policy</div>
                <div class="tab" data-policy="terms">Terms & Conditions</div>
                <div class="tab" data-policy="shipping">Shipping Policy</div>
                <div class="tab" data-policy="privacy">Privacy Policy</div>
              </div>
              
              <div class="policy-content active" data-policy="about">
                <h3>About Us Page Content</h3>
                <textarea id="aboutContent" rows="10" style="width: 100%; margin-top: 16px" class="form-control"></textarea>
                <button class="btn btn-primary" style="margin-top: 16px" onclick="savePolicy('about')">Save Changes</button>
              </div>
              
              <div class="policy-content" data-policy="refund">
                <h3>Refund Policy Content</h3>
                <textarea id="refundContent" rows="10" style="width: 100%; margin-top: 16px" class="form-control"></textarea>
                <button class="btn btn-primary" style="margin-top: 16px" onclick="savePolicy('refund')">Save Changes</button>
              </div>
              
              <div class="policy-content" data-policy="terms">
                <h3>Terms & Conditions Content</h3>
                <textarea id="termsContent" rows="10" style="width: 100%; margin-top: 16px" class="form-control"></textarea>
                <button class="btn btn-primary" style="margin-top: 16px" onclick="savePolicy('terms')">Save Changes</button>
              </div>
              
              <div class="policy-content" data-policy="shipping">
                <h3>Shipping Policy Content</h3>
                <textarea id="shippingContent" rows="10" style="width: 100%; margin-top: 16px" class="form-control"></textarea>
                <button class="btn btn-primary" style="margin-top: 16px" onclick="savePolicy('shipping')">Save Changes</button>
              </div>
              
              <div class="policy-content" data-policy="privacy">
                <h3>Privacy Policy Content</h3>
                <textarea id="privacyContent" rows="10" style="width: 100%; margin-top: 16px" class="form-control"></textarea>
                <button class="btn btn-primary" style="margin-top: 16px" onclick="savePolicy('privacy')">Save Changes</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
          <div class="card">
            <div class="card-header">
              <h2>Store Settings</h2>
            </div>
            <div class="card-body">
              <form id="settingsForm">
                <div class="form-group">
                  <label for="storeName">Store Name</label>
                  <input type="text" id="storeName" class="form-control" value="Buyzo Cart">
                </div>
                
                <div class="form-group">
                  <label for="storeEmail">Store Email</label>
                  <input type="email" id="storeEmail" class="form-control" value="buyzocartshop@gmail.com">
                </div>
                
                <div class="form-group">
                  <label for="storePhone">Store Phone</label>
                  <input type="text" id="storePhone" class="form-control" value="+91 9876543210">
                </div>
                
                <div class="form-group">
                  <label for="storeAddress">Store Address</label>
                  <textarea id="storeAddress" class="form-control" rows="3">Jwalapur, Haridwar, Uttarakhand - 249401, India</textarea>
                </div>
                
                <div class="form-group">
                  <label for="shippingCost">Default Shipping Cost (₹)</label>
                  <input type="number" id="shippingCost" class="form-control" value="50">
                </div>
                
                <div class="form-group">
                  <label for="currency">Currency</label>
                  <select id="currency" class="form-control">
                    <option>Indian Rupee (₹)</option>
                    <option>US Dollar ($)</option>
                    <option>Euro (€)</option>
                  </select>
                </div>
                
                <button type="submit" class="btn btn-primary">Save Settings</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Product Modal -->
  <div class="modal" id="addProductModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add New Product</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="productName">Product Name</label>
          <input type="text" id="productName" class="form-control" placeholder="Enter product name">
        </div>
        
        <div class="form-group currency-input">
          <label for="productPrice">Price</label>
          <span class="currency-symbol">₹</span>
          <input type="number" id="productPrice" class="form-control" placeholder="Enter price">
        </div>
        
        <div class="form-group currency-input">
          <label for="productDeliveryCharge">Delivery Charge</label>
          <span class="currency-symbol">₹</span>
          <input type="number" id="productDeliveryCharge" class="form-control" placeholder="Enter delivery charge">
        </div>
        
        <div class="form-group">
          <label for="productStock">Stock Quantity</label>
          <input type="number" id="productStock" class="form-control" placeholder="Enter stock quantity">
        </div>
        
        <div class="form-group">
          <label for="productCategory">Category</label>
          <select id="productCategory" class="form-control">
            <option value="">-- Select Category --</option>
            <!-- Categories will be populated by JavaScript -->
          </select>
        </div>
        
        <div class="form-group">
          <label for="productDesc">Short Description</label>
          <input type="text" id="productDesc" class="form-control" placeholder="Enter short description">
        </div>
        
        <div class="form-group">
          <label for="productFullDesc">Full Description</label>
          <textarea id="productFullDesc" class="form-control" placeholder="Enter full description"></textarea>
        </div>
        
        <div class="form-group">
          <label>Sizes (comma separated)</label>
          <input type="text" id="productSizes" class="form-control" placeholder="S, M, L, XL">
        </div>
        
        <div class="form-group">
          <label>Product Images</label>
          <div class="image-upload-container">
            <input type="file" id="productImages" class="form-control" multiple accept="image/*">
            <small class="text-muted">You can select multiple images</small>
            <div class="image-preview-container" id="productImagePreviews">
              <!-- Image previews will be added here -->
            </div>
          </div>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="productTrending">
          <label for="productTrending">Mark as Trending Product</label>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="productStatus" checked>
          <label for="productStatus">Active Product</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary close">Cancel</button>
        <button class="btn btn-primary" onclick="saveProduct()">Save Product</button>
      </div>
    </div>
  </div>

  <!-- Add Category Modal -->
  <div class="modal" id="addCategoryModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add New Category</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="categoryName">Category Name</label>
          <input type="text" id="categoryName" class="form-control" placeholder="Enter category name">
        </div>
        
        <div class="form-group">
          <label for="categoryDescription">Description</label>
          <textarea id="categoryDescription" class="form-control" placeholder="Enter category description"></textarea>
        </div>
        
        <div class="form-group">
          <label for="categoryImage">Category Image</label>
          <input type="file" id="categoryImage" class="form-control">
          <div class="image-preview" id="categoryImagePreview">
            <span>No image selected</span>
          </div>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="categoryStatus" checked>
          <label for="categoryStatus">Active Category</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary close">Cancel</button>
        <button class="btn btn-primary" onclick="saveCategory()">Save Category</button>
      </div>
    </div>
  </div>

  <!-- Add Banner Modal -->
  <div class="modal" id="addBannerModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add New Banner</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="bannerTitle">Banner Title</label>
          <input type="text" id="bannerTitle" class="form-control" placeholder="Enter banner title">
        </div>
        
        <div class="form-group">
          <label for="bannerLink">Banner Link (Optional)</label>
          <input type="url" id="bannerLink" class="form-control" placeholder="https://example.com">
        </div>
        
        <div class="form-group">
          <label for="bannerImage">Banner Image</label>
          <input type="file" id="bannerImage" class="form-control">
          <div class="image-preview" id="bannerImagePreview">
            <span>No image selected</span>
          </div>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="bannerStatus" checked>
          <label for="bannerStatus">Active Banner</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary close">Cancel</button>
        <button class="btn btn-primary" onclick="saveBanner()">Save Banner</button>
      </div>
    </div>
  </div>

  <!-- Add Similar Products Modal (NEW ADDITION) -->
  <div class="modal" id="addSimilarProductsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Link Similar Products</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="mainProductSelect">Select Main Product</label>
          <select id="mainProductSelect" class="form-control" onchange="loadProductDetails(this.value)">
            <option value="">-- Select Product --</option>
            <!-- Options will be populated by JavaScript -->
          </select>
        </div>
        
        <div class="selected-product-info" id="selectedProductInfo" style="display: none; background: #f8fafc; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 15px;">
            <img id="selectedProductImage" src="" width="60" height="60" style="border-radius: 4px; object-fit: cover;">
            <div>
              <h4 id="selectedProductName" style="margin: 0 0 5px 0;"></h4>
              <p id="selectedProductDetails" style="margin: 0; color: #64748b;"></p>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="similarProductsSelect">Select Similar Products</label>
          <div style="margin-bottom: 10px;">
            <input type="text" id="searchSimilarProducts" class="form-control" placeholder="Search products..." onkeyup="searchProductsForSimilar()">
          </div>
          <select id="similarProductsSelect" class="form-control" multiple style="height: 200px;">
            <!-- Options will be populated by JavaScript -->
          </select>
          <small class="text-muted">Hold Ctrl/Cmd to select multiple products</small>
        </div>
        
        <div class="selected-similar-products" id="selectedSimilarProductsPreview">
          <!-- Selected products will be shown here -->
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="autoSuggestSimilar" checked>
          <label for="autoSuggestSimilar">Auto-suggest similar products (by category)</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary close">Cancel</button>
        <button class="btn btn-primary" onclick="saveSimilarProducts()">Save Similar Products</button>
      </div>
    </div>
  </div>

  <!-- Edit Product Modal -->
  <div class="modal" id="editProductModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Product</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editProductId">
        
        <div class="form-group">
          <label for="editProductName">Product Name</label>
          <input type="text" id="editProductName" class="form-control" placeholder="Enter product name">
        </div>
        
        <div class="form-group currency-input">
          <label for="editProductPrice">Price</label>
          <span class="currency-symbol">₹</span>
          <input type="number" id="editProductPrice" class="form-control" placeholder="Enter price">
        </div>
        
        <div class="form-group currency-input">
          <label for="editProductDeliveryCharge">Delivery Charge</label>
          <span class="currency-symbol">₹</span>
          <input type="number" id="editProductDeliveryCharge" class="form-control" placeholder="Enter delivery charge">
        </div>
        
        <div class="form-group">
          <label for="editProductStock">Stock Quantity</label>
          <input type="number" id="editProductStock" class="form-control" placeholder="Enter stock quantity">
        </div>
        
        <div class="form-group">
          <label for="editProductCategory">Category</label>
          <select id="editProductCategory" class="form-control">
            <option value="">-- Select Category --</option>
            <!-- Categories will be populated by JavaScript -->
          </select>
        </div>
        
        <div class="form-group">
          <label for="editProductDesc">Short Description</label>
          <input type="text" id="editProductDesc" class="form-control" placeholder="Enter short description">
        </div>
        
        <div class="form-group">
          <label for="editProductFullDesc">Full Description</label>
          <textarea id="editProductFullDesc" class="form-control" placeholder="Enter full description"></textarea>
        </div>
        
        <div class="form-group">
          <label>Sizes (comma separated)</label>
          <input type="text" id="editProductSizes" class="form-control" placeholder="S, M, L, XL">
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="editProductTrending">
          <label for="editProductTrending">Mark as Trending Product</label>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="editProductStatus">
          <label for="editProductStatus">Active Product</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" onclick="deleteProduct()">Delete Product</button>
        <button class="btn btn-primary" onclick="updateProduct()">Update Product</button>
      </div>
    </div>
  </div>

  <!-- Edit Similar Products Modal (NEW ADDITION) -->
  <div class="modal" id="editSimilarProductsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Similar Products</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editMainProductId">
        
        <div class="selected-product-info" id="editProductInfo" style="background: #f8fafc; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
          <!-- Product info will be loaded here -->
        </div>
        
        <div class="form-group">
          <label for="editSimilarProductsSelect">Similar Products</label>
          <div style="margin-bottom: 10px;">
            <input type="text" id="editSearchSimilarProducts" class="form-control" placeholder="Search products..." onkeyup="editSearchProductsForSimilar()">
          </div>
          <select id="editSimilarProductsSelect" class="form-control" multiple style="height: 200px;">
            <!-- Options will be populated by JavaScript -->
          </select>
          <small class="text-muted">Hold Ctrl/Cmd to select multiple products</small>
        </div>
        
        <div class="selected-similar-products" id="editSelectedSimilarProductsPreview">
          <!-- Selected products will be shown here -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" onclick="deleteSimilarProducts()">Remove All Links</button>
        <button class="btn btn-primary" onclick="updateSimilarProducts()">Update Similar Products</button>
      </div>
    </div>
  </div>

  <script>
    // Firebase Configuration - UPDATED WITH YOUR CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyCHFUx3Y1L3mvyLyDMHVKQE6eXi50_fewE",
      authDomain: "buyzocart.firebaseapp.com",
      databaseURL: "https://buyzocart-default-rtdb.firebaseio.com",
      projectId: "buyzocart",
      storageBucket: "buyzocart.firebasestorage.app",
      messagingSenderId: "640560737762",
      appId: "1:640560737762:web:7fe368df6486d6da759dbb"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Admin State
    let currentAdminTab = 'dashboard';
    let currentProductsPage = 1;
    let currentOrdersPage = 1;
    let currentCustomersPage = 1;
    let currentSimilarProductsPage = 1;
    let productsPerPage = 10;
    let ordersPerPage = 10;
    let customersPerPage = 10;
    let similarProductsPerPage = 10;
    let uploadedImages = [];
    let uploadedCategoryImage = null;
    let uploadedBannerImage = null;
    
    // Global Categories Array
    let allCategories = [];
    
    // Similar Products Variables
    let allProductsForSimilar = [];

    // Initialize admin panel
    function initAdminPanel() {
      // Check if user is logged in
      const isLoggedIn = localStorage.getItem('admin_logged_in') === 'true';
      
      if (isLoggedIn) {
        document.getElementById('adminLoginPage').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadDashboardData();
        loadProducts();
        loadCategories();
        loadOrders();
        loadTrendingProducts();
        loadSimilarProducts();
        loadCustomers();
        loadBanners();
        loadPolicies();
        loadSettings();
        
        // Load categories for dropdown
        loadCategoriesForDropdown();
      } else {
        document.getElementById('adminLoginPage').style.display = 'flex';
        document.getElementById('adminPanel').style.display = 'none';
      }
      
      // Setup tab navigation
      document.querySelectorAll('.menu-item').forEach(tab => {
        tab.addEventListener('click', function(e) {
          e.preventDefault();
          if (this.dataset.tab) {
            showTab(this.dataset.tab);
          }
        });
      });
      
      // Setup policy tabs
      document.querySelectorAll('.tabs .tab').forEach(tab => {
        tab.addEventListener('click', function() {
          const policy = this.dataset.policy;
          showPolicyTab(policy);
        });
      });
      
      // Setup search and filters
      document.getElementById('productSearch').addEventListener('input', filterProducts);
      document.getElementById('orderSearch').addEventListener('input', filterOrders);
      document.getElementById('customerSearch').addEventListener('input', filterCustomers);
      document.getElementById('similarProductsSearch').addEventListener('input', filterSimilarProducts);
      
      // Select all orders checkbox
      document.getElementById('selectAllOrders').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('#ordersTableBody input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
          checkbox.checked = this.checked;
        });
      });

      // Settings form submission
      document.getElementById('settingsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveSettings();
      });

      // Modal Controls
      const modals = document.querySelectorAll('.modal');
      const closeButtons = document.querySelectorAll('.close');
      
      // Close Modals
      closeButtons.forEach(button => {
        button.addEventListener('click', function() {
          modals.forEach(modal => {
            modal.classList.remove('active');
          });
        });
      });
      
      // Close modal when clicking outside
      modals.forEach(modal => {
        modal.addEventListener('click', function(e) {
          if (e.target === this) {
            this.classList.remove('active');
          }
        });
      });

      // Product image upload preview
      document.getElementById('productImages').addEventListener('change', function(e) {
        handleProductImageUpload(e);
      });

      // Category image upload preview
      document.getElementById('categoryImage').addEventListener('change', function(e) {
        handleCategoryImageUpload(e);
      });

      // Banner image upload preview
      document.getElementById('bannerImage').addEventListener('change', function(e) {
        handleBannerImageUpload(e);
      });
      
      // Similar products select change events
      document.getElementById('similarProductsSelect').addEventListener('change', updateSelectedSimilarProductsPreview);
      document.getElementById('editSimilarProductsSelect').addEventListener('change', updateEditSelectedSimilarProductsPreview);
    }

    // Load categories for dropdown
    function loadCategoriesForDropdown() {
      const categoriesRef = database.ref('categories');
      categoriesRef.once('value', snapshot => {
        const categoriesData = snapshot.val();
        if (categoriesData) {
          allCategories = Object.entries(categoriesData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
          
          // Update category dropdowns
          updateCategoryDropdowns();
        }
      }).catch(error => {
        console.error('Error loading categories for dropdown:', error);
      });
    }

    // Update category dropdowns
    function updateCategoryDropdowns() {
      // Update add product modal dropdown
      const addProductCategory = document.getElementById('productCategory');
      if (addProductCategory) {
        // Clear existing options except first one
        const firstOption = addProductCategory.options[0];
        addProductCategory.innerHTML = '';
        if (firstOption) {
          addProductCategory.appendChild(firstOption);
        }
        
        // Add active categories
        allCategories.forEach(category => {
          if (category.status === 'active') {
            const option = document.createElement('option');
            option.value = category.name;
            option.textContent = category.name;
            addProductCategory.appendChild(option);
          }
        });
      }
      
      // Update edit product modal dropdown
      const editProductCategory = document.getElementById('editProductCategory');
      if (editProductCategory) {
        // Clear existing options except first one
        const firstOption = editProductCategory.options[0];
        editProductCategory.innerHTML = '';
        if (firstOption) {
          editProductCategory.appendChild(firstOption);
        }
        
        // Add active categories
        allCategories.forEach(category => {
          if (category.status === 'active') {
            const option = document.createElement('option');
            option.value = category.name;
            option.textContent = category.name;
            editProductCategory.appendChild(option);
          }
        });
      }
    }

    // Admin login function
    function adminLogin() {
      const email = document.getElementById('adminEmail').value;
      const password = document.getElementById('adminPassword').value;
      
      // Simple validation - in a real app, this would call an API
      if (email === 'admin@buyzo.com' && password === 'admin123') {
        localStorage.setItem('admin_logged_in', 'true');
        document.getElementById('adminLoginPage').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadDashboardData();
        loadCategoriesForDropdown();
      } else {
        alert('Invalid credentials. Try admin@buyzo.com / admin123');
      }
    }

    // Logout function
    function logout() {
      localStorage.removeItem('admin_logged_in');
      document.getElementById('adminLoginPage').style.display = 'flex';
      document.getElementById('adminPanel').style.display = 'none';
    }

    // Toggle sidebar on mobile
    function toggleSidebar() {
      document.getElementById('adminSidebar').classList.toggle('active');
    }

    // Show specific tab
    function showTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remove active class from all nav items
      document.querySelectorAll('.menu-item').forEach(nav => {
        nav.classList.remove('active');
      });
      
      // Show selected tab
      document.getElementById(tabName).classList.add('active');
      
      // Set active nav item
      document.querySelector(`.menu-item[data-tab="${tabName}"]`).classList.add('active');
      
      // Update page title
      document.getElementById('adminPageTitle').textContent = 
        tabName.charAt(0).toUpperCase() + tabName.slice(1);
      
      currentAdminTab = tabName;
      
      // Load data if needed
      if (tabName === 'dashboard') {
        loadDashboardData();
      } else if (tabName === 'products') {
        loadProducts();
      } else if (tabName === 'categories') {
        loadCategories();
      } else if (tabName === 'orders') {
        loadOrders();
      } else if (tabName === 'trending') {
        loadTrendingProducts();
      } else if (tabName === 'similar-products') {
        loadSimilarProducts();
      } else if (tabName === 'customers') {
        loadCustomers();
      } else if (tabName === 'banners') {
        loadBanners();
      } else if (tabName === 'policies') {
        loadPolicies();
      } else if (tabName === 'settings') {
        loadSettings();
      }
    }

    // Show policy tab
    function showPolicyTab(policy) {
      // Remove active class from all policy tabs
      document.querySelectorAll('.tabs .tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Hide all policy contents
      document.querySelectorAll('.policy-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Activate selected tab and content
      document.querySelector(`.tab[data-policy="${policy}"]`).classList.add('active');
      document.querySelector(`.policy-content[data-policy="${policy}"]`).classList.add('active');
    }

    // Calculate earnings data
    function calculateEarnings(orders, products) {
      const now = new Date();
      const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
      const twoWeeksAgo = new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000);
      const oneMonthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
      const twoMonthsAgo = new Date(now.getTime() - 60 * 24 * 60 * 60 * 1000);
      
      let totalEarnings = 0;
      let lastWeekEarnings = 0;
      let previousWeekEarnings = 0;
      let lastMonthEarnings = 0;
      let previousMonthEarnings = 0;
      
      orders.forEach(order => {
        const product = products.find(p => p.id === order.productId);
        if (product) {
          const orderValue = product.price * order.qty;
          const orderDate = new Date(order.timestamp);
          
          totalEarnings += orderValue;
          
          // Last week earnings (last 7 days)
          if (orderDate >= oneWeekAgo) {
            lastWeekEarnings += orderValue;
          }
          
          // Previous week earnings (7-14 days ago)
          if (orderDate >= twoWeeksAgo && orderDate < oneWeekAgo) {
            previousWeekEarnings += orderValue;
          }
          
          // Last month earnings (last 30 days)
          if (orderDate >= oneMonthAgo) {
            lastMonthEarnings += orderValue;
          }
          
          // Previous month earnings (30-60 days ago)
          if (orderDate >= twoMonthsAgo && orderDate < oneMonthAgo) {
            previousMonthEarnings += orderValue;
          }
        }
      });
      
      // Calculate trends
      const weeklyTrend = previousWeekEarnings > 0 
        ? ((lastWeekEarnings - previousWeekEarnings) / previousWeekEarnings) * 100 
        : lastWeekEarnings > 0 ? 100 : 0;
        
      const monthlyTrend = previousMonthEarnings > 0 
        ? ((lastMonthEarnings - previousMonthEarnings) / previousMonthEarnings) * 100 
        : lastMonthEarnings > 0 ? 100 : 0;
      
      return {
        totalEarnings,
        lastWeekEarnings,
        lastMonthEarnings,
        weeklyTrend,
        monthlyTrend
      };
    }

    // Load dashboard data
    function loadDashboardData() {
      // Fetch products and orders from Firebase
      const productsRef = database.ref('products');
      const ordersRef = database.ref('orders');
      
      Promise.all([
        new Promise(resolve => productsRef.once('value', snapshot => resolve(snapshot.val()))),
        new Promise(resolve => ordersRef.once('value', snapshot => resolve(snapshot.val())))
      ]).then(([productsData, ordersData]) => {
        let products = [];
        let orders = [];
        
        // Process products data
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
        }
        
        // Process orders data
        if (ordersData) {
          orders = Object.entries(ordersData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
        }
        
        const trendingProducts = products.filter(p => p.trending);
        
        // Update stats
        document.getElementById('totalProducts').textContent = products.length;
        document.getElementById('totalOrders').textContent = orders.length;
        document.getElementById('pendingOrders').textContent = orders.filter(o => o.status === 'Pending').length;
        document.getElementById('trendingProducts').textContent = trendingProducts.length;
        
        // Calculate and update earnings
        const earnings = calculateEarnings(orders, products);
        document.getElementById('totalEarnings').textContent = `₹${earnings.totalEarnings.toLocaleString()}`;
        document.getElementById('lastWeekEarnings').textContent = `₹${earnings.lastWeekEarnings.toLocaleString()}`;
        document.getElementById('lastMonthEarnings').textContent = `₹${earnings.lastMonthEarnings.toLocaleString()}`;
        
        // Update trends
        updateTrendElement('lastWeekTrend', earnings.weeklyTrend);
        updateTrendElement('lastMonthTrend', earnings.monthlyTrend);
        
        // Load recent orders
        const recentOrders = orders.slice(-5).reverse();
        const recentOrdersHtml = recentOrders.map(order => {
          const product = products.find(p => p.id === order.productId);
          return `
            <tr>
              <td>#${order.id || 'N/A'}</td>
              <td>${order.fullname}</td>
              <td>${product ? product.title : 'Unknown Product'}</td>
              <td>₹${product ? product.price * order.qty : 'N/A'}</td>
              <td><span class="badge ${getStatusBadgeClass(order.status)}">${order.status || 'Pending'}</span></td>
              <td>${new Date(order.timestamp).toLocaleDateString()}</td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('recentOrders').innerHTML = recentOrdersHtml || '<tr><td colspan="6" style="text-align: center">No orders found</td></tr>';
      }).catch(error => {
        console.error('Error loading dashboard data:', error);
        alert('Error loading dashboard data. Please check console for details.');
      });
    }

    // Update trend element with appropriate icon and color
    function updateTrendElement(elementId, trendValue) {
      const element = document.getElementById(elementId);
      const valueElement = element.querySelector('span:last-child');
      const iconElement = element.querySelector('i');
      
      valueElement.textContent = `${Math.abs(trendValue).toFixed(1)}%`;
      
      if (trendValue >= 0) {
        element.className = 'earnings-trend';
        iconElement.className = 'fas fa-caret-up trend-up';
      } else {
        element.className = 'earnings-trend';
        iconElement.className = 'fas fa-caret-down trend-down';
      }
    }

    // Get status badge class
    function getStatusBadgeClass(status) {
      switch(status) {
        case 'Delivered': return 'badge-success';
        case 'Shipped': return 'badge-info';
        case 'Confirmed': return 'badge-info';
        case 'Cancelled': return 'badge-danger';
        default: return 'badge-warning';
      }
    }

    // Load products
    function loadProducts() {
      const productsRef = database.ref('products');
      productsRef.once('value', snapshot => {
        const productsData = snapshot.val();
        let products = [];
        
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
        }
        
        const filteredProducts = filterProductsList(products);
        const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
        
        // Update pagination
        updatePagination('productsPagination', currentProductsPage, totalPages, 'products');
        
        // Get products for current page
        const startIndex = (currentProductsPage - 1) * productsPerPage;
        const paginatedProducts = filteredProducts.slice(startIndex, startIndex + productsPerPage);
        
        // Render products table
        const productsHtml = paginatedProducts.map(product => {
          const images = product.images || [];
          const mainImage = images.length > 0 ? images[0] : '';
          
          return `
            <tr>
              <td><img src="${mainImage}" width="50" height="50" class="product-image"></td>
              <td>${product.title || 'No Name'}</td>
              <td>${product.category || 'Uncategorized'}</td>
              <td>₹${product.price || 0}</td>
              <td>₹${product.deliveryCharge || 0}</td>
              <td>${product.stock || 0}</td>
              <td>${product.trending ? '<span class="badge badge-success">Yes</span>' : '<span class="badge badge-warning">No</span>'}</td>
              <td>${product.status === 'active' ? '<span class="badge badge-success">Active</span>' : '<span class="badge badge-danger">Inactive</span>'}</td>
              <td>
                <div style="display: flex; gap: 8px;">
                  <button class="btn btn-primary btn-sm" onclick="editProduct('${product.id}')"><i class="fas fa-edit"></i></button>
                  <button class="btn btn-danger btn-sm" onclick="deleteProductConfirm('${product.id}')"><i class="fas fa-trash"></i></button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('productsTableBody').innerHTML = productsHtml || '<tr><td colspan="9" style="text-align: center">No products found</td></tr>';
      }).catch(error => {
        console.error('Error loading products:', error);
        document.getElementById('productsTableBody').innerHTML = '<tr><td colspan="9" style="text-align: center; color: red;">Error loading products</td></tr>';
      });
    }

    // Filter products list
    function filterProductsList(products) {
      const searchTerm = document.getElementById('productSearch').value.toLowerCase();
      
      return products.filter(product => {
        const matchesSearch = (product.title || '').toLowerCase().includes(searchTerm) || 
                             (product.desc || '').toLowerCase().includes(searchTerm);
        
        return matchesSearch;
      });
    }

    // Filter products
    function filterProducts() {
      currentProductsPage = 1;
      loadProducts();
    }

    // Load categories
    function loadCategories() {
      const categoriesRef = database.ref('categories');
      categoriesRef.once('value', snapshot => {
        const categoriesData = snapshot.val();
        let categories = [];
        
        if (categoriesData) {
          categories = Object.entries(categoriesData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
        }
        
        // Update global categories array
        allCategories = categories;
        
        // Update dropdowns
        updateCategoryDropdowns();
        
        // Render categories table
        const categoriesHtml = categories.map(category => {
          return `
            <tr>
              <td>#${category.id}</td>
              <td>
                ${category.image ? 
                  `<img src="${category.image}" width="50" height="50" class="product-image">` : 
                  '<div class="product-image" style="background: #f1f5f9; display: flex; align-items: center; justify-content: center; color: #94a3b8;"><i class="fas fa-image"></i></div>'
                }
              </td>
              <td>${category.name || 'No Name'}</td>
              <td>${category.description || 'No description'}</td>
              <td>${category.productCount || 0}</td>
              <td>${category.status === 'active' ? '<span class="badge badge-success">Active</span>' : '<span class="badge badge-danger">Inactive</span>'}</td>
              <td>
                <div style="display: flex; gap: 8px;">
                  <button class="btn btn-primary btn-sm" onclick="editCategory('${category.id}')"><i class="fas fa-edit"></i></button>
                  <button class="btn btn-danger btn-sm" onclick="deleteCategoryConfirm('${category.id}')"><i class="fas fa-trash"></i></button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('categoriesTableBody').innerHTML = categoriesHtml || '<tr><td colspan="7" style="text-align: center">No categories found</td></tr>';
      }).catch(error => {
        console.error('Error loading categories:', error);
      });
    }

    // Load orders
    function loadOrders() {
      const ordersRef = database.ref('orders');
      const productsRef = database.ref('products');
      
      Promise.all([
        new Promise(resolve => ordersRef.once('value', snapshot => resolve(snapshot.val()))),
        new Promise(resolve => productsRef.once('value', snapshot => resolve(snapshot.val())))
      ]).then(([ordersData, productsData]) => {
        let orders = [];
        let products = [];
        
        // Process orders data
        if (ordersData) {
          orders = Object.entries(ordersData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
        }
        
        // Process products data
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
        }
        
        const filteredOrders = filterOrdersList(orders, products);
        const totalPages = Math.ceil(filteredOrders.length / ordersPerPage);
        
        // Update pagination
        updatePagination('ordersPagination', currentOrdersPage, totalPages, 'orders');
        
        // Get orders for current page
        const startIndex = (currentOrdersPage - 1) * ordersPerPage;
        const paginatedOrders = filteredOrders.slice(startIndex, startIndex + ordersPerPage);
        
        // Render orders table
        const ordersHtml = paginatedOrders.map(order => {
          const product = products.find(p => p.id === order.productId);
          return `
            <tr>
              <td><input type="checkbox" value="${order.id}"></td>
              <td>#${order.id || 'N/A'}</td>
              <td>${order.fullname || 'N/A'}<br><small>${order.mobile || 'N/A'}</small></td>
              <td>${product ? product.title : 'Unknown Product'} (x${order.qty || 1})</td>
              <td>₹${product ? product.price * (order.qty || 1) : 'N/A'}</td>
              <td>
                <select onchange="updateOrderStatus('${order.id}', this.value)" class="form-control">
                  <option value="Pending" ${order.status === 'Pending' ? 'selected' : ''}>Pending</option>
                  <option value="Confirmed" ${order.status === 'Confirmed' ? 'selected' : ''}>Confirmed</option>
                  <option value="Shipped" ${order.status === 'Shipped' ? 'selected' : ''}>Shipped</option>
                  <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                  <option value="Cancelled" ${order.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                </select>
              </td>
              <td>${order.timestamp ? new Date(order.timestamp).toLocaleDateString() : 'N/A'}</td>
              <td>
                <button class="btn btn-primary btn-sm" onclick="viewOrderDetails('${order.id}')"><i class="fas fa-eye"></i></button>
              </td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('ordersTableBody').innerHTML = ordersHtml || '<tr><td colspan="8" style="text-align: center">No orders found</td></tr>';
      }).catch(error => {
        console.error('Error loading orders:', error);
      });
    }

    // Filter orders list
    function filterOrdersList(orders, products) {
      const searchTerm = document.getElementById('orderSearch').value.toLowerCase();
      
      return orders.filter(order => {
        const product = products.find(p => p.id === order.productId);
        const productName = product ? (product.title || '').toLowerCase() : '';
        const matchesSearch = (order.fullname || '').toLowerCase().includes(searchTerm) || 
                             (order.mobile || '').includes(searchTerm) ||
                             productName.includes(searchTerm);
        
        return matchesSearch;
      });
    }

    // Filter orders
    function filterOrders() {
      currentOrdersPage = 1;
      loadOrders();
    }

    // Update order status
    function updateOrderStatus(orderId, status) {
      const ordersRef = database.ref('orders');
      ordersRef.child(orderId).update({ status: status })
        .then(() => {
          loadOrders();
          // If on dashboard, refresh it too
          if (currentAdminTab === 'dashboard') {
            loadDashboardData();
          }
          alert('Order status updated successfully!');
        })
        .catch(error => {
          console.error('Error updating order status:', error);
          alert('Error updating order status');
        });
    }

    // Apply bulk action to orders
    function applyBulkAction() {
      const status = document.getElementById('bulkStatusAction').value;
      if (!status) {
        alert('Please select a status action');
        return;
      }
      
      const checkboxes = document.querySelectorAll('#ordersTableBody input[type="checkbox"]:checked');
      if (checkboxes.length === 0) {
        alert('Please select at least one order');
        return;
      }
      
      if (!confirm(`Are you sure you want to update ${checkboxes.length} order(s) to ${status}?`)) {
        return;
      }
      
      const updates = {};
      checkboxes.forEach(checkbox => {
        updates[`orders/${checkbox.value}/status`] = status;
      });
      
      database.ref().update(updates)
        .then(() => {
          loadOrders();
          // If on dashboard, refresh it too
          if (currentAdminTab === 'dashboard') {
            loadDashboardData();
          }
          
          // Uncheck select all
          document.getElementById('selectAllOrders').checked = false;
          alert('Bulk update successful!');
        })
        .catch(error => {
          console.error('Error in bulk update:', error);
          alert('Error updating orders');
        });
    }

    // View order details
    function viewOrderDetails(orderId) {
      const ordersRef = database.ref('orders');
      const productsRef = database.ref('products');
      
      Promise.all([
        new Promise(resolve => ordersRef.child(orderId).once('value', snapshot => resolve(snapshot.val()))),
        new Promise(resolve => productsRef.once('value', snapshot => resolve(snapshot.val())))
      ]).then(([order, productsData]) => {
        if (!order) {
          alert('Order not found');
          return;
        }
        
        let products = [];
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
        }
        
        const product = products.find(p => p.id === order.productId);
        
        const detailsHtml = `
          <h3>Order Details #${order.id}</h3>
          <p><strong>Customer:</strong> ${order.fullname || 'N/A'}</p>
          <p><strong>Mobile:</strong> ${order.mobile || 'N/A'}</p>
          <p><strong>Address:</strong> ${order.house || ''}, ${order.city || ''}, ${order.state || ''} - ${order.pincode || ''}</p>
          <p><strong>Product:</strong> ${product ? product.title : 'Unknown'} (x${order.qty || 1})</p>
          <p><strong>Amount:</strong> ₹${product ? product.price * (order.qty || 1) : 'N/A'}</p>
          <p><strong>Status:</strong> ${order.status || 'Pending'}</p>
          <p><strong>Order Date:</strong> ${order.timestamp ? new Date(order.timestamp).toLocaleString() : 'N/A'}</p>
          <p><strong>Payment Method:</strong> ${order.payment === 'prepaid' ? 'Prepaid' : 'Cash on Delivery'}</p>
        `;
        
        alert(detailsHtml);
      }).catch(error => {
        console.error('Error loading order details:', error);
        alert('Error loading order details');
      });
    }

    // Load trending products
    function loadTrendingProducts() {
      const productsRef = database.ref('products');
      productsRef.once('value', snapshot => {
        const productsData = snapshot.val();
        let products = [];
        
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
        }
        
        const trendingHtml = products.map(product => {
          const images = product.images || [];
          const mainImage = images.length > 0 ? images[0] : '';
          
          return `
            <tr>
              <td><img src="${mainImage}" width="50" height="50" class="product-image"></td>
              <td>${product.title || 'No Name'}</td>
              <td>₹${product.price || 0}</td>
              <td>${product.trending ? '<span class="badge badge-success">Yes</span>' : '<span class="badge badge-warning">No</span>'}</td>
              <td>
                <div style="display: flex; gap: 8px;">
                  <button class="btn ${product.trending ? 'btn-danger' : 'btn-success'} btn-sm" onclick="toggleTrending('${product.id}', ${!product.trending})">
                    <i class="fas ${product.trending ? 'fa-times' : 'fa-fire'}"></i> 
                    ${product.trending ? 'Remove' : 'Add'}
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('trendingTableBody').innerHTML = trendingHtml || '<tr><td colspan="5" style="text-align: center">No products found</td></tr>';
      }).catch(error => {
        console.error('Error loading trending products:', error);
      });
    }

    // Toggle trending status
    function toggleTrending(productId, isTrending) {
      database.ref('products/' + productId).update({ trending: isTrending })
        .then(() => {
          loadTrendingProducts();
          // If on dashboard, refresh it too
          if (currentAdminTab === 'dashboard') {
            loadDashboardData();
          }
          // Also refresh products tab if active
          if (currentAdminTab === 'products') {
            loadProducts();
          }
          alert('Trending status updated!');
        })
        .catch(error => {
          console.error('Error updating trending status:', error);
          alert('Error updating trending status');
        });
    }

    // Load similar products (NEW FUNCTION)
    function loadSimilarProducts() {
      const similarProductsRef = database.ref('similarProducts');
      const productsRef = database.ref('products');
      
      Promise.all([
        new Promise(resolve => similarProductsRef.once('value', snapshot => resolve(snapshot.val()))),
        new Promise(resolve => productsRef.once('value', snapshot => resolve(snapshot.val())))
      ]).then(([similarData, productsData]) => {
        let similarProducts = [];
        let products = [];
        
        // Process similar products data
        if (similarData) {
          similarProducts = Object.entries(similarData).map(([key, value]) => ({ 
            key, 
            ...value,
            mainProductId: value.mainProductId || key 
          }));
        }
        
        // Process products data
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
        }
        
        const filteredSimilarProducts = filterSimilarProductsList(similarProducts, products);
        const totalPages = Math.ceil(filteredSimilarProducts.length / similarProductsPerPage);
        
        // Update pagination
        updatePagination('similarProductsPagination', currentSimilarProductsPage, totalPages, 'similar-products');
        
        // Get similar products for current page
        const startIndex = (currentSimilarProductsPage - 1) * similarProductsPerPage;
        const paginatedSimilarProducts = filteredSimilarProducts.slice(startIndex, startIndex + similarProductsPerPage);
        
        // Render similar products table
        const similarProductsHtml = paginatedSimilarProducts.map(item => {
          const mainProduct = products.find(p => p.id === item.mainProductId);
          const similarCount = item.similarProductIds ? item.similarProductIds.length : 0;
          const images = mainProduct ? (mainProduct.images || []) : [];
          const mainImage = images.length > 0 ? images[0] : '';
          
          return `
            <tr>
              <td>${mainProduct ? mainProduct.title : 'Product ID: ' + item.mainProductId}</td>
              <td>
                ${mainImage ? 
                  `<img src="${mainImage}" width="50" height="50" class="product-image">` : 
                  '<div class="product-image" style="background: #f1f5f9; display: flex; align-items: center; justify-content: center; color: #94a3b8;"><i class="fas fa-image"></i></div>'
                }
              </td>
              <td>${similarCount}</td>
              <td>${item.status === 'active' ? '<span class="badge badge-success">Active</span>' : '<span class="badge badge-warning">Inactive</span>'}</td>
              <td>
                <div style="display: flex; gap: 8px;">
                  <button class="btn btn-primary btn-sm" onclick="editSimilarProducts('${item.mainProductId}')">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="deleteSimilarProductsConfirm('${item.mainProductId}')">
                    <i class="fas fa-trash"></i> Delete
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('similarProductsTableBody').innerHTML = 
          similarProductsHtml || '<tr><td colspan="5" style="text-align: center">No similar products configured</td></tr>';
      }).catch(error => {
        console.error('Error loading similar products:', error);
      });
    }

    // Filter similar products list (NEW FUNCTION)
    function filterSimilarProductsList(similarProducts, products) {
      const searchTerm = document.getElementById('similarProductsSearch').value.toLowerCase();
      
      return similarProducts.filter(item => {
        const mainProduct = products.find(p => p.id === item.mainProductId);
        if (!mainProduct) return false;
        
        return (mainProduct.title || '').toLowerCase().includes(searchTerm);
      });
    }

    // Filter similar products (NEW FUNCTION)
    function filterSimilarProducts() {
      currentSimilarProductsPage = 1;
      loadSimilarProducts();
    }

    // Load customers
    function loadCustomers() {
      const ordersRef = database.ref('orders');
      ordersRef.once('value', snapshot => {
        const ordersData = snapshot.val();
        let orders = [];
        
        if (ordersData) {
          orders = Object.values(ordersData);
        }
        
        // Extract unique customers based on mobile number
        const customersMap = {};
        orders.forEach(order => {
          if (order.mobile && !customersMap[order.mobile]) {
            customersMap[order.mobile] = {
              name: order.fullname || 'Unknown',
              mobile: order.mobile,
              email: order.email || 'N/A',
              location: `${order.city || ''}, ${order.state || ''}`,
              orderCount: 1,
              lastOrder: order.timestamp
            };
          } else if (order.mobile) {
            customersMap[order.mobile].orderCount++;
            if (new Date(order.timestamp) > new Date(customersMap[order.mobile].lastOrder)) {
              customersMap[order.mobile].lastOrder = order.timestamp;
            }
          }
        });
        
        const customers = Object.values(customersMap);
        const filteredCustomers = filterCustomersList(customers);
        const totalPages = Math.ceil(filteredCustomers.length / customersPerPage);
        
        // Update pagination
        updatePagination('customersPagination', currentCustomersPage, totalPages, 'customers');
        
        // Get customers for current page
        const startIndex = (currentCustomersPage - 1) * customersPerPage;
        const paginatedCustomers = filteredCustomers.slice(startIndex, startIndex + customersPerPage);
        
        // Render customers table
        const customersHtml = paginatedCustomers.map(customer => {
          return `
            <tr>
              <td>${customer.name}</td>
              <td>${customer.mobile}</td>
              <td>${customer.email}</td>
              <td>${customer.location}</td>
              <td>${customer.orderCount}</td>
              <td>${customer.lastOrder ? new Date(customer.lastOrder).toLocaleDateString() : 'N/A'}</td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('customersTableBody').innerHTML = customersHtml || '<tr><td colspan="6" style="text-align: center">No customers found</td></tr>';
      }).catch(error => {
        console.error('Error loading customers:', error);
      });
    }

    // Filter customers list
    function filterCustomersList(customers) {
      const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
      
      return customers.filter(customer => {
        return (customer.name || '').toLowerCase().includes(searchTerm) || 
               (customer.mobile || '').includes(searchTerm) ||
               (customer.email || '').toLowerCase().includes(searchTerm) ||
               (customer.location || '').toLowerCase().includes(searchTerm);
      });
    }

    // Filter customers
    function filterCustomers() {
      currentCustomersPage = 1;
      loadCustomers();
    }

    // Load banners
    function loadBanners() {
      const bannersRef = database.ref('banners');
      bannersRef.once('value', snapshot => {
        const bannersData = snapshot.val();
        let banners = [];
        
        if (bannersData) {
          banners = Object.entries(bannersData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
        }
        
        // Render banners table
        const bannersHtml = banners.map(banner => {
          return `
            <tr>
              <td>#${banner.id}</td>
              <td><img src="${banner.image || ''}" width="100" height="50" style="object-fit: cover; border-radius: 6px"></td>
              <td>${banner.title || 'No Title'}</td>
              <td>${banner.status === 'active' ? '<span class="badge badge-success">Active</span>' : '<span class="badge badge-danger">Inactive</span>'}</td>
              <td>
                <div style="display: flex; gap: 8px;">
                  <button class="btn btn-primary btn-sm" onclick="editBanner('${banner.id}')"><i class="fas fa-edit"></i></button>
                  <button class="btn btn-danger btn-sm" onclick="deleteBannerConfirm('${banner.id}')"><i class="fas fa-trash"></i></button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('bannersTableBody').innerHTML = bannersHtml || '<tr><td colspan="5" style="text-align: center">No banners found</td></tr>';
      }).catch(error => {
        console.error('Error loading banners:', error);
      });
    }

    // Load policies
    function loadPolicies() {
      const policiesRef = database.ref('policies');
      policiesRef.once('value', snapshot => {
        const policies = snapshot.val() || {};
        
        // Set policy content
        document.getElementById('aboutContent').value = policies.about || '';
        document.getElementById('refundContent').value = policies.refund || '';
        document.getElementById('termsContent').value = policies.terms || '';
        document.getElementById('shippingContent').value = policies.shipping || '';
        document.getElementById('privacyContent').value = policies.privacy || '';
      }).catch(error => {
        console.error('Error loading policies:', error);
      });
    }

    // Save policy
    function savePolicy(policyType) {
      const content = document.getElementById(`${policyType}Content`).value;
      
      database.ref('policies/' + policyType).set(content)
        .then(() => {
          alert(`${policyType.charAt(0).toUpperCase() + policyType.slice(1)} policy saved successfully!`);
        })
        .catch(error => {
          console.error('Error saving policy:', error);
          alert('Error saving policy');
        });
    }

    // Load settings
    function loadSettings() {
      const settingsRef = database.ref('settings');
      settingsRef.once('value', snapshot => {
        const settings = snapshot.val() || {};
        
        // Set settings values
        if (settings.storeName) document.getElementById('storeName').value = settings.storeName;
        if (settings.storeEmail) document.getElementById('storeEmail').value = settings.storeEmail;
        if (settings.storePhone) document.getElementById('storePhone').value = settings.storePhone;
        if (settings.storeAddress) document.getElementById('storeAddress').value = settings.storeAddress;
        if (settings.shippingCost) document.getElementById('shippingCost').value = settings.shippingCost;
        if (settings.currency) document.getElementById('currency').value = settings.currency;
      }).catch(error => {
        console.error('Error loading settings:', error);
      });
    }

    // Save settings
    function saveSettings() {
      const settings = {
        storeName: document.getElementById('storeName').value,
        storeEmail: document.getElementById('storeEmail').value,
        storePhone: document.getElementById('storePhone').value,
        storeAddress: document.getElementById('storeAddress').value,
        shippingCost: document.getElementById('shippingCost').value,
        currency: document.getElementById('currency').value
      };
      
      database.ref('settings').set(settings)
        .then(() => {
          alert('Settings saved successfully!');
        })
        .catch(error => {
          console.error('Error saving settings:', error);
          alert('Error saving settings');
        });
    }

    // Show add product modal
    function showAddProductModal() {
      // Reset form
      document.getElementById('productName').value = '';
      document.getElementById('productPrice').value = '';
      document.getElementById('productDeliveryCharge').value = '';
      document.getElementById('productStock').value = '';
      document.getElementById('productCategory').value = '';
      document.getElementById('productDesc').value = '';
      document.getElementById('productFullDesc').value = '';
      document.getElementById('productSizes').value = '';
      document.getElementById('productTrending').checked = false;
      document.getElementById('productStatus').checked = true;
      document.getElementById('productImagePreviews').innerHTML = '';
      uploadedImages = [];
      
      // Make sure categories dropdown is updated
      updateCategoryDropdowns();
      
      // Show modal
      document.getElementById('addProductModal').classList.add('active');
    }

    // Show add category modal
    function showAddCategoryModal() {
      // Reset form
      document.getElementById('categoryName').value = '';
      document.getElementById('categoryDescription').value = '';
      document.getElementById('categoryStatus').checked = true;
      document.getElementById('categoryImagePreview').innerHTML = '<span>No image selected</span>';
      uploadedCategoryImage = null;
      
      // Show modal
      document.getElementById('addCategoryModal').classList.add('active');
    }

    // Show add banner modal
    function showAddBannerModal() {
      // Reset form
      document.getElementById('bannerTitle').value = '';
      document.getElementById('bannerLink').value = '';
      document.getElementById('bannerStatus').checked = true;
      document.getElementById('bannerImagePreview').innerHTML = '<span>No image selected</span>';
      uploadedBannerImage = null;
      
      // Show modal
      document.getElementById('addBannerModal').classList.add('active');
    }

    // Show add similar products modal (NEW FUNCTION)
    function showAddSimilarProductsModal() {
      const productsRef = database.ref('products');
      productsRef.once('value', snapshot => {
        const productsData = snapshot.val();
        let products = [];
        
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
        }
        
        allProductsForSimilar = products;
        
        // Populate main product dropdown
        const mainProductSelect = document.getElementById('mainProductSelect');
        mainProductSelect.innerHTML = '<option value="">-- Select Product --</option>' +
          products.map(product => 
            `<option value="${product.id}">${product.title || 'No Name'} (₹${product.price || 0})</option>`
          ).join('');
        
        // Populate similar products multi-select
        const similarProductsSelect = document.getElementById('similarProductsSelect');
        similarProductsSelect.innerHTML = products.map(product => 
          `<option value="${product.id}">${product.title || 'No Name'} (₹${product.price || 0}) - ${product.category || 'Uncategorized'}</option>`
        ).join('');
        
        // Reset form
        document.getElementById('selectedProductInfo').style.display = 'none';
        document.getElementById('selectedSimilarProductsPreview').innerHTML = '';
        document.getElementById('autoSuggestSimilar').checked = true;
        
        // Show modal
        document.getElementById('addSimilarProductsModal').classList.add('active');
      }).catch(error => {
        console.error('Error loading products for similar modal:', error);
        alert('Error loading products');
      });
    }

    // Handle product image upload
    function handleProductImageUpload(e) {
      const files = e.target.files;
      const previewContainer = document.getElementById('productImagePreviews');
      
      // Clear existing previews
      previewContainer.innerHTML = '';
      
      // Create preview for each selected file
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const reader = new FileReader();
        
        reader.onload = function(e) {
          // Store image data
          uploadedImages.push(e.target.result);
          
          const previewItem = document.createElement('div');
          previewItem.className = 'image-preview-item';
          
          const img = document.createElement('img');
          img.src = e.target.result;
          img.alt = 'Product Image Preview';
          
          const removeBtn = document.createElement('button');
          removeBtn.className = 'remove-image';
          removeBtn.innerHTML = '&times;';
          removeBtn.onclick = function() {
            const index = uploadedImages.indexOf(e.target.result);
            if (index !== -1) {
              uploadedImages.splice(index, 1);
            }
            previewItem.remove();
          };
          
          previewItem.appendChild(img);
          previewItem.appendChild(removeBtn);
          previewContainer.appendChild(previewItem);
        };
        
        reader.readAsDataURL(file);
      }
    }

    // Handle category image upload
    function handleCategoryImageUpload(e) {
      const files = e.target.files;
      const preview = document.getElementById('categoryImagePreview');
      
      if (files && files.length > 0) {
        const file = files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) {
          // Store image data
          uploadedCategoryImage = e.target.result;
          
          // Create preview
          preview.innerHTML = `<img src="${e.target.result}" alt="Category Image">`;
        };
        
        reader.readAsDataURL(file);
      }
    }

    // Handle banner image upload
    function handleBannerImageUpload(e) {
      const files = e.target.files;
      const preview = document.getElementById('bannerImagePreview');
      
      if (files && files.length > 0) {
        const file = files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) {
          // Store image data
          uploadedBannerImage = e.target.result;
          
          // Create preview
          preview.innerHTML = `<img src="${e.target.result}" alt="Banner Image">`;
        };
        
        reader.readAsDataURL(file);
      }
    }

    // Save product
    function saveProduct() {
      const name = document.getElementById('productName').value;
      const price = document.getElementById('productPrice').value;
      const deliveryCharge = document.getElementById('productDeliveryCharge').value;
      const stock = document.getElementById('productStock').value;
      const category = document.getElementById('productCategory').value;
      const desc = document.getElementById('productDesc').value;
      const fullDesc = document.getElementById('productFullDesc').value;
      const sizes = document.getElementById('productSizes').value.split(',').map(s => s.trim());
      const trending = document.getElementById('productTrending').checked;
      const status = document.getElementById('productStatus').checked ? 'active' : 'inactive';
      
      // Validation
      if (!name || !price || !category || !desc) {
        alert('Please fill in all required fields');
        return;
      }
      
      if (uploadedImages.length === 0) {
        alert('Please upload at least one product image');
        return;
      }
      
      if (category === "") {
        alert('Please select a category');
        return;
      }
      
      // Get next available ID
      const productsRef = database.ref('products');
      productsRef.once('value', snapshot => {
        const productsData = snapshot.val();
        let products = [];
        
        if (productsData) {
          products = Object.values(productsData);
        }
        
        let nextId = 1;
        if (products.length > 0) {
          const ids = products.map(p => parseInt(p.id)).filter(id => !isNaN(id));
          nextId = ids.length > 0 ? Math.max(...ids) + 1 : 1;
        }
        
        // Create new product
        const newProduct = {
          id: nextId.toString(),
          title: name,
          price: parseInt(price) || 0,
          deliveryCharge: parseInt(deliveryCharge) || 0,
          stock: parseInt(stock) || 0,
          desc: desc,
          fullDesc: fullDesc,
          images: uploadedImages,
          sizes: sizes,
          category: category,
          trending: trending,
          status: status,
          timestamp: Date.now()
        };
        
        // Add to Firebase
        const newProductKey = nextId.toString();
        productsRef.child(newProductKey).set(newProduct)
          .then(() => {
            // Close modal and refresh products list
            document.getElementById('addProductModal').classList.remove('active');
            loadProducts();
            loadTrendingProducts();
            
            // If on dashboard, refresh it too
            if (currentAdminTab === 'dashboard') {
              loadDashboardData();
            }
            
            alert('Product added successfully!');
          })
          .catch(error => {
            console.error('Error saving product:', error);
            alert('Error saving product');
          });
      });
    }

    // Save category
    function saveCategory() {
      const name = document.getElementById('categoryName').value;
      const description = document.getElementById('categoryDescription').value;
      const status = document.getElementById('categoryStatus').checked ? 'active' : 'inactive';
      
      // Validation
      if (!name) {
        alert('Please enter a category name');
        return;
      }
      
      if (!uploadedCategoryImage) {
        alert('Please upload a category image');
        return;
      }
      
      // Check if category already exists
      const existingCategory = allCategories.find(cat => cat.name.toLowerCase() === name.toLowerCase());
      if (existingCategory) {
        alert('Category with this name already exists!');
        return;
      }
      
      // Get next available ID
      const categoriesRef = database.ref('categories');
      categoriesRef.once('value', snapshot => {
        const categoriesData = snapshot.val();
        let categories = [];
        
        if (categoriesData) {
          categories = Object.values(categoriesData);
        }
        
        let nextId = 1;
        if (categories.length > 0) {
          const ids = categories.map(c => parseInt(c.id)).filter(id => !isNaN(id));
          nextId = ids.length > 0 ? Math.max(...ids) + 1 : 1;
        }
        
        // Create new category
        const newCategory = {
          id: nextId.toString(),
          name: name,
          description: description,
          image: uploadedCategoryImage,
          status: status,
          productCount: 0
        };
        
        // Add to Firebase
        const newCategoryKey = nextId.toString();
        categoriesRef.child(newCategoryKey).set(newCategory)
          .then(() => {
            // Add to local array
            allCategories.push(newCategory);
            
            // Update dropdowns
            updateCategoryDropdowns();
            
            // Close modal and refresh categories list
            document.getElementById('addCategoryModal').classList.remove('active');
            loadCategories();
            
            alert('Category added successfully!');
          })
          .catch(error => {
            console.error('Error saving category:', error);
            alert('Error saving category');
          });
      });
    }

    // Save banner
    function saveBanner() {
      const title = document.getElementById('bannerTitle').value;
      const link = document.getElementById('bannerLink').value;
      const status = document.getElementById('bannerStatus').checked ? 'active' : 'inactive';
      
      // Validation
      if (!title) {
        alert('Please enter a banner title');
        return;
      }
      
      if (!uploadedBannerImage) {
        alert('Please upload a banner image');
        return;
      }
      
      // Get next available ID
      const bannersRef = database.ref('banners');
      bannersRef.once('value', snapshot => {
        const bannersData = snapshot.val();
        let banners = [];
        
        if (bannersData) {
          banners = Object.values(bannersData);
        }
        
        let nextId = 1;
        if (banners.length > 0) {
          const ids = banners.map(b => parseInt(b.id)).filter(id => !isNaN(id));
          nextId = ids.length > 0 ? Math.max(...ids) + 1 : 1;
        }
        
        // Create new banner
        const newBanner = {
          id: nextId.toString(),
          title: title,
          link: link,
          image: uploadedBannerImage,
          status: status
        };
        
        // Add to Firebase
        const newBannerKey = nextId.toString();
        bannersRef.child(newBannerKey).set(newBanner)
          .then(() => {
            // Close modal and refresh banners list
            document.getElementById('addBannerModal').classList.remove('active');
            loadBanners();
            
            alert('Banner added successfully!');
          })
          .catch(error => {
            console.error('Error saving banner:', error);
            alert('Error saving banner');
          });
      });
    }

    // Load product details when main product is selected (NEW FUNCTION)
    function loadProductDetails(productId) {
      const product = allProductsForSimilar.find(p => p.id === productId);
      if (!product) return;
      
      const infoDiv = document.getElementById('selectedProductInfo');
      const productImage = document.getElementById('selectedProductImage');
      const productName = document.getElementById('selectedProductName');
      const productDetails = document.getElementById('selectedProductDetails');
      
      const images = product.images || [];
      const mainImage = images.length > 0 ? images[0] : '';
      
      productImage.src = mainImage;
      productName.textContent = product.title || 'No Name';
      productDetails.textContent = `${product.category || 'Uncategorized'} | ₹${product.price || 0} | Stock: ${product.stock || 0}`;
      
      infoDiv.style.display = 'block';
      
      // Auto-select similar products by category
      const autoSuggest = document.getElementById('autoSuggestSimilar').checked;
      if (autoSuggest) {
        const similarProductsSelect = document.getElementById('similarProductsSelect');
        const similarProducts = allProductsForSimilar.filter(p => 
          p.id !== productId && 
          p.category === product.category
        );
        
        // Select options with same category
        Array.from(similarProductsSelect.options).forEach(option => {
          const optionProductId = option.value;
          const isSimilar = similarProducts.some(p => p.id === optionProductId);
          option.selected = isSimilar;
        });
        
        // Update preview
        updateSelectedSimilarProductsPreview();
      }
    }

    // Search products for similar products selection (NEW FUNCTION)
    function searchProductsForSimilar() {
      const searchTerm = document.getElementById('searchSimilarProducts').value.toLowerCase();
      const selectElement = document.getElementById('similarProductsSelect');
      
      Array.from(selectElement.options).forEach(option => {
        const text = option.text.toLowerCase();
        option.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    }

    // Edit search products (NEW FUNCTION)
    function editSearchProductsForSimilar() {
      const searchTerm = document.getElementById('editSearchSimilarProducts').value.toLowerCase();
      const selectElement = document.getElementById('editSimilarProductsSelect');
      
      Array.from(selectElement.options).forEach(option => {
        const text = option.text.toLowerCase();
        option.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    }

    // Update selected similar products preview (NEW FUNCTION)
    function updateSelectedSimilarProductsPreview() {
      const selectElement = document.getElementById('similarProductsSelect');
      const selectedOptions = Array.from(selectElement.selectedOptions);
      const previewDiv = document.getElementById('selectedSimilarProductsPreview');
      
      previewDiv.innerHTML = '';
      
      selectedOptions.forEach(option => {
        const productId = option.value;
        const product = allProductsForSimilar.find(p => p.id === productId);
        
        if (product) {
          const images = product.images || [];
          const mainImage = images.length > 0 ? images[0] : '';
          
          const chip = document.createElement('div');
          chip.className = 'similar-product-chip';
          chip.innerHTML = `
            <img src="${mainImage}" alt="${product.title || 'No Name'}">
            <span>${product.title || 'No Name'}</span>
            <button class="remove-chip" onclick="removeFromSimilarSelection('${productId}')">&times;</button>
          `;
          previewDiv.appendChild(chip);
        }
      });
    }

    // Remove product from selection (NEW FUNCTION)
    function removeFromSimilarSelection(productId) {
      const selectElement = document.getElementById('similarProductsSelect');
      const option = Array.from(selectElement.options).find(opt => opt.value === productId);
      if (option) {
        option.selected = false;
        updateSelectedSimilarProductsPreview();
      }
    }

    // Save similar products (NEW FUNCTION)
    function saveSimilarProducts() {
      const mainProductId = document.getElementById('mainProductSelect').value;
      const similarProductsSelect = document.getElementById('similarProductsSelect');
      const selectedOptions = Array.from(similarProductsSelect.selectedOptions);
      
      if (!mainProductId) {
        alert('Please select a main product');
        return;
      }
      
      if (selectedOptions.length === 0) {
        alert('Please select at least one similar product');
        return;
      }
      
      const similarProductIds = selectedOptions.map(option => option.value);
      
      // Check if main product is not in similar products
      if (similarProductIds.includes(mainProductId)) {
        alert('Main product cannot be in similar products list');
        return;
      }
      
      const similarProductsRef = database.ref('similarProducts');
      
      // Create similar products entry
      const similarProductsEntry = {
        mainProductId: mainProductId,
        similarProductIds: similarProductIds,
        status: 'active',
        createdAt: Date.now(),
        updatedAt: Date.now()
      };
      
      // Save to Firebase
      similarProductsRef.child(mainProductId).set(similarProductsEntry)
        .then(() => {
          // Close modal
          document.getElementById('addSimilarProductsModal').classList.remove('active');
          
          // Refresh similar products list
          loadSimilarProducts();
          
          alert('Similar products saved successfully!');
        })
        .catch(error => {
          console.error('Error saving similar products:', error);
          alert('Error saving similar products');
        });
    }

    // Edit product
    function editProduct(productId) {
      const productsRef = database.ref('products');
      productsRef.child(productId).once('value', snapshot => {
        const product = snapshot.val();
        if (!product) {
          alert('Product not found');
          return;
        }
        
        // Make sure categories dropdown is updated
        updateCategoryDropdowns();
        
        // Fill form with product data
        document.getElementById('editProductId').value = productId;
        document.getElementById('editProductName').value = product.title || '';
        document.getElementById('editProductPrice').value = product.price || 0;
        document.getElementById('editProductDeliveryCharge').value = product.deliveryCharge || 0;
        document.getElementById('editProductStock').value = product.stock || 0;
        document.getElementById('editProductCategory').value = product.category || '';
        document.getElementById('editProductDesc').value = product.desc || '';
        document.getElementById('editProductFullDesc').value = product.fullDesc || '';
        document.getElementById('editProductSizes').value = product.sizes ? product.sizes.join(', ') : '';
        document.getElementById('editProductTrending').checked = product.trending || false;
        document.getElementById('editProductStatus').checked = product.status === 'active';
        
        // Show modal
        document.getElementById('editProductModal').classList.add('active');
      }).catch(error => {
        console.error('Error loading product for edit:', error);
        alert('Error loading product');
      });
    }

    // Update product
    function updateProduct() {
      const productId = document.getElementById('editProductId').value;
      const name = document.getElementById('editProductName').value;
      const price = document.getElementById('editProductPrice').value;
      const deliveryCharge = document.getElementById('editProductDeliveryCharge').value;
      const stock = document.getElementById('editProductStock').value;
      const category = document.getElementById('editProductCategory').value;
      const desc = document.getElementById('editProductDesc').value;
      const fullDesc = document.getElementById('editProductFullDesc').value;
      const sizes = document.getElementById('editProductSizes').value.split(',').map(s => s.trim());
      const trending = document.getElementById('editProductTrending').checked;
      const status = document.getElementById('editProductStatus').checked ? 'active' : 'inactive';
      
      // Validation
      if (!name || !price || !category || !desc) {
        alert('Please fill in all required fields');
        return;
      }
      
      if (category === "") {
        alert('Please select a category');
        return;
      }
      
      // Update product
      const updates = {
        title: name,
        price: parseInt(price) || 0,
        deliveryCharge: parseInt(deliveryCharge) || 0,
        stock: parseInt(stock) || 0,
        desc: desc,
        fullDesc: fullDesc,
        sizes: sizes,
        category: category,
        trending: trending,
        status: status
      };
      
      database.ref('products/' + productId).update(updates)
        .then(() => {
          // Close modal and refresh products list
          document.getElementById('editProductModal').classList.remove('active');
          loadProducts();
          loadTrendingProducts();
          
          // If on dashboard, refresh it too
          if (currentAdminTab === 'dashboard') {
            loadDashboardData();
          }
          
          alert('Product updated successfully!');
        })
        .catch(error => {
          console.error('Error updating product:', error);
          alert('Error updating product');
        });
    }

    // Delete product confirmation
    function deleteProductConfirm(productId) {
      if (confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
        deleteProduct(productId);
      }
    }

    // Delete product
    function deleteProduct(productId) {
      const productsRef = database.ref('products');
      
      productsRef.child(productId).remove()
        .then(() => {
          // Close modal and refresh products list
          document.getElementById('editProductModal').classList.remove('active');
          loadProducts();
          loadTrendingProducts();
          
          // If on dashboard, refresh it too
          if (currentAdminTab === 'dashboard') {
            loadDashboardData();
          }
          
          alert('Product deleted successfully!');
        })
        .catch(error => {
          console.error('Error deleting product:', error);
          alert('Error deleting product');
        });
    }

    // Edit similar products (NEW FUNCTION)
    function editSimilarProducts(mainProductId) {
      const similarProductsRef = database.ref('similarProducts');
      const productsRef = database.ref('products');
      
      Promise.all([
        new Promise(resolve => similarProductsRef.child(mainProductId).once('value', snapshot => resolve(snapshot.val()))),
        new Promise(resolve => productsRef.once('value', snapshot => resolve(snapshot.val())))
      ]).then(([similarProducts, productsData]) => {
        let products = [];
        
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
        }
        
        allProductsForSimilar = products;
        
        if (!similarProducts) {
          alert('Similar products not found for this product');
          return;
        }
        
        // Set main product ID
        document.getElementById('editMainProductId').value = mainProductId;
        
        // Load main product info
        const mainProduct = products.find(p => p.id === mainProductId);
        const editProductInfo = document.getElementById('editProductInfo');
        
        if (mainProduct) {
          const images = mainProduct.images || [];
          const mainImage = images.length > 0 ? images[0] : '';
          
          editProductInfo.innerHTML = `
            <div style="display: flex; align-items: center; gap: 15px;">
              <img src="${mainImage}" width="60" height="60" style="border-radius: 4px; object-fit: cover;">
              <div>
                <h4 style="margin: 0 0 5px 0;">${mainProduct.title || 'No Name'}</h4>
                <p style="margin: 0; color: #64748b;">${mainProduct.category || 'Uncategorized'} | ₹${mainProduct.price || 0} | Stock: ${mainProduct.stock || 0}</p>
              </div>
            </div>
          `;
        }
        
        // Populate similar products multi-select
        const editSimilarProductsSelect = document.getElementById('editSimilarProductsSelect');
        editSimilarProductsSelect.innerHTML = products
          .filter(p => p.id !== mainProductId)
          .map(product => {
            const isSelected = similarProducts.similarProductIds && similarProducts.similarProductIds.includes(product.id);
            return `<option value="${product.id}" ${isSelected ? 'selected' : ''}>${product.title || 'No Name'} (₹${product.price || 0}) - ${product.category || 'Uncategorized'}</option>`;
          }).join('');
        
        // Update preview
        updateEditSelectedSimilarProductsPreview();
        
        // Show modal
        document.getElementById('editSimilarProductsModal').classList.add('active');
      }).catch(error => {
        console.error('Error loading similar products for edit:', error);
        alert('Error loading similar products');
      });
    }

    // Update edit selected products preview (NEW FUNCTION)
    function updateEditSelectedSimilarProductsPreview() {
      const selectElement = document.getElementById('editSimilarProductsSelect');
      const selectedOptions = Array.from(selectElement.selectedOptions);
      const previewDiv = document.getElementById('editSelectedSimilarProductsPreview');
      
      previewDiv.innerHTML = '';
      
      selectedOptions.forEach(option => {
        const productId = option.value;
        const product = allProductsForSimilar.find(p => p.id === productId);
        
        if (product) {
          const images = product.images || [];
          const mainImage = images.length > 0 ? images[0] : '';
          
          const chip = document.createElement('div');
          chip.className = 'similar-product-chip';
          chip.innerHTML = `
            <img src="${mainImage}" alt="${product.title || 'No Name'}">
            <span>${product.title || 'No Name'}</span>
            <button class="remove-chip" onclick="removeFromEditSimilarSelection('${productId}')">&times;</button>
          `;
          previewDiv.appendChild(chip);
        }
      });
    }

    // Remove from edit selection (NEW FUNCTION)
    function removeFromEditSimilarSelection(productId) {
      const selectElement = document.getElementById('editSimilarProductsSelect');
      const option = Array.from(selectElement.options).find(opt => opt.value === productId);
      if (option) {
        option.selected = false;
        updateEditSelectedSimilarProductsPreview();
      }
    }

    // Update similar products (NEW FUNCTION)
    function updateSimilarProducts() {
      const mainProductId = document.getElementById('editMainProductId').value;
      const editSimilarProductsSelect = document.getElementById('editSimilarProductsSelect');
      const selectedOptions = Array.from(editSimilarProductsSelect.selectedOptions);
      
      const similarProductIds = selectedOptions.map(option => option.value);
      
      // Check if main product is not in similar products
      if (similarProductIds.includes(mainProductId)) {
        alert('Main product cannot be in similar products list');
        return;
      }
      
      const similarProductsRef = database.ref('similarProducts');
      
      // Update similar products entry
      const updates = {
        similarProductIds: similarProductIds,
        updatedAt: Date.now()
      };
      
      similarProductsRef.child(mainProductId).update(updates)
        .then(() => {
          // Close modal
          document.getElementById('editSimilarProductsModal').classList.remove('active');
          
          // Refresh similar products list
          loadSimilarProducts();
          
          alert('Similar products updated successfully!');
        })
        .catch(error => {
          console.error('Error updating similar products:', error);
          alert('Error updating similar products');
        });
    }

    // Delete similar products confirmation (NEW FUNCTION)
    function deleteSimilarProductsConfirm(mainProductId) {
      if (confirm('Are you sure you want to delete all similar product links for this product?')) {
        deleteSimilarProductsEntry(mainProductId);
      }
    }

    // Delete similar products entry (NEW FUNCTION)
    function deleteSimilarProductsEntry(mainProductId) {
      const similarProductsRef = database.ref('similarProducts');
      
      similarProductsRef.child(mainProductId).remove()
        .then(() => {
          loadSimilarProducts();
          alert('Similar products deleted successfully!');
        })
        .catch(error => {
          console.error('Error deleting similar products:', error);
          alert('Error deleting similar products');
        });
    }

    // Delete similar products (from edit modal) (NEW FUNCTION)
    function deleteSimilarProducts() {
      const mainProductId = document.getElementById('editMainProductId').value;
      
      if (confirm('Are you sure you want to remove all similar product links?')) {
        const similarProductsRef = database.ref('similarProducts');
        
        similarProductsRef.child(mainProductId).remove()
          .then(() => {
            // Close modal
            document.getElementById('editSimilarProductsModal').classList.remove('active');
            
            // Refresh similar products list
            loadSimilarProducts();
            
            alert('Similar products removed successfully!');
          })
          .catch(error => {
            console.error('Error removing similar products:', error);
            alert('Error removing similar products');
          });
      }
    }

    // Edit category
    function editCategory(categoryId) {
      // Implementation for edit category
      alert('Edit category functionality would be implemented here');
    }

    // Delete category confirmation
    function deleteCategoryConfirm(categoryId) {
      if (confirm('Are you sure you want to delete this category? This action cannot be undone.')) {
        deleteCategory(categoryId);
      }
    }

    // Delete category
    function deleteCategory(categoryId) {
      const categoriesRef = database.ref('categories');
      
      categoriesRef.child(categoryId).remove()
        .then(() => {
          // Remove from local array
          allCategories = allCategories.filter(cat => cat.id !== categoryId);
          
          // Update dropdowns
          updateCategoryDropdowns();
          
          loadCategories();
          alert('Category deleted successfully!');
        })
        .catch(error => {
          console.error('Error deleting category:', error);
          alert('Error deleting category');
        });
    }

    // Edit banner
    function editBanner(bannerId) {
      // Implementation for edit banner
      alert('Edit banner functionality would be implemented here');
    }

    // Delete banner confirmation
    function deleteBannerConfirm(bannerId) {
      if (confirm('Are you sure you want to delete this banner? This action cannot be undone.')) {
        deleteBanner(bannerId);
      }
    }

    // Delete banner
    function deleteBanner(bannerId) {
      const bannersRef = database.ref('banners');
      
      bannersRef.child(bannerId).remove()
        .then(() => {
          loadBanners();
          alert('Banner deleted successfully!');
        })
        .catch(error => {
          console.error('Error deleting banner:', error);
          alert('Error deleting banner');
        });
    }

    // Export orders
    function exportOrders() {
      const ordersRef = database.ref('orders');
      const productsRef = database.ref('products');
      
      Promise.all([
        new Promise(resolve => ordersRef.once('value', snapshot => resolve(snapshot.val()))),
        new Promise(resolve => productsRef.once('value', snapshot => resolve(snapshot.val())))
      ]).then(([ordersData, productsData]) => {
        let orders = [];
        let products = [];
        
        if (ordersData) {
          orders = Object.values(ordersData);
        }
        
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
        }
        
        if (orders.length === 0) {
          alert('No orders to export');
          return;
        }
        
        // Create CSV content
        let csv = 'Order ID,Customer,Product,Quantity,Amount,Status,Date\n';
        
        orders.forEach(order => {
          const product = products.find(p => p.id === order.productId);
          csv += `"${order.id || 'N/A'}","${order.fullname || 'N/A'}","${product ? product.title : 'Unknown'}","${order.qty || 1}","${product ? product.price * (order.qty || 1) : 'N/A'}","${order.status || 'Pending'}","${order.timestamp ? new Date(order.timestamp).toLocaleDateString() : 'N/A'}"\n`;
        });
        
        // Create download link
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `buyzo_orders_${new Date().toISOString().slice(0, 10)}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }).catch(error => {
        console.error('Error exporting orders:', error);
        alert('Error exporting orders');
      });
    }

    // Export customers
    function exportCustomers() {
      const ordersRef = database.ref('orders');
      ordersRef.once('value', snapshot => {
        const ordersData = snapshot.val();
        let orders = [];
        
        if (ordersData) {
          orders = Object.values(ordersData);
        }
        
        if (orders.length === 0) {
          alert('No customer data to export');
          return;
        }
        
        // Extract unique customers based on mobile number
        const customersMap = {};
        orders.forEach(order => {
          if (order.mobile && !customersMap[order.mobile]) {
            customersMap[order.mobile] = {
              name: order.fullname || 'Unknown',
              mobile: order.mobile,
              email: order.email || 'N/A',
              location: `${order.city || ''}, ${order.state || ''}`,
              orderCount: 1
            };
          } else if (order.mobile) {
            customersMap[order.mobile].orderCount++;
          }
        });
        
        const customers = Object.values(customersMap);
        
        // Create CSV content
        let csv = 'Name,Mobile,Email,Location,Orders\n';
        
        customers.forEach(customer => {
          csv += `"${customer.name}","${customer.mobile}","${customer.email}","${customer.location}","${customer.orderCount}"\n`;
        });
        
        // Create download link
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `buyzo_customers_${new Date().toISOString().slice(0, 10)}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }).catch(error => {
        console.error('Error exporting customers:', error);
        alert('Error exporting customers');
      });
    }

    // Update pagination
    function updatePagination(elementId, currentPage, totalPages, type) {
      const pagination = document.getElementById(elementId);
      
      if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }
      
      let html = '';
      
      // Previous button
      if (currentPage > 1) {
        html += `<div class="page-item" onclick="changePage('${type}', ${currentPage - 1})">&laquo;</div>`;
      }
      
      // Page numbers
      const startPage = Math.max(1, currentPage - 2);
      const endPage = Math.min(totalPages, startPage + 4);
      
      for (let i = startPage; i <= endPage; i++) {
        html += `<div class="page-item ${i === currentPage ? 'active' : ''}" onclick="changePage('${type}', ${i})">${i}</div>`;
      }
      
      // Next button
      if (currentPage < totalPages) {
        html += `<div class="page-item" onclick="changePage('${type}', ${currentPage + 1})">&raquo;</div>`;
      }
      
      pagination.innerHTML = html;
    }

    // Change page
    function changePage(type, page) {
      if (type === 'products') {
        currentProductsPage = page;
        loadProducts();
      } else if (type === 'orders') {
        currentOrdersPage = page;
        loadOrders();
      } else if (type === 'customers') {
        currentCustomersPage = page;
        loadCustomers();
      } else if (type === 'similar-products') {
        currentSimilarProductsPage = page;
        loadSimilarProducts();
      }
      
      // Scroll to top
      window.scrollTo(0, 0);
    }

    // Initialize when page loads
    window.addEventListener('DOMContentLoaded', initAdminPanel);
  </script>
</body>
</html>