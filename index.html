<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buyzo Cart - Admin Panel v2.0</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #64748b;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --light: #f8fafc;
      --dark: #0f172a;
      --sidebar-width: 280px;
      --header-height: 70px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: #f1f5f9;
      color: #334155;
      display: flex;
      min-height: 100vh;
    }

    /* Login Styles */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      width: 100%;
    }

    .login-card {
      background: white;
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
      width: 100%;
      max-width: 400px;
      animation: fadeIn 0.5s ease;
    }

    .login-logo {
      text-align: center;
      margin-bottom: 32px;
    }

    .login-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--dark);
    }

    .login-subtitle {
      color: var(--secondary);
      margin-bottom: 24px;
    }

    /* Sidebar Styles */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--dark);
      color: white;
      height: 100vh;
      position: fixed;
      transition: all 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid #334155;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sidebar-header h2 {
      font-size: 1.5rem;
    }

    .sidebar-menu {
      padding: 15px 0;
      list-style: none;
    }

    .menu-item {
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      border-left: 3px solid transparent;
      text-decoration: none;
      color: #94a3b8;
    }

    .menu-item:hover {
      background-color: #1e293b;
      color: white;
    }

    .menu-item.active {
      background-color: #1e293b;
      border-left-color: var(--primary);
      color: white;
    }

    .menu-item i {
      width: 20px;
      text-align: center;
    }

    .sidebar-close {
      display: none;
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 24px;
      color: #94a3b8;
      cursor: pointer;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      transition: all 0.3s ease;
    }

    /* Header */
    .header {
      height: var(--header-height);
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 30px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .menu-toggle {
      display: none;
      background: var(--primary);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
    }

    .header-left h1 {
      font-size: 1.8rem;
      color: var(--dark);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    /* Content Area */
    .content {
      padding: 30px;
    }

    /* Dashboard Stats */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      display: flex;
      align-items: center;
      gap: 15px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
    }

    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: white;
    }

    .stat-info h3 {
      font-size: 1.8rem;
      margin-bottom: 5px;
    }

    .stat-info p {
      color: var(--secondary);
      font-size: 0.9rem;
    }

    /* Search Tags Section */
    .search-tags-section {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .search-tags-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .tags-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .tag-item {
      background: #f1f5f9;
      padding: 8px 16px;
      border-radius: 30px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .tag-item .remove-tag {
      color: var(--danger);
      cursor: pointer;
      font-size: 16px;
    }

    .popular-search-item {
      background: #f1f5f9;
      padding: 8px 16px;
      border-radius: 30px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .earnings-section {
      margin-bottom: 24px;
    }

    .earnings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .earnings-title {
      font-size: 18px;
      font-weight: 600;
    }

    .earnings-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
    }

    .earnings-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .earnings-value {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .earnings-label {
      color: var(--secondary);
      font-size: 14px;
      margin-bottom: 12px;
    }

    .earnings-comparison {
      display: flex;
      align-items: center;
      font-size: 14px;
    }

    .earnings-trend {
      display: flex;
      align-items: center;
      margin-right: 8px;
    }

    .trend-up {
      color: var(--success);
    }

    .trend-down {
      color: var(--danger);
    }

    /* Tables */
    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      margin-bottom: 30px;
      overflow: hidden;
    }

    .card-header {
      padding: 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-header h2 {
      font-size: 1.3rem;
    }

    .card-body {
      padding: 20px;
    }

    .table-responsive {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }

    th {
      background-color: #f8fafc;
      font-weight: 600;
      color: var(--dark);
    }

    tr:hover {
      background-color: #f8fafc;
    }

    .product-image {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 4px;
      border: 1px solid #e2e8f0;
    }

    /* Buttons */
    .btn {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: all 0.2s ease;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-warning {
      background: var(--warning);
      color: white;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 0.85rem;
    }

    /* Forms */
    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .form-control {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.2s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .form-row {
      display: flex;
      gap: 15px;
    }

    .form-row .form-group {
      flex: 1;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      padding: 20px;
      border-top: 1px solid #e2e8f0;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--secondary);
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid #e2e8f0;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .tab {
      padding: 12px 20px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease;
    }

    .tab.active {
      border-bottom-color: var(--primary);
      color: var(--primary);
      font-weight: 500;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Status Badges */
    .badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge-success {
      background: #dcfce7;
      color: #166534;
    }

    .badge-warning {
      background: #fef3c7;
      color: #92400e;
    }

    .badge-danger {
      background: #fee2e2;
      color: #991b1b;
    }

    .badge-info {
      background: #dbeafe;
      color: #1e40af;
    }

    /* Search and Filters */
    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .search-box input {
      flex: 1;
    }

    /* Alert Messages */
    .alert {
      padding: 12px 15px;
      border-radius: 6px;
      margin-bottom: 20px;
    }

    .alert-success {
      background: #dcfce7;
      color: #166534;
      border: 1px solid #bbf7d0;
    }

    .alert-error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fecaca;
    }

    /* Bulk Actions */
    .bulk-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      gap: 5px;
      flex-wrap: wrap;
    }

    .page-item {
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      cursor: pointer;
    }

    .page-item.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* Checkbox */
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 15px;
    }

    .checkbox-group input {
      width: auto;
    }

    /* Mobile Overlay */
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }

    .sidebar-overlay.active {
      display: block;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
        width: 280px;
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .menu-toggle {
        display: flex;
      }
      
      .sidebar-close {
        display: block;
      }

      .sidebar-overlay.active {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .header {
        padding: 0 15px;
      }

      .content {
        padding: 15px;
      }

      .stats-container {
        grid-template-columns: 1fr;
      }

      .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .earnings-cards {
        grid-template-columns: 1fr;
      }

      .tabs {
        flex-wrap: nowrap;
        overflow-x: auto;
      }

      .tab {
        white-space: nowrap;
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.5s ease;
    }

    /* Order Details Modal Styles */
    .order-details-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 20px;
    }

    .order-detail-item {
      padding: 12px;
      background: #f8fafc;
      border-radius: 6px;
    }

    .order-detail-label {
      font-size: 12px;
      color: var(--secondary);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .order-detail-value {
      font-size: 16px;
      font-weight: 600;
      color: var(--dark);
    }

    .order-detail-value.address {
      font-size: 14px;
      font-weight: 400;
      line-height: 1.5;
    }

    .order-products-table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
    }

    .order-products-table th {
      background: #f1f5f9;
      font-size: 13px;
      padding: 8px;
    }

    .order-products-table td {
      padding: 8px;
      border-bottom: 1px solid #e2e8f0;
    }

    .order-total-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-top: 2px solid #e2e8f0;
      margin-top: 12px;
      font-weight: 600;
    }

    .order-total-label {
      font-size: 16px;
    }

    .order-total-value {
      font-size: 18px;
      color: var(--primary);
    }

    .order-status-timeline {
      display: flex;
      justify-content: space-between;
      margin: 24px 0 16px;
      padding: 0 8px;
    }

    .status-step {
      flex: 1;
      text-align: center;
      position: relative;
    }

    .status-step:not(:last-child):before {
      content: '';
      position: absolute;
      top: 15px;
      right: -50%;
      width: 100%;
      height: 2px;
      background: #e2e8f0;
      z-index: 0;
    }

    .status-step.completed:not(:last-child):before {
      background: var(--success);
    }

    .status-icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #f1f5f9;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 8px;
      position: relative;
      z-index: 1;
    }

    .status-step.completed .status-icon {
      background: var(--success);
      color: white;
    }

    .status-step.active .status-icon {
      background: var(--primary);
      color: white;
    }

    .status-label {
      font-size: 12px;
      font-weight: 500;
    }

    .date-filter-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .date-filter-buttons .btn {
      min-width: 100px;
      justify-content: center;
    }

    .btn-outline {
      background: white;
      border: 1px solid var(--primary);
      color: var(--primary);
    }

    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }

    .btn-outline.active {
      background: var(--primary);
      color: white;
    }

    .date-range {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .date-input-group {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
      min-width: 250px;
    }

    .date-input-group label {
      margin-bottom: 0;
      white-space: nowrap;
    }

    .date-input-group input {
      flex: 1;
    }

    /* Image Preview */
    .image-preview-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .image-preview-item {
      position: relative;
      width: 80px;
      height: 80px;
    }

    .image-preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 4px;
      border: 1px solid #e2e8f0;
    }

    .image-preview-item .remove-image {
      position: absolute;
      top: -5px;
      right: -5px;
      width: 20px;
      height: 20px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      cursor: pointer;
    }

    /* Loading Spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <!-- Admin Login Page -->
  <div id="adminLoginPage" class="login-container">
    <div class="login-card">
      <div class="login-logo">
        <h1 class="login-title">Buyzo Cart</h1>
        <p class="login-subtitle">Admin Panel v2.0</p>
      </div>
      
      <div class="form-group">
        <label for="adminEmail">Email</label>
        <input type="email" id="adminEmail" placeholder="admin@buyzo.com" class="form-control">
      </div>
      
      <div class="form-group">
        <label for="adminPassword">Password</label>
        <input type="password" id="adminPassword" placeholder="Enter your password" class="form-control">
      </div>
      
      <div class="checkbox-group">
        <input type="checkbox" id="rememberMe">
        <label for="rememberMe">Remember me</label>
      </div>
      
      <button class="btn btn-primary" style="width: 100%" onclick="adminLogin()">Login</button>
    </div>
  </div>

  <!-- Sidebar Overlay (for mobile) -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

  <!-- Admin Panel -->
  <div id="adminPanel" style="display: none">
    <!-- Sidebar -->
    <div class="sidebar" id="adminSidebar">
      <div class="sidebar-header">
        <i class="fas fa-shopping-cart"></i>
        <h2>Buyzo Admin</h2>
        <button class="sidebar-close" onclick="toggleSidebar()">&times;</button>
      </div>
      <ul class="sidebar-menu">
        <li><a href="#" class="menu-item active" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li>
        <li><a href="#" class="menu-item" data-tab="products"><i class="fas fa-box"></i><span>Products</span></a></li>
        <li><a href="#" class="menu-item" data-tab="categories"><i class="fas fa-tags"></i><span>Categories</span></a></li>
        <li><a href="#" class="menu-item" data-tab="orders"><i class="fas fa-shopping-bag"></i><span>Orders</span></a></li>
        <li><a href="#" class="menu-item" data-tab="trending"><i class="fas fa-fire"></i><span>Trending Products</span></a></li>
        <li><a href="#" class="menu-item" data-tab="similar-products"><i class="fas fa-random"></i><span>Similar Products</span></a></li>
        <li><a href="#" class="menu-item" data-tab="search-tags"><i class="fas fa-search"></i><span>Search Tags</span></a></li>
        <li><a href="#" class="menu-item" data-tab="popular-searches"><i class="fas fa-chart-line"></i><span>Popular Searches</span></a></li>
        <li><a href="#" class="menu-item" data-tab="customers"><i class="fas fa-users"></i><span>Customers</span></a></li>
        <li><a href="#" class="menu-item" data-tab="banners"><i class="fas fa-image"></i><span>Banners</span></a></li>
        <li><a href="#" class="menu-item" data-tab="policies"><i class="fas fa-file-alt"></i><span>Policies</span></a></li>
        <li><a href="#" class="menu-item" data-tab="settings"><i class="fas fa-cog"></i><span>Settings</span></a></li>
        <li><a href="#" class="menu-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a></li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Header -->
      <div class="header">
        <div class="header-left">
          <button class="menu-toggle" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
          </button>
          <h1 id="adminPageTitle">Dashboard</h1>
        </div>
        <div class="header-right">
          <div class="user-profile">
            <div class="user-avatar">A</div>
            <div>Admin User</div>
          </div>
        </div>
      </div>

      <!-- Content Area -->
      <div class="content">
        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
          <div class="stats-container">
            <div class="stat-card">
              <div class="stat-icon" style="background: var(--primary);">
                <i class="fas fa-box"></i>
              </div>
              <div class="stat-info">
                <h3 id="totalProducts">0</h3>
                <p>Total Products</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background: var(--success);">
                <i class="fas fa-shopping-cart"></i>
              </div>
              <div class="stat-info">
                <h3 id="totalOrders">0</h3>
                <p>Total Orders</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background: var(--warning);">
                <i class="fas fa-clock"></i>
              </div>
              <div class="stat-info">
                <h3 id="pendingOrders">0</h3>
                <p>Pending Orders</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background: var(--danger);">
                <i class="fas fa-fire"></i>
              </div>
              <div class="stat-info">
                <h3 id="trendingProducts">0</h3>
                <p>Trending Products</p>
              </div>
            </div>
          </div>

          <!-- Search Tags Overview -->
          <div class="search-tags-section">
            <div class="search-tags-header">
              <h3>Search Tags Overview</h3>
              <button class="btn btn-primary" onclick="showTab('search-tags')">
                <i class="fas fa-edit"></i> Manage Tags
              </button>
            </div>
            <div id="dashboardSearchTags" class="tags-container">
              <!-- Will be populated by JavaScript -->
            </div>
          </div>

          <!-- Popular Searches Overview -->
          <div class="search-tags-section">
            <div class="search-tags-header">
              <h3>Popular Searches Overview</h3>
              <button class="btn btn-primary" onclick="showTab('popular-searches')">
                <i class="fas fa-edit"></i> Manage Searches
              </button>
            </div>
            <div id="dashboardPopularSearches" class="tags-container">
              <!-- Will be populated by JavaScript -->
            </div>
          </div>

          <!-- Earnings Section -->
          <div class="earnings-section">
            <div class="earnings-header">
              <h2 class="earnings-title">Revenue & Earnings</h2>
            </div>
            <div class="earnings-cards">
              <div class="earnings-card">
                <div class="earnings-value" id="totalEarnings">₹0</div>
                <div class="earnings-label">Total Earnings</div>
                <div class="earnings-comparison">
                  <span class="earnings-trend" id="totalEarningsTrend">
                    <i class="fas fa-caret-up trend-up"></i>
                    <span>0%</span>
                  </span>
                  <span>vs lifetime</span>
                </div>
              </div>
              
              <div class="earnings-card">
                <div class="earnings-value" id="lastWeekEarnings">₹0</div>
                <div class="earnings-label">Last Week Earnings</div>
                <div class="earnings-comparison">
                  <span class="earnings-trend" id="lastWeekTrend">
                    <i class="fas fa-caret-up trend-up"></i>
                    <span>0%</span>
                  </span>
                  <span>vs previous week</span>
                </div>
              </div>
              
              <div class="earnings-card">
                <div class="earnings-value" id="lastMonthEarnings">₹0</div>
                <div class="earnings-label">Last Month Earnings</div>
                <div class="earnings-comparison">
                  <span class="earnings-trend" id="lastMonthTrend">
                    <i class="fas fa-caret-up trend-up"></i>
                    <span>0%</span>
                  </span>
                  <span>vs previous month</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h2>Recent Orders</h2>
              <button class="btn btn-primary" onclick="showTab('orders')">View All</button>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table id="recentOrdersTable">
                  <thead>
                    <tr>
                      <th>Order ID</th>
                      <th>Customer</th>
                      <th>Product</th>
                      <th>Amount</th>
                      <th>Status</th>
                      <th>Date</th>
                    </tr>
                  </thead>
                  <tbody id="recentOrders">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Products Tab -->
        <div class="tab-content" id="products">
          <div class="card">
            <div class="card-header">
              <h2>Product Management</h2>
              <button class="btn btn-primary" onclick="showAddProductModal()"><i class="fas fa-plus"></i> Add Product</button>
            </div>
            <div class="card-body">
              <div class="search-box">
                <input type="text" class="form-control" id="productSearch" placeholder="Search products...">
                <button class="btn btn-primary" onclick="filterProducts()">Search</button>
              </div>
              <div class="table-responsive">
                <table id="productsTable">
                  <thead>
                    <tr>
                      <th>Image</th>
                      <th>Name</th>
                      <th>Category</th>
                      <th>Price</th>
                      <th>Stock</th>
                      <th>Trending</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="productsTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
              <div class="pagination" id="productsPagination"></div>
            </div>
          </div>
        </div>
        
        <!-- Categories Tab -->
        <div class="tab-content" id="categories">
          <div class="card">
            <div class="card-header">
              <h2>Category Management</h2>
              <button class="btn btn-primary" onclick="showAddCategoryModal()"><i class="fas fa-plus"></i> Add Category</button>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table id="categoriesTable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Image</th>
                      <th>Category Name</th>
                      <th>Description</th>
                      <th>Products</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="categoriesTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Orders Tab -->
        <div class="tab-content" id="orders">
          <div class="card">
            <div class="card-header">
              <h2>Order Management</h2>
              <button class="btn btn-primary" onclick="exportOrders()"><i class="fas fa-download"></i> Export</button>
            </div>
            <div class="card-body">
              <!-- Date Filter Section -->
              <div class="date-filter-buttons">
                <button class="btn btn-outline active" onclick="filterOrdersByDate('all', this)">All Orders</button>
                <button class="btn btn-outline" onclick="filterOrdersByDate('today', this)">Today</button>
                <button class="btn btn-outline" onclick="filterOrdersByDate('tomorrow', this)">Tomorrow</button>
              </div>
              
              <div class="date-range">
                <div class="date-input-group">
                  <label for="startDate">From:</label>
                  <input type="date" id="startDate" class="form-control">
                </div>
                <div class="date-input-group">
                  <label for="endDate">To:</label>
                  <input type="date" id="endDate" class="form-control">
                </div>
                <button class="btn btn-primary" onclick="filterOrdersByCustomDate()">Apply</button>
                <button class="btn btn-secondary" onclick="clearDateFilter()">Clear</button>
              </div>
              
              <div class="search-box">
                <input type="text" class="form-control" id="orderSearch" placeholder="Search orders...">
                <button class="btn btn-primary" onclick="filterOrders()">Search</button>
              </div>
              
              <div class="table-responsive">
                <table id="ordersTable">
                  <thead>
                    <tr>
                      <th><input type="checkbox" id="selectAllOrders"></th>
                      <th>Order ID</th>
                      <th>Customer</th>
                      <th>Product</th>
                      <th>Amount</th>
                      <th>Status</th>
                      <th>Date</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="ordersTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
              <div style="margin-top: 16px">
                <select id="bulkStatusAction" style="width: auto; margin-right: 12px" class="form-control">
                  <option value="">Bulk Action</option>
                  <option value="Confirmed">Mark as Confirmed</option>
                  <option value="Shipped">Mark as Shipped</option>
                  <option value="Delivered">Mark as Delivered</option>
                  <option value="Cancelled">Mark as Cancelled</option>
                </select>
                <button class="btn btn-primary" onclick="applyBulkAction()">Apply</button>
              </div>
              <div class="pagination" id="ordersPagination"></div>
            </div>
          </div>
        </div>
        
        <!-- Trending Tab -->
        <div class="tab-content" id="trending">
          <div class="card">
            <div class="card-header">
              <h2>Trending Products Control</h2>
            </div>
            <div class="card-body">
              <p style="margin-bottom: 16px">Select products to feature in the "Trending Now" section on the website.</p>
              <div class="table-responsive">
                <table id="trendingTable">
                  <thead>
                    <tr>
                      <th>Image</th>
                      <th>Name</th>
                      <th>Price</th>
                      <th>Trending</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="trendingTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Similar Products Tab -->
        <div class="tab-content" id="similar-products">
          <div class="card">
            <div class="card-header">
              <h2>Similar Products Management</h2>
              <button class="btn btn-primary" onclick="showAddSimilarProductsModal()">
                <i class="fas fa-plus"></i> Link Similar Products
              </button>
            </div>
            <div class="card-body">
              <div class="search-box">
                <input type="text" class="form-control" id="similarProductsSearch" placeholder="Search main product...">
                <button class="btn btn-primary" onclick="filterSimilarProducts()">Search</button>
              </div>
              <div class="table-responsive">
                <table id="similarProductsTable">
                  <thead>
                    <tr>
                      <th>Main Product</th>
                      <th>Main Product Image</th>
                      <th>Similar Products Count</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="similarProductsTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
              <div class="pagination" id="similarProductsPagination"></div>
            </div>
          </div>
        </div>
        
        <!-- Search Tags Tab -->
        <div class="tab-content" id="search-tags">
          <div class="card">
            <div class="card-header">
              <h2>Search Tags Management</h2>
              <button class="btn btn-primary" onclick="showAddSearchTagModal()"><i class="fas fa-plus"></i> Add Search Tag</button>
            </div>
            <div class="card-body">
              <p style="margin-bottom: 16px; color: var(--secondary);">
                Search tags appear as clickable suggestions when users search on the website.
              </p>
              
              <div class="search-tags-section" style="background: none; padding: 0;">
                <div class="form-group">
                  <label>Current Search Tags</label>
                  <div id="searchTagsList" class="tags-container">
                    <!-- Will be populated by JavaScript -->
                  </div>
                </div>
                
                <div class="form-group">
                  <label>Bulk Add Tags</label>
                  <div class="form-row">
                    <div class="form-group" style="margin-bottom: 0;">
                      <textarea id="bulkSearchTags" class="form-control" rows="3" placeholder="Enter tags separated by commas..."></textarea>
                    </div>
                    <div>
                      <button class="btn btn-primary" onclick="bulkAddSearchTags()">Add All</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Popular Searches Tab -->
        <div class="tab-content" id="popular-searches">
          <div class="card">
            <div class="card-header">
              <h2>Popular Searches Management</h2>
              <button class="btn btn-primary" onclick="showAddPopularSearchModal()"><i class="fas fa-plus"></i> Add Popular Search</button>
            </div>
            <div class="card-body">
              <p style="margin-bottom: 16px; color: var(--secondary);">
                Popular searches appear in the search panel and help users discover trending products.
              </p>
              
              <div class="search-tags-section" style="background: none; padding: 0;">
                <div class="form-group">
                  <label>Current Popular Searches</label>
                  <div id="popularSearchesList" class="tags-container">
                    <!-- Will be populated by JavaScript -->
                  </div>
                </div>
                
                <div class="form-group">
                  <label>Bulk Add Searches</label>
                  <div class="form-row">
                    <div class="form-group" style="margin-bottom: 0;">
                      <textarea id="bulkPopularSearches" class="form-control" rows="3" placeholder="Enter searches separated by commas..."></textarea>
                    </div>
                    <div>
                      <button class="btn btn-primary" onclick="bulkAddPopularSearches()">Add All</button>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label>Auto-generate from Products</label>
                  <button class="btn btn-success" onclick="generatePopularSearchesFromProducts()">
                    <i class="fas fa-magic"></i> Generate from Top Products
                  </button>
                  <p style="margin-top: 8px; font-size: 12px; color: var(--secondary);">
                    This will add popular product names and categories as popular searches.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Customers Tab -->
        <div class="tab-content" id="customers">
          <div class="card">
            <div class="card-header">
              <h2>Customer Data</h2>
              <button class="btn btn-primary" onclick="exportCustomers()"><i class="fas fa-download"></i> Export CSV</button>
            </div>
            <div class="card-body">
              <div class="search-box">
                <input type="text" class="form-control" id="customerSearch" placeholder="Search customers...">
                <button class="btn btn-primary" onclick="filterCustomers()">Search</button>
              </div>
              <div class="table-responsive">
                <table id="customersTable">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Mobile</th>
                      <th>Email</th>
                      <th>Location</th>
                      <th>Orders</th>
                      <th>Last Order</th>
                    </tr>
                  </thead>
                  <tbody id="customersTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
              <div class="pagination" id="customersPagination"></div>
            </div>
          </div>
        </div>
        
        <!-- Banners Tab -->
        <div class="tab-content" id="banners">
          <div class="card">
            <div class="card-header">
              <h2>Banner Management</h2>
              <button class="btn btn-primary" onclick="showAddBannerModal()"><i class="fas fa-plus"></i> Add Banner</button>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table id="bannersTable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Banner Image</th>
                      <th>Title</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="bannersTableBody">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Policies Tab -->
        <div class="tab-content" id="policies">
          <div class="card">
            <div class="card-header">
              <h2>Store Policies</h2>
            </div>
            <div class="card-body">
              <div class="tabs">
                <div class="tab active" data-policy="about">About Us</div>
                <div class="tab" data-policy="refund">Refund Policy</div>
                <div class="tab" data-policy="terms">Terms & Conditions</div>
                <div class="tab" data-policy="shipping">Shipping Policy</div>
                <div class="tab" data-policy="privacy">Privacy Policy</div>
              </div>
              
              <div class="policy-content active" data-policy="about">
                <h3>About Us Page Content</h3>
                <textarea id="aboutContent" rows="10" style="width: 100%; margin-top: 16px" class="form-control"></textarea>
                <button class="btn btn-primary" style="margin-top: 16px" onclick="savePolicy('about')">Save Changes</button>
              </div>
              
              <div class="policy-content" data-policy="refund">
                <h3>Refund Policy Content</h3>
                <textarea id="refundContent" rows="10" style="width: 100%; margin-top: 16px" class="form-control"></textarea>
                <button class="btn btn-primary" style="margin-top: 16px" onclick="savePolicy('refund')">Save Changes</button>
              </div>
              
              <div class="policy-content" data-policy="terms">
                <h3>Terms & Conditions Content</h3>
                <textarea id="termsContent" rows="10" style="width: 100%; margin-top: 16px" class="form-control"></textarea>
                <button class="btn btn-primary" style="margin-top: 16px" onclick="savePolicy('terms')">Save Changes</button>
              </div>
              
              <div class="policy-content" data-policy="shipping">
                <h3>Shipping Policy Content</h3>
                <textarea id="shippingContent" rows="10" style="width: 100%; margin-top: 16px" class="form-control"></textarea>
                <button class="btn btn-primary" style="margin-top: 16px" onclick="savePolicy('shipping')">Save Changes</button>
              </div>
              
              <div class="policy-content" data-policy="privacy">
                <h3>Privacy Policy Content</h3>
                <textarea id="privacyContent" rows="10" style="width: 100%; margin-top: 16px" class="form-control"></textarea>
                <button class="btn btn-primary" style="margin-top: 16px" onclick="savePolicy('privacy')">Save Changes</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
          <div class="card">
            <div class="card-header">
              <h2>Store Settings</h2>
            </div>
            <div class="card-body">
              <form id="settingsForm">
                <div class="form-group">
                  <label for="storeName">Store Name</label>
                  <input type="text" id="storeName" class="form-control" value="Buyzo Cart">
                </div>
                
                <div class="form-group">
                  <label for="storeEmail">Store Email</label>
                  <input type="email" id="storeEmail" class="form-control" value="buyzocartshop@gmail.com">
                </div>
                
                <div class="form-group">
                  <label for="storePhone">Store Phone</label>
                  <input type="text" id="storePhone" class="form-control" value="+91 9876543210">
                </div>
                
                <div class="form-group">
                  <label for="storeAddress">Store Address</label>
                  <textarea id="storeAddress" class="form-control" rows="3">Jwalapur, Haridwar, Uttarakhand - 249401, India</textarea>
                </div>
                
                <div class="form-group">
                  <label for="shippingCost">Default Shipping Cost (₹)</label>
                  <input type="number" id="shippingCost" class="form-control" value="50">
                </div>
                
                <div class="form-group">
                  <label for="currency">Currency</label>
                  <select id="currency" class="form-control">
                    <option>Indian Rupee (₹)</option>
                    <option>US Dollar ($)</option>
                    <option>Euro (€)</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="maxItemsPerOrder">Max Items Per Order</label>
                  <input type="number" id="maxItemsPerOrder" class="form-control" value="3">
                </div>
                
                <div class="form-group">
                  <label for="freeShippingThreshold">Free Shipping Above (₹)</label>
                  <input type="number" id="freeShippingThreshold" class="form-control" value="999">
                </div>
                
                <div class="form-group">
                  <label for="paymentGatewayCharge">Payment Gateway Charge (%)</label>
                  <input type="number" id="paymentGatewayCharge" class="form-control" value="2" step="0.1">
                </div>
                
                <button type="submit" class="btn btn-primary">Save Settings</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Product Modal (FIXED) -->
  <div class="modal" id="addProductModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add New Product</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="productName">Product Name *</label>
          <input type="text" id="productName" class="form-control" placeholder="Enter product name">
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="productPrice">Price (₹) *</label>
            <input type="number" id="productPrice" class="form-control" placeholder="Enter price" min="0">
          </div>
          
          <div class="form-group">
            <label for="productStock">Stock Quantity *</label>
            <input type="number" id="productStock" class="form-control" placeholder="Enter stock" min="0">
          </div>
        </div>
        
        <div class="form-group">
          <label for="productCategory">Category *</label>
          <select id="productCategory" class="form-control">
            <option value="">-- Select Category --</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="productDesc">Short Description *</label>
          <input type="text" id="productDesc" class="form-control" placeholder="Enter short description">
        </div>
        
        <div class="form-group">
          <label for="productFullDesc">Full Description</label>
          <textarea id="productFullDesc" class="form-control" placeholder="Enter full description" rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label for="productSizes">Sizes (comma separated)</label>
          <input type="text" id="productSizes" class="form-control" placeholder="S, M, L, XL">
        </div>
        
        <div class="form-group">
          <label>Product Images *</label>
          <input type="file" id="productImages" class="form-control" multiple accept="image/*" onchange="handleProductImageUpload(event)">
          <div class="image-preview-container" id="productImagePreviews"></div>
          <small class="text-muted">You can select multiple images</small>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="productTrending">
          <label for="productTrending">Mark as Trending Product</label>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="productStatus" checked>
          <label for="productStatus">Active Product</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary close">Cancel</button>
        <button class="btn btn-primary" onclick="saveProduct()" id="saveProductBtn">Save Product</button>
      </div>
    </div>
  </div>

  <!-- Add Category Modal -->
  <div class="modal" id="addCategoryModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add New Category</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="categoryName">Category Name *</label>
          <input type="text" id="categoryName" class="form-control" placeholder="Enter category name">
        </div>
        
        <div class="form-group">
          <label for="categoryDescription">Description</label>
          <textarea id="categoryDescription" class="form-control" placeholder="Enter category description" rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label for="categoryImage">Category Image *</label>
          <input type="file" id="categoryImage" class="form-control" accept="image/*" onchange="handleCategoryImageUpload(event)">
          <div class="image-preview" id="categoryImagePreview" style="margin-top: 10px;"></div>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="categoryStatus" checked>
          <label for="categoryStatus">Active Category</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary close">Cancel</button>
        <button class="btn btn-primary" onclick="saveCategory()">Save Category</button>
      </div>
    </div>
  </div>

  <!-- Add Banner Modal -->
  <div class="modal" id="addBannerModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add New Banner</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="bannerTitle">Banner Title *</label>
          <input type="text" id="bannerTitle" class="form-control" placeholder="Enter banner title">
        </div>
        
        <div class="form-group">
          <label for="bannerLink">Banner Link (Optional)</label>
          <input type="url" id="bannerLink" class="form-control" placeholder="https://example.com">
        </div>
        
        <div class="form-group">
          <label for="bannerImage">Banner Image *</label>
          <input type="file" id="bannerImage" class="form-control" accept="image/*" onchange="handleBannerImageUpload(event)">
          <div class="image-preview" id="bannerImagePreview" style="margin-top: 10px;"></div>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="bannerStatus" checked>
          <label for="bannerStatus">Active Banner</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary close">Cancel</button>
        <button class="btn btn-primary" onclick="saveBanner()">Save Banner</button>
      </div>
    </div>
  </div>

  <!-- Add Similar Products Modal -->
  <div class="modal" id="addSimilarProductsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Link Similar Products</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="mainProductSelect">Select Main Product *</label>
          <select id="mainProductSelect" class="form-control" onchange="loadProductDetails(this.value)">
            <option value="">-- Select Product --</option>
          </select>
        </div>
        
        <div class="selected-product-info" id="selectedProductInfo" style="display: none; background: #f8fafc; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 15px;">
            <img id="selectedProductImage" src="" width="60" height="60" style="border-radius: 4px; object-fit: cover;">
            <div>
              <h4 id="selectedProductName" style="margin: 0 0 5px 0;"></h4>
              <p id="selectedProductDetails" style="margin: 0; color: #64748b;"></p>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="similarProductsSelect">Select Similar Products</label>
          <div style="margin-bottom: 10px;">
            <input type="text" id="searchSimilarProducts" class="form-control" placeholder="Search products..." onkeyup="searchProductsForSimilar()">
          </div>
          <select id="similarProductsSelect" class="form-control" multiple style="height: 200px;"></select>
          <small class="text-muted">Hold Ctrl/Cmd to select multiple products</small>
        </div>
        
        <div class="selected-similar-products" id="selectedSimilarProductsPreview"></div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="autoSuggestSimilar" checked>
          <label for="autoSuggestSimilar">Auto-suggest similar products (by category)</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary close">Cancel</button>
        <button class="btn btn-primary" onclick="saveSimilarProducts()">Save Similar Products</button>
      </div>
    </div>
  </div>

  <!-- Edit Product Modal -->
  <div class="modal" id="editProductModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Product</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editProductId">
        
        <div class="form-group">
          <label for="editProductName">Product Name</label>
          <input type="text" id="editProductName" class="form-control">
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="editProductPrice">Price (₹)</label>
            <input type="number" id="editProductPrice" class="form-control">
          </div>
          
          <div class="form-group">
            <label for="editProductStock">Stock Quantity</label>
            <input type="number" id="editProductStock" class="form-control">
          </div>
        </div>
        
        <div class="form-group">
          <label for="editProductCategory">Category</label>
          <select id="editProductCategory" class="form-control">
            <option value="">-- Select Category --</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="editProductDesc">Short Description</label>
          <input type="text" id="editProductDesc" class="form-control">
        </div>
        
        <div class="form-group">
          <label for="editProductFullDesc">Full Description</label>
          <textarea id="editProductFullDesc" class="form-control" rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label for="editProductSizes">Sizes (comma separated)</label>
          <input type="text" id="editProductSizes" class="form-control" placeholder="S, M, L, XL">
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="editProductTrending">
          <label for="editProductTrending">Mark as Trending Product</label>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="editProductStatus">
          <label for="editProductStatus">Active Product</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" onclick="deleteProductConfirm()">Delete Product</button>
        <button class="btn btn-primary" onclick="updateProduct()">Update Product</button>
      </div>
    </div>
  </div>

  <!-- Edit Similar Products Modal -->
  <div class="modal" id="editSimilarProductsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Similar Products</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editMainProductId">
        
        <div class="selected-product-info" id="editProductInfo" style="background: #f8fafc; padding: 15px; border-radius: 6px; margin-bottom: 20px;"></div>
        
        <div class="form-group">
          <label for="editSimilarProductsSelect">Similar Products</label>
          <div style="margin-bottom: 10px;">
            <input type="text" id="editSearchSimilarProducts" class="form-control" placeholder="Search products..." onkeyup="editSearchProductsForSimilar()">
          </div>
          <select id="editSimilarProductsSelect" class="form-control" multiple style="height: 200px;"></select>
          <small class="text-muted">Hold Ctrl/Cmd to select multiple products</small>
        </div>
        
        <div class="selected-similar-products" id="editSelectedSimilarProductsPreview"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" onclick="deleteSimilarProducts()">Remove All Links</button>
        <button class="btn btn-primary" onclick="updateSimilarProducts()">Update Similar Products</button>
      </div>
    </div>
  </div>

  <!-- Add Search Tag Modal -->
  <div class="modal" id="addSearchTagModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add Search Tag</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="searchTagName">Tag Name *</label>
          <input type="text" id="searchTagName" class="form-control" placeholder="e.g., Summer Collection">
        </div>
        
        <div class="form-group">
          <label for="searchTagType">Tag Type</label>
          <select id="searchTagType" class="form-control">
            <option value="trending">Trending</option>
            <option value="seasonal">Seasonal</option>
            <option value="category">Category</option>
            <option value="brand">Brand</option>
          </select>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="searchTagActive" checked>
          <label for="searchTagActive">Active Tag</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary close">Cancel</button>
        <button class="btn btn-primary" onclick="saveSearchTag()">Save Tag</button>
      </div>
    </div>
  </div>

  <!-- Add Popular Search Modal -->
  <div class="modal" id="addPopularSearchModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add Popular Search</h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="popularSearchTerm">Search Term *</label>
          <input type="text" id="popularSearchTerm" class="form-control" placeholder="e.g., T-Shirt">
        </div>
        
        <div class="form-group">
          <label for="popularSearchCount">Search Count</label>
          <input type="number" id="popularSearchCount" class="form-control" value="1" min="1">
          <small class="text-muted">Number of times this term has been searched</small>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="popularSearchActive" checked>
          <label for="popularSearchActive">Active</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary close">Cancel</button>
        <button class="btn btn-primary" onclick="savePopularSearch()">Save Search</button>
      </div>
    </div>
  </div>

  <!-- Order Details Modal -->
  <div class="modal" id="orderDetailsModal">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h3>Order Details <span id="orderDetailsId"></span></h3>
        <button class="close">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Status Timeline -->
        <div class="order-status-timeline" id="orderStatusTimeline">
          <!-- Will be populated by JavaScript -->
        </div>
        
        <div class="order-details-grid">
          <div class="order-detail-item">
            <div class="order-detail-label">Customer Name</div>
            <div class="order-detail-value" id="orderDetailsName"></div>
          </div>
          <div class="order-detail-item">
            <div class="order-detail-label">Mobile Number</div>
            <div class="order-detail-value" id="orderDetailsMobile"></div>
          </div>
          <div class="order-detail-item">
            <div class="order-detail-label">Email</div>
            <div class="order-detail-value" id="orderDetailsEmail"></div>
          </div>
          <div class="order-detail-item">
            <div class="order-detail-label">Order Date</div>
            <div class="order-detail-value" id="orderDetailsDate"></div>
          </div>
          <div class="order-detail-item" style="grid-column: span 2;">
            <div class="order-detail-label">Shipping Address</div>
            <div class="order-detail-value address" id="orderDetailsAddress"></div>
          </div>
        </div>
        
        <h4 style="margin: 20px 0 10px;">Order Items</h4>
        <table class="order-products-table" id="orderProductsTable">
          <thead>
            <tr>
              <th>Product</th>
              <th>Price</th>
              <th>Quantity</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody id="orderProductsBody">
            <!-- Will be populated by JavaScript -->
          </tbody>
        </table>
        
        <div class="order-total-row">
          <span class="order-total-label">Subtotal:</span>
          <span class="order-total-value" id="orderSubtotal"></span>
        </div>
        <div class="order-total-row">
          <span class="order-total-label">Shipping:</span>
          <span class="order-total-value" id="orderShipping"></span>
        </div>
        <div class="order-total-row">
          <span class="order-total-label">Total Amount:</span>
          <span class="order-total-value" id="orderTotal"></span>
        </div>
        
        <div style="margin-top: 20px;">
          <label for="orderDetailsStatus">Update Status:</label>
          <select id="orderDetailsStatus" class="form-control" style="width: auto; margin-top: 5px;" onchange="updateOrderStatusFromDetails()">
            <option value="Pending">Pending</option>
            <option value="Confirmed">Confirmed</option>
            <option value="Shipped">Shipped</option>
            <option value="Delivered">Delivered</option>
            <option value="Cancelled">Cancelled</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="printOrderDetails()"><i class="fas fa-print"></i> Print</button>
        <button class="btn btn-secondary close">Close</button>
      </div>
    </div>
  </div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCHFUx3Y1L3mvyLyDMHVKQE6eXi50_fewE",
      authDomain: "buyzocart.firebaseapp.com",
      databaseURL: "https://buyzocart-default-rtdb.firebaseio.com",
      projectId: "buyzocart",
      storageBucket: "buyzocart.firebasestorage.app",
      messagingSenderId: "640560737762",
      appId: "1:640560737762:web:7fe368df6486d6da759dbb"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const storage = firebase.storage();

    // Admin State
    let currentAdminTab = 'dashboard';
    let currentProductsPage = 1;
    let currentOrdersPage = 1;
    let currentCustomersPage = 1;
    let currentSimilarProductsPage = 1;
    let productsPerPage = 10;
    let ordersPerPage = 10;
    let customersPerPage = 10;
    let similarProductsPerPage = 10;
    let uploadedImages = [];
    let uploadedCategoryImage = null;
    let uploadedBannerImage = null;
    
    // Global Arrays
    let allCategories = [];
    let allProductsForSimilar = [];
    let allSearchTags = [];
    let allPopularSearches = [];
    
    // Date Filter State
    let currentDateFilter = {
      type: 'all', // 'all', 'today', 'tomorrow', 'custom'
      startDate: null,
      endDate: null
    };

    // Initialize admin panel
    function initAdminPanel() {
      // Check if user is logged in
      const isLoggedIn = localStorage.getItem('admin_logged_in') === 'true' || sessionStorage.getItem('admin_logged_in') === 'true';
      
      if (isLoggedIn) {
        document.getElementById('adminLoginPage').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadDashboardData();
        loadProducts();
        loadCategories();
        loadOrders();
        loadTrendingProducts();
        loadSimilarProducts();
        loadSearchTags();
        loadPopularSearches();
        loadCustomers();
        loadBanners();
        loadPolicies();
        loadSettings();
        
        // Load categories for dropdown
        loadCategoriesForDropdown();
      } else {
        document.getElementById('adminLoginPage').style.display = 'flex';
        document.getElementById('adminPanel').style.display = 'none';
      }
      
      // Setup tab navigation
      document.querySelectorAll('.menu-item').forEach(tab => {
        tab.addEventListener('click', function(e) {
          e.preventDefault();
          if (this.dataset.tab) {
            showTab(this.dataset.tab);
            // Close sidebar on mobile after clicking menu item
            if (window.innerWidth <= 1024) {
              toggleSidebar();
            }
          }
        });
      });
      
      // Setup policy tabs
      document.querySelectorAll('.tabs .tab').forEach(tab => {
        tab.addEventListener('click', function() {
          const policy = this.dataset.policy;
          showPolicyTab(policy);
        });
      });
      
      // Setup search and filters
      document.getElementById('productSearch')?.addEventListener('input', filterProducts);
      document.getElementById('orderSearch')?.addEventListener('input', filterOrders);
      document.getElementById('customerSearch')?.addEventListener('input', filterCustomers);
      document.getElementById('similarProductsSearch')?.addEventListener('input', filterSimilarProducts);
      
      // Select all orders checkbox
      document.getElementById('selectAllOrders')?.addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('#ordersTableBody input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
          checkbox.checked = this.checked;
        });
      });

      // Settings form submission
      document.getElementById('settingsForm')?.addEventListener('submit', function(e) {
        e.preventDefault();
        saveSettings();
      });

      // Modal Controls
      const modals = document.querySelectorAll('.modal');
      const closeButtons = document.querySelectorAll('.close');
      
      // Close Modals
      closeButtons.forEach(button => {
        button.addEventListener('click', function() {
          modals.forEach(modal => {
            modal.classList.remove('active');
          });
        });
      });
      
      // Close modal when clicking outside
      modals.forEach(modal => {
        modal.addEventListener('click', function(e) {
          if (e.target === this) {
            this.classList.remove('active');
          }
        });
      });

      // Close sidebar when clicking overlay
      document.getElementById('sidebarOverlay')?.addEventListener('click', function() {
        toggleSidebar();
      });
    }

    // Toggle sidebar with overlay
    function toggleSidebar() {
      const sidebar = document.getElementById('adminSidebar');
      const overlay = document.getElementById('sidebarOverlay');
      
      sidebar.classList.toggle('active');
      overlay.classList.toggle('active');
    }

    // Load categories for dropdown
    function loadCategoriesForDropdown() {
      const categoriesRef = database.ref('categories');
      categoriesRef.once('value', snapshot => {
        const categoriesData = snapshot.val();
        if (categoriesData) {
          allCategories = Object.entries(categoriesData).map(([key, value]) => {
            return { ...value, id: value.id || key };
          });
          
          // Update category dropdowns
          updateCategoryDropdowns();
        }
      }).catch(error => {
        console.error('Error loading categories for dropdown:', error);
      });
    }

    // Update category dropdowns
    function updateCategoryDropdowns() {
      // Update add product modal dropdown
      const addProductCategory = document.getElementById('productCategory');
      if (addProductCategory) {
        const firstOption = addProductCategory.options[0];
        addProductCategory.innerHTML = '';
        if (firstOption) addProductCategory.appendChild(firstOption);
        
        allCategories.forEach(category => {
          if (category.status === 'active' || category.status === undefined) {
            const option = document.createElement('option');
            option.value = category.name;
            option.textContent = category.name;
            addProductCategory.appendChild(option);
          }
        });
      }
      
      // Update edit product modal dropdown
      const editProductCategory = document.getElementById('editProductCategory');
      if (editProductCategory) {
        const firstOption = editProductCategory.options[0];
        editProductCategory.innerHTML = '';
        if (firstOption) editProductCategory.appendChild(firstOption);
        
        allCategories.forEach(category => {
          if (category.status === 'active' || category.status === undefined) {
            const option = document.createElement('option');
            option.value = category.name;
            option.textContent = category.name;
            editProductCategory.appendChild(option);
          }
        });
      }
    }

    // Admin login function
    function adminLogin() {
      const email = document.getElementById('adminEmail').value;
      const password = document.getElementById('adminPassword').value;
      const rememberMe = document.getElementById('rememberMe').checked;
      
      if (email === 'admin@buyzo.com' && password === 'admin123') {
        if (rememberMe) {
          localStorage.setItem('admin_logged_in', 'true');
        } else {
          sessionStorage.setItem('admin_logged_in', 'true');
        }
        document.getElementById('adminLoginPage').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadDashboardData();
        loadCategoriesForDropdown();
      } else {
        alert('Invalid credentials. Try admin@buyzo.com / admin123');
      }
    }

    // Logout function
    function logout() {
      localStorage.removeItem('admin_logged_in');
      sessionStorage.removeItem('admin_logged_in');
      document.getElementById('adminLoginPage').style.display = 'flex';
      document.getElementById('adminPanel').style.display = 'none';
    }

    // Show specific tab
    function showTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remove active class from all nav items
      document.querySelectorAll('.menu-item').forEach(nav => {
        nav.classList.remove('active');
      });
      
      // Show selected tab
      document.getElementById(tabName).classList.add('active');
      
      // Set active nav item
      document.querySelector(`.menu-item[data-tab="${tabName}"]`).classList.add('active');
      
      // Update page title
      const titleMap = {
        'dashboard': 'Dashboard',
        'products': 'Products',
        'categories': 'Categories',
        'orders': 'Orders',
        'trending': 'Trending Products',
        'similar-products': 'Similar Products',
        'search-tags': 'Search Tags',
        'popular-searches': 'Popular Searches',
        'customers': 'Customers',
        'banners': 'Banners',
        'policies': 'Policies',
        'settings': 'Settings'
      };
      document.getElementById('adminPageTitle').textContent = titleMap[tabName] || tabName;
      
      currentAdminTab = tabName;
      
      // Load data if needed
      if (tabName === 'dashboard') {
        loadDashboardData();
      } else if (tabName === 'products') {
        loadProducts();
      } else if (tabName === 'categories') {
        loadCategories();
      } else if (tabName === 'orders') {
        loadOrders();
      } else if (tabName === 'trending') {
        loadTrendingProducts();
      } else if (tabName === 'similar-products') {
        loadSimilarProducts();
      } else if (tabName === 'search-tags') {
        loadSearchTags();
      } else if (tabName === 'popular-searches') {
        loadPopularSearches();
      } else if (tabName === 'customers') {
        loadCustomers();
      } else if (tabName === 'banners') {
        loadBanners();
      } else if (tabName === 'policies') {
        loadPolicies();
      } else if (tabName === 'settings') {
        loadSettings();
      }
    }

    // Show policy tab
    function showPolicyTab(policy) {
      document.querySelectorAll('.tabs .tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.policy-content').forEach(content => content.classList.remove('active'));
      
      document.querySelector(`.tab[data-policy="${policy}"]`).classList.add('active');
      document.querySelector(`.policy-content[data-policy="${policy}"]`).classList.add('active');
    }

    // Load Search Tags
    function loadSearchTags() {
      const searchTagsRef = database.ref('searchTags');
      searchTagsRef.once('value', snapshot => {
        const tagsData = snapshot.val();
        allSearchTags = [];
        
        if (tagsData) {
          allSearchTags = Object.entries(tagsData).map(([key, value]) => ({
            id: key,
            ...value
          }));
        }
        
        // Update dashboard view
        updateDashboardSearchTags();
        
        // Update search tags list in admin panel
        const tagsList = document.getElementById('searchTagsList');
        if (tagsList) {
          tagsList.innerHTML = allSearchTags.map(tag => `
            <div class="tag-item">
              <span>${tag.name}</span>
              <span class="badge badge-info" style="margin-left: 8px;">${tag.type || 'general'}</span>
              <i class="fas fa-times remove-tag" onclick="deleteSearchTag('${tag.id}')"></i>
            </div>
          `).join('');
          
          if (allSearchTags.length === 0) {
            tagsList.innerHTML = '<p style="color: var(--secondary);">No search tags added yet.</p>';
          }
        }
      }).catch(error => {
        console.error('Error loading search tags:', error);
      });
    }

    // Load Popular Searches
    function loadPopularSearches() {
      const popularSearchesRef = database.ref('popularSearches');
      popularSearchesRef.once('value', snapshot => {
        const searchesData = snapshot.val();
        allPopularSearches = [];
        
        if (searchesData) {
          allPopularSearches = Object.entries(searchesData).map(([key, value]) => ({
            id: key,
            ...value
          }));
          
          // Sort by count descending
          allPopularSearches.sort((a, b) => (b.count || 0) - (a.count || 0));
        }
        
        // Update dashboard view
        updateDashboardPopularSearches();
        
        // Update popular searches list in admin panel
        const searchesList = document.getElementById('popularSearchesList');
        if (searchesList) {
          searchesList.innerHTML = allPopularSearches.map(search => `
            <div class="popular-search-item">
              <span>${search.term}</span>
              <span class="badge badge-success" style="margin-left: 8px;">${search.count || 0} searches</span>
              <i class="fas fa-times remove-tag" onclick="deletePopularSearch('${search.id}')"></i>
            </div>
          `).join('');
          
          if (allPopularSearches.length === 0) {
            searchesList.innerHTML = '<p style="color: var(--secondary);">No popular searches added yet.</p>';
          }
        }
      }).catch(error => {
        console.error('Error loading popular searches:', error);
      });
    }

    // Update dashboard search tags
    function updateDashboardSearchTags() {
      const dashboardTags = document.getElementById('dashboardSearchTags');
      if (dashboardTags) {
        const topTags = allSearchTags.slice(0, 10);
        dashboardTags.innerHTML = topTags.map(tag => `
          <div class="tag-item">
            <span>${tag.name}</span>
          </div>
        `).join('');
        
        if (topTags.length === 0) {
          dashboardTags.innerHTML = '<p style="color: var(--secondary);">No search tags</p>';
        }
      }
    }

    // Update dashboard popular searches
    function updateDashboardPopularSearches() {
      const dashboardPopular = document.getElementById('dashboardPopularSearches');
      if (dashboardPopular) {
        const topSearches = allPopularSearches.slice(0, 10);
        dashboardPopular.innerHTML = topSearches.map(search => `
          <div class="popular-search-item">
            <span>${search.term}</span>
            <span class="badge badge-success" style="margin-left: 8px;">${search.count || 0}</span>
          </div>
        `).join('');
        
        if (topSearches.length === 0) {
          dashboardPopular.innerHTML = '<p style="color: var(--secondary);">No popular searches</p>';
        }
      }
    }

    // Show add search tag modal
    function showAddSearchTagModal() {
      document.getElementById('searchTagName').value = '';
      document.getElementById('searchTagType').value = 'trending';
      document.getElementById('searchTagActive').checked = true;
      document.getElementById('addSearchTagModal').classList.add('active');
    }

    // Save search tag
    function saveSearchTag() {
      const name = document.getElementById('searchTagName').value.trim();
      const type = document.getElementById('searchTagType').value;
      const active = document.getElementById('searchTagActive').checked;
      
      if (!name) {
        alert('Please enter a tag name');
        return;
      }
      
      const tagId = 'tag_' + Date.now();
      const tagData = {
        name: name,
        type: type,
        active: active,
        createdAt: Date.now()
      };
      
      database.ref('searchTags/' + tagId).set(tagData)
        .then(() => {
          document.getElementById('addSearchTagModal').classList.remove('active');
          loadSearchTags();
          alert('Search tag added successfully!');
        })
        .catch(error => {
          console.error('Error saving search tag:', error);
          alert('Error saving search tag');
        });
    }

    // Delete search tag
    function deleteSearchTag(tagId) {
      if (confirm('Are you sure you want to delete this search tag?')) {
        database.ref('searchTags/' + tagId).remove()
          .then(() => {
            loadSearchTags();
            alert('Search tag deleted successfully!');
          })
          .catch(error => {
            console.error('Error deleting search tag:', error);
            alert('Error deleting search tag');
          });
      }
    }

    // Bulk add search tags
    function bulkAddSearchTags() {
      const bulkText = document.getElementById('bulkSearchTags').value.trim();
      if (!bulkText) {
        alert('Please enter tags to add');
        return;
      }
      
      const tags = bulkText.split(',').map(tag => tag.trim()).filter(tag => tag);
      
      if (tags.length === 0) {
        alert('No valid tags found');
        return;
      }
      
      if (!confirm(`Add ${tags.length} search tags?`)) {
        return;
      }
      
      const updates = {};
      tags.forEach(tag => {
        const tagId = 'tag_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        updates[`searchTags/${tagId}`] = {
          name: tag,
          type: 'general',
          active: true,
          createdAt: Date.now()
        };
      });
      
      database.ref().update(updates)
        .then(() => {
          document.getElementById('bulkSearchTags').value = '';
          loadSearchTags();
          alert('Search tags added successfully!');
        })
        .catch(error => {
          console.error('Error adding bulk tags:', error);
          alert('Error adding tags');
        });
    }

    // Show add popular search modal
    function showAddPopularSearchModal() {
      document.getElementById('popularSearchTerm').value = '';
      document.getElementById('popularSearchCount').value = '1';
      document.getElementById('popularSearchActive').checked = true;
      document.getElementById('addPopularSearchModal').classList.add('active');
    }

    // Save popular search
    function savePopularSearch() {
      const term = document.getElementById('popularSearchTerm').value.trim();
      const count = parseInt(document.getElementById('popularSearchCount').value) || 1;
      const active = document.getElementById('popularSearchActive').checked;
      
      if (!term) {
        alert('Please enter a search term');
        return;
      }
      
      const searchId = 'search_' + Date.now();
      const searchData = {
        term: term,
        count: count,
        active: active,
        createdAt: Date.now()
      };
      
      database.ref('popularSearches/' + searchId).set(searchData)
        .then(() => {
          document.getElementById('addPopularSearchModal').classList.remove('active');
          loadPopularSearches();
          alert('Popular search added successfully!');
        })
        .catch(error => {
          console.error('Error saving popular search:', error);
          alert('Error saving popular search');
        });
    }

    // Delete popular search
    function deletePopularSearch(searchId) {
      if (confirm('Are you sure you want to delete this popular search?')) {
        database.ref('popularSearches/' + searchId).remove()
          .then(() => {
            loadPopularSearches();
            alert('Popular search deleted successfully!');
          })
          .catch(error => {
            console.error('Error deleting popular search:', error);
            alert('Error deleting popular search');
          });
      }
    }

    // Bulk add popular searches
    function bulkAddPopularSearches() {
      const bulkText = document.getElementById('bulkPopularSearches').value.trim();
      if (!bulkText) {
        alert('Please enter searches to add');
        return;
      }
      
      const searches = bulkText.split(',').map(s => s.trim()).filter(s => s);
      
      if (searches.length === 0) {
        alert('No valid searches found');
        return;
      }
      
      if (!confirm(`Add ${searches.length} popular searches?`)) {
        return;
      }
      
      const updates = {};
      searches.forEach(term => {
        const searchId = 'search_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        updates[`popularSearches/${searchId}`] = {
          term: term,
          count: 1,
          active: true,
          createdAt: Date.now()
        };
      });
      
      database.ref().update(updates)
        .then(() => {
          document.getElementById('bulkPopularSearches').value = '';
          loadPopularSearches();
          alert('Popular searches added successfully!');
        })
        .catch(error => {
          console.error('Error adding bulk searches:', error);
          alert('Error adding searches');
        });
    }

    // Generate popular searches from products
    function generatePopularSearchesFromProducts() {
      const productsRef = database.ref('products');
      productsRef.once('value', snapshot => {
        const productsData = snapshot.val();
        let products = [];
        
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        // Get top product names and categories
        const searchTerms = new Set();
        
        // Add product names (first 20)
        products.slice(0, 20).forEach(product => {
          if (product.title) {
            const words = product.title.split(' ');
            words.forEach(word => {
              if (word.length > 3) {
                searchTerms.add(word);
              }
            });
          }
        });
        
        // Add categories
        allCategories.forEach(category => {
          if (category.name) {
            searchTerms.add(category.name);
          }
        });
        
        // Add common terms
        const commonTerms = ['T-Shirt', 'Jeans', 'Shoes', 'Watch', 'Mobile', 'Laptop', 'Headphones', 'Bag', 'Sunglasses', 'Jacket'];
        commonTerms.forEach(term => searchTerms.add(term));
        
        const updates = {};
        Array.from(searchTerms).slice(0, 30).forEach(term => {
          const searchId = 'search_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
          updates[`popularSearches/${searchId}`] = {
            term: term,
            count: Math.floor(Math.random() * 50) + 10,
            active: true,
            createdAt: Date.now()
          };
        });
        
        database.ref().update(updates)
          .then(() => {
            loadPopularSearches();
            alert('Popular searches generated successfully!');
          })
          .catch(error => {
            console.error('Error generating searches:', error);
            alert('Error generating searches');
          });
      });
    }

    // Calculate earnings data
    function calculateEarnings(orders, products) {
      const now = new Date();
      const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
      const twoWeeksAgo = new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000);
      const oneMonthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
      const twoMonthsAgo = new Date(now.getTime() - 60 * 24 * 60 * 60 * 1000);
      
      let totalEarnings = 0;
      let lastWeekEarnings = 0;
      let previousWeekEarnings = 0;
      let lastMonthEarnings = 0;
      let previousMonthEarnings = 0;
      
      orders.forEach(order => {
        const product = products.find(p => p.id === order.productId);
        if (product && order.status !== 'Cancelled') {
          const orderValue = product.price * (order.qty || 1);
          const orderDate = new Date(order.timestamp);
          
          totalEarnings += orderValue;
          
          if (orderDate >= oneWeekAgo) {
            lastWeekEarnings += orderValue;
          }
          if (orderDate >= twoWeeksAgo && orderDate < oneWeekAgo) {
            previousWeekEarnings += orderValue;
          }
          if (orderDate >= oneMonthAgo) {
            lastMonthEarnings += orderValue;
          }
          if (orderDate >= twoMonthsAgo && orderDate < oneMonthAgo) {
            previousMonthEarnings += orderValue;
          }
        }
      });
      
      const weeklyTrend = previousWeekEarnings > 0 
        ? ((lastWeekEarnings - previousWeekEarnings) / previousWeekEarnings) * 100 
        : lastWeekEarnings > 0 ? 100 : 0;
        
      const monthlyTrend = previousMonthEarnings > 0 
        ? ((lastMonthEarnings - previousMonthEarnings) / previousMonthEarnings) * 100 
        : lastMonthEarnings > 0 ? 100 : 0;
      
      return {
        totalEarnings,
        lastWeekEarnings,
        lastMonthEarnings,
        weeklyTrend,
        monthlyTrend
      };
    }

    // Load dashboard data
    function loadDashboardData() {
      const productsRef = database.ref('products');
      const ordersRef = database.ref('orders');
      
      Promise.all([
        new Promise(resolve => productsRef.once('value', snapshot => resolve(snapshot.val()))),
        new Promise(resolve => ordersRef.once('value', snapshot => resolve(snapshot.val())))
      ]).then(([productsData, ordersData]) => {
        let products = [];
        let orders = [];
        
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        if (ordersData) {
          orders = Object.entries(ordersData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        const trendingProducts = products.filter(p => p.trending);
        
        document.getElementById('totalProducts').textContent = products.length;
        document.getElementById('totalOrders').textContent = orders.length;
        document.getElementById('pendingOrders').textContent = orders.filter(o => o.status === 'Pending').length;
        document.getElementById('trendingProducts').textContent = trendingProducts.length;
        
        const earnings = calculateEarnings(orders, products);
        document.getElementById('totalEarnings').textContent = `₹${earnings.totalEarnings.toLocaleString()}`;
        document.getElementById('lastWeekEarnings').textContent = `₹${earnings.lastWeekEarnings.toLocaleString()}`;
        document.getElementById('lastMonthEarnings').textContent = `₹${earnings.lastMonthEarnings.toLocaleString()}`;
        
        updateTrendElement('lastWeekTrend', earnings.weeklyTrend);
        updateTrendElement('lastMonthTrend', earnings.monthlyTrend);
        
        const recentOrders = orders.slice(-5).reverse();
        const recentOrdersHtml = recentOrders.map(order => {
          const product = products.find(p => p.id === order.productId);
          return `
            <tr>
              <td>#${order.id || 'N/A'}</td>
              <td>${order.fullname || 'N/A'}</td>
              <td>${product ? product.title : 'Unknown'}</td>
              <td>₹${product ? product.price * (order.qty || 1) : 'N/A'}</td>
              <td><span class="badge ${getStatusBadgeClass(order.status)}">${order.status || 'Pending'}</span></td>
              <td>${order.timestamp ? new Date(order.timestamp).toLocaleDateString() : 'N/A'}</td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('recentOrders').innerHTML = recentOrdersHtml || '<tr><td colspan="6" style="text-align: center">No orders found</td></tr>';
      }).catch(error => {
        console.error('Error loading dashboard data:', error);
      });
    }

    // Update trend element
    function updateTrendElement(elementId, trendValue) {
      const element = document.getElementById(elementId);
      if (!element) return;
      
      const valueElement = element.querySelector('span:last-child');
      const iconElement = element.querySelector('i');
      
      valueElement.textContent = `${Math.abs(trendValue).toFixed(1)}%`;
      
      if (trendValue >= 0) {
        element.className = 'earnings-trend';
        iconElement.className = 'fas fa-caret-up trend-up';
      } else {
        element.className = 'earnings-trend';
        iconElement.className = 'fas fa-caret-down trend-down';
      }
    }

    function getStatusBadgeClass(status) {
      switch(status) {
        case 'Delivered': return 'badge-success';
        case 'Shipped': return 'badge-info';
        case 'Confirmed': return 'badge-info';
        case 'Cancelled': return 'badge-danger';
        default: return 'badge-warning';
      }
    }

    // Load products
    function loadProducts() {
      const productsRef = database.ref('products');
      productsRef.once('value', snapshot => {
        const productsData = snapshot.val();
        let products = [];
        
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        const filteredProducts = filterProductsList(products);
        const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
        
        updatePagination('productsPagination', currentProductsPage, totalPages, 'products');
        
        const startIndex = (currentProductsPage - 1) * productsPerPage;
        const paginatedProducts = filteredProducts.slice(startIndex, startIndex + productsPerPage);
        
        const productsHtml = paginatedProducts.map(product => {
          const images = product.images || [];
          const mainImage = images.length > 0 ? images[0] : '';
          
          return `
            <tr>
              <td><img src="${mainImage}" class="product-image" onerror="this.src='https://via.placeholder.com/50'"></td>
              <td>${product.title || 'No Name'}</td>
              <td>${product.category || 'Uncategorized'}</td>
              <td>₹${product.price || 0}</td>
              <td>${product.stock || 0}</td>
              <td>${product.trending ? '<span class="badge badge-success">Yes</span>' : '<span class="badge badge-warning">No</span>'}</td>
              <td>${product.status === 'active' ? '<span class="badge badge-success">Active</span>' : '<span class="badge badge-danger">Inactive</span>'}</td>
              <td>
                <div style="display: flex; gap: 8px;">
                  <button class="btn btn-primary btn-sm" onclick="editProduct('${product.id}')"><i class="fas fa-edit"></i></button>
                  <button class="btn btn-danger btn-sm" onclick="deleteProduct('${product.id}')"><i class="fas fa-trash"></i></button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('productsTableBody').innerHTML = productsHtml || '<tr><td colspan="8" style="text-align: center">No products found</td></tr>';
      }).catch(error => {
        console.error('Error loading products:', error);
      });
    }

    function filterProductsList(products) {
      const searchTerm = document.getElementById('productSearch')?.value.toLowerCase() || '';
      return products.filter(product => 
        (product.title || '').toLowerCase().includes(searchTerm) || 
        (product.desc || '').toLowerCase().includes(searchTerm)
      );
    }

    function filterProducts() {
      currentProductsPage = 1;
      loadProducts();
    }

    // Load categories
    function loadCategories() {
      const categoriesRef = database.ref('categories');
      categoriesRef.once('value', snapshot => {
        const categoriesData = snapshot.val();
        let categories = [];
        
        if (categoriesData) {
          categories = Object.entries(categoriesData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        allCategories = categories;
        updateCategoryDropdowns();
        
        const categoriesHtml = categories.map(category => `
          <tr>
            <td>#${category.id}</td>
            <td>
              ${category.image ? 
                `<img src="${category.image}" class="product-image" onerror="this.src='https://via.placeholder.com/50'">` : 
                '<div class="product-image" style="background: #f1f5f9; display: flex; align-items: center; justify-content: center;"><i class="fas fa-image"></i></div>'
              }
            </td>
            <td>${category.name || 'No Name'}</td>
            <td>${category.description || 'No description'}</td>
            <td>${category.productCount || 0}</td>
            <td>${category.status === 'active' ? '<span class="badge badge-success">Active</span>' : '<span class="badge badge-danger">Inactive</span>'}</td>
            <td>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-primary btn-sm" onclick="editCategory('${category.id}')"><i class="fas fa-edit"></i></button>
                <button class="btn btn-danger btn-sm" onclick="deleteCategory('${category.id}')"><i class="fas fa-trash"></i></button>
              </div>
            </td>
          </tr>
        `).join('');
        
        document.getElementById('categoriesTableBody').innerHTML = categoriesHtml || '<tr><td colspan="7" style="text-align: center">No categories found</td></tr>';
      }).catch(error => {
        console.error('Error loading categories:', error);
      });
    }

    // Load orders with date filter
    function loadOrders() {
      const ordersRef = database.ref('orders');
      const productsRef = database.ref('products');
      
      Promise.all([
        new Promise(resolve => ordersRef.once('value', snapshot => resolve(snapshot.val()))),
        new Promise(resolve => productsRef.once('value', snapshot => resolve(snapshot.val())))
      ]).then(([ordersData, productsData]) => {
        let orders = [];
        let products = [];
        
        if (ordersData) {
          orders = Object.entries(ordersData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        // Apply date filter
        const filteredOrders = applyDateFilter(orders, products);
        const totalPages = Math.ceil(filteredOrders.length / ordersPerPage);
        
        updatePagination('ordersPagination', currentOrdersPage, totalPages, 'orders');
        
        const startIndex = (currentOrdersPage - 1) * ordersPerPage;
        const paginatedOrders = filteredOrders.slice(startIndex, startIndex + ordersPerPage);
        
        const ordersHtml = paginatedOrders.map(order => {
          const product = products.find(p => p.id === order.productId);
          return `
            <tr>
              <td><input type="checkbox" value="${order.id}"></td>
              <td>#${order.id || 'N/A'}</td>
              <td>${order.fullname || 'N/A'}<br><small>${order.mobile || 'N/A'}</small></td>
              <td>${product ? product.title : 'Unknown'} (x${order.qty || 1})</td>
              <td>₹${product ? product.price * (order.qty || 1) : 'N/A'}</td>
              <td>
                <select onchange="updateOrderStatus('${order.id}', this.value)" class="form-control" style="width: auto;">
                  <option value="Pending" ${order.status === 'Pending' ? 'selected' : ''}>Pending</option>
                  <option value="Confirmed" ${order.status === 'Confirmed' ? 'selected' : ''}>Confirmed</option>
                  <option value="Shipped" ${order.status === 'Shipped' ? 'selected' : ''}>Shipped</option>
                  <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                  <option value="Cancelled" ${order.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                </select>
              </td>
              <td>${order.timestamp ? new Date(order.timestamp).toLocaleDateString() : 'N/A'}</td>
              <td>
                <button class="btn btn-primary btn-sm" onclick="viewOrderDetails('${order.id}')"><i class="fas fa-eye"></i></button>
              </td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('ordersTableBody').innerHTML = ordersHtml || '<tr><td colspan="8" style="text-align: center">No orders found</td></tr>';
      }).catch(error => {
        console.error('Error loading orders:', error);
      });
    }

    // Apply date filter
    function applyDateFilter(orders, products) {
      // First apply search filter
      const searchTerm = document.getElementById('orderSearch')?.value.toLowerCase() || '';
      let filteredOrders = orders.filter(order => {
        const product = products.find(p => p.id === order.productId);
        const productName = product ? (product.title || '').toLowerCase() : '';
        return (order.fullname || '').toLowerCase().includes(searchTerm) || 
               (order.mobile || '').includes(searchTerm) ||
               productName.includes(searchTerm);
      });
      
      // Then apply date filter
      if (currentDateFilter.type === 'all') {
        return filteredOrders;
      }
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);
      
      return filteredOrders.filter(order => {
        if (!order.timestamp) return false;
        
        const orderDate = new Date(order.timestamp);
        orderDate.setHours(0, 0, 0, 0);
        
        if (currentDateFilter.type === 'today') {
          return orderDate.getTime() === today.getTime();
        } else if (currentDateFilter.type === 'tomorrow') {
          return orderDate.getTime() === tomorrow.getTime();
        } else if (currentDateFilter.type === 'custom') {
          if (currentDateFilter.startDate && currentDateFilter.endDate) {
            const start = new Date(currentDateFilter.startDate);
            start.setHours(0, 0, 0, 0);
            const end = new Date(currentDateFilter.endDate);
            end.setHours(23, 59, 59, 999);
            return orderDate >= start && orderDate <= end;
          }
        }
        return true;
      });
    }

    // Filter by date
    function filterOrdersByDate(type, button) {
      // Update button active state
      document.querySelectorAll('.date-filter-buttons .btn').forEach(btn => {
        btn.classList.remove('active');
      });
      button.classList.add('active');
      
      // Update filter type
      currentDateFilter.type = type;
      currentDateFilter.startDate = null;
      currentDateFilter.endDate = null;
      
      // Clear date inputs
      document.getElementById('startDate').value = '';
      document.getElementById('endDate').value = '';
      
      currentOrdersPage = 1;
      loadOrders();
    }

    // Filter by custom date range
    function filterOrdersByCustomDate() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      
      if (!startDate || !endDate) {
        alert('Please select both start and end dates');
        return;
      }
      
      // Update button active state
      document.querySelectorAll('.date-filter-buttons .btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Update filter type
      currentDateFilter.type = 'custom';
      currentDateFilter.startDate = startDate;
      currentDateFilter.endDate = endDate;
      
      currentOrdersPage = 1;
      loadOrders();
    }

    // Clear date filter
    function clearDateFilter() {
      currentDateFilter.type = 'all';
      currentDateFilter.startDate = null;
      currentDateFilter.endDate = null;
      
      document.getElementById('startDate').value = '';
      document.getElementById('endDate').value = '';
      
      // Update button active state
      document.querySelectorAll('.date-filter-buttons .btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector('.date-filter-buttons .btn:first-child').classList.add('active');
      
      currentOrdersPage = 1;
      loadOrders();
    }

    function filterOrders() {
      currentOrdersPage = 1;
      loadOrders();
    }

    function updateOrderStatus(orderId, status) {
      database.ref('orders/' + orderId).update({ status: status })
        .then(() => {
          loadOrders();
          if (currentAdminTab === 'dashboard') loadDashboardData();
          alert('Order status updated successfully!');
        })
        .catch(error => {
          console.error('Error updating order status:', error);
          alert('Error updating order status');
        });
    }

    function applyBulkAction() {
      const status = document.getElementById('bulkStatusAction').value;
      if (!status) {
        alert('Please select a status action');
        return;
      }
      
      const checkboxes = document.querySelectorAll('#ordersTableBody input[type="checkbox"]:checked');
      if (checkboxes.length === 0) {
        alert('Please select at least one order');
        return;
      }
      
      if (!confirm(`Update ${checkboxes.length} order(s) to ${status}?`)) return;
      
      const updates = {};
      checkboxes.forEach(checkbox => {
        updates[`orders/${checkbox.value}/status`] = status;
      });
      
      database.ref().update(updates)
        .then(() => {
          loadOrders();
          if (currentAdminTab === 'dashboard') loadDashboardData();
          document.getElementById('selectAllOrders').checked = false;
          alert('Bulk update successful!');
        })
        .catch(error => {
          console.error('Error in bulk update:', error);
          alert('Error updating orders');
        });
    }

    // View Order Details
    function viewOrderDetails(orderId) {
      const ordersRef = database.ref('orders');
      const productsRef = database.ref('products');
      
      Promise.all([
        new Promise(resolve => ordersRef.child(orderId).once('value', snapshot => resolve(snapshot.val()))),
        new Promise(resolve => productsRef.once('value', snapshot => resolve(snapshot.val())))
      ]).then(([order, productsData]) => {
        if (!order) {
          alert('Order not found');
          return;
        }
        
        let products = [];
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        const product = products.find(p => p.id === order.productId);
        const orderDate = order.timestamp ? new Date(order.timestamp) : new Date();
        
        // Populate order details
        document.getElementById('orderDetailsId').textContent = `#${order.id || ''}`;
        document.getElementById('orderDetailsName').textContent = order.fullname || 'N/A';
        document.getElementById('orderDetailsMobile').textContent = order.mobile || 'N/A';
        document.getElementById('orderDetailsEmail').textContent = order.email || 'N/A';
        document.getElementById('orderDetailsDate').textContent = orderDate.toLocaleString();
        
        const address = `${order.house || ''}, ${order.area || ''}, ${order.city || ''}, ${order.state || ''} - ${order.pincode || ''}`;
        document.getElementById('orderDetailsAddress').textContent = address;
        
        // Populate order items
        const orderProductsBody = document.getElementById('orderProductsBody');
        const productPrice = product ? product.price : 0;
        const quantity = order.qty || 1;
        const subtotal = productPrice * quantity;
        
        orderProductsBody.innerHTML = `
          <tr>
            <td>${product ? product.title : 'Unknown'}</td>
            <td>₹${productPrice}</td>
            <td>${quantity}</td>
            <td>₹${subtotal}</td>
          </tr>
        `;
        
        // Calculate totals
        document.getElementById('orderSubtotal').textContent = `₹${subtotal}`;
        const shipping = order.shipping || 50;
        document.getElementById('orderShipping').textContent = `₹${shipping}`;
        document.getElementById('orderTotal').textContent = `₹${subtotal + shipping}`;
        
        // Set status dropdown
        const statusSelect = document.getElementById('orderDetailsStatus');
        statusSelect.value = order.status || 'Pending';
        statusSelect.setAttribute('data-order-id', orderId);
        
        // Update status timeline
        updateStatusTimeline(order.status || 'Pending');
        
        // Show modal
        document.getElementById('orderDetailsModal').classList.add('active');
      }).catch(error => {
        console.error('Error loading order details:', error);
        alert('Error loading order details');
      });
    }

    // Update status timeline
    function updateStatusTimeline(currentStatus) {
      const statuses = ['Pending', 'Confirmed', 'Shipped', 'Delivered'];
      const timeline = document.getElementById('orderStatusTimeline');
      
      let timelineHtml = '';
      statuses.forEach((status, index) => {
        const statusIndex = statuses.indexOf(currentStatus);
        let statusClass = '';
        
        if (index < statusIndex) {
          statusClass = 'completed';
        } else if (index === statusIndex) {
          statusClass = 'active';
        }
        
        timelineHtml += `
          <div class="status-step ${statusClass}">
            <div class="status-icon">
              ${index < statusIndex ? '<i class="fas fa-check"></i>' : ''}
            </div>
            <div class="status-label">${status}</div>
          </div>
        `;
      });
      
      // Add cancelled status if applicable
      if (currentStatus === 'Cancelled') {
        timelineHtml += `
          <div class="status-step active">
            <div class="status-icon">
              <i class="fas fa-times"></i>
            </div>
            <div class="status-label">Cancelled</div>
          </div>
        `;
      }
      
      timeline.innerHTML = timelineHtml;
    }

    // Update order status from details modal
    function updateOrderStatusFromDetails() {
      const orderId = document.getElementById('orderDetailsStatus').getAttribute('data-order-id');
      const status = document.getElementById('orderDetailsStatus').value;
      
      if (confirm(`Update order status to ${status}?`)) {
        database.ref('orders/' + orderId).update({ status: status })
          .then(() => {
            updateStatusTimeline(status);
            loadOrders();
            if (currentAdminTab === 'dashboard') loadDashboardData();
            alert('Order status updated successfully!');
          })
          .catch(error => {
            console.error('Error updating order status:', error);
            alert('Error updating order status');
          });
      }
    }

    // Print order details
    function printOrderDetails() {
      const orderId = document.getElementById('orderDetailsId').textContent;
      const customerName = document.getElementById('orderDetailsName').textContent;
      const customerMobile = document.getElementById('orderDetailsMobile').textContent;
      const customerEmail = document.getElementById('orderDetailsEmail').textContent;
      const orderDate = document.getElementById('orderDetailsDate').textContent;
      const address = document.getElementById('orderDetailsAddress').textContent;
      
      const productsTable = document.getElementById('orderProductsBody').innerHTML;
      const subtotal = document.getElementById('orderSubtotal').textContent;
      const shipping = document.getElementById('orderShipping').textContent;
      const total = document.getElementById('orderTotal').textContent;
      
      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <html>
          <head>
            <title>Order ${orderId}</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; }
              h1 { color: #2563eb; }
              .details { margin: 20px 0; }
              .detail-row { margin: 10px 0; }
              .label { font-weight: bold; color: #64748b; }
              table { width: 100%; border-collapse: collapse; margin: 20px 0; }
              th, td { padding: 10px; text-align: left; border-bottom: 1px solid #e2e8f0; }
              th { background: #f8fafc; }
              .total { font-size: 18px; font-weight: bold; color: #2563eb; }
            </style>
          </head>
          <body>
            <h1>Order ${orderId}</h1>
            <div class="details">
              <div class="detail-row"><span class="label">Customer:</span> ${customerName}</div>
              <div class="detail-row"><span class="label">Mobile:</span> ${customerMobile}</div>
              <div class="detail-row"><span class="label">Email:</span> ${customerEmail}</div>
              <div class="detail-row"><span class="label">Order Date:</span> ${orderDate}</div>
              <div class="detail-row"><span class="label">Address:</span> ${address}</div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Price</th>
                  <th>Quantity</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                ${productsTable}
              </tbody>
            </table>
            <div class="detail-row"><span class="label">Subtotal:</span> ${subtotal}</div>
            <div class="detail-row"><span class="label">Shipping:</span> ${shipping}</div>
            <div class="total">Total: ${total}</div>
          </body>
        </html>
      `);
      printWindow.document.close();
      printWindow.print();
    }

    // Load trending products
    function loadTrendingProducts() {
      const productsRef = database.ref('products');
      productsRef.once('value', snapshot => {
        const productsData = snapshot.val();
        let products = [];
        
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        const trendingHtml = products.map(product => {
          const images = product.images || [];
          const mainImage = images.length > 0 ? images[0] : '';
          
          return `
            <tr>
              <td><img src="${mainImage}" class="product-image" onerror="this.src='https://via.placeholder.com/50'"></td>
              <td>${product.title || 'No Name'}</td>
              <td>₹${product.price || 0}</td>
              <td>${product.trending ? '<span class="badge badge-success">Yes</span>' : '<span class="badge badge-warning">No</span>'}</td>
              <td>
                <button class="btn ${product.trending ? 'btn-danger' : 'btn-success'} btn-sm" onclick="toggleTrending('${product.id}', ${!product.trending})">
                  <i class="fas ${product.trending ? 'fa-times' : 'fa-fire'}"></i> 
                  ${product.trending ? 'Remove' : 'Add'}
                </button>
              </td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('trendingTableBody').innerHTML = trendingHtml || '<tr><td colspan="5" style="text-align: center">No products found</td></tr>';
      }).catch(error => {
        console.error('Error loading trending products:', error);
      });
    }

    function toggleTrending(productId, isTrending) {
      database.ref('products/' + productId).update({ trending: isTrending })
        .then(() => {
          loadTrendingProducts();
          if (currentAdminTab === 'dashboard') loadDashboardData();
          if (currentAdminTab === 'products') loadProducts();
          alert('Trending status updated!');
        })
        .catch(error => {
          console.error('Error updating trending status:', error);
          alert('Error updating trending status');
        });
    }

    // Load similar products
    function loadSimilarProducts() {
      const similarProductsRef = database.ref('similarProducts');
      const productsRef = database.ref('products');
      
      Promise.all([
        new Promise(resolve => similarProductsRef.once('value', snapshot => resolve(snapshot.val()))),
        new Promise(resolve => productsRef.once('value', snapshot => resolve(snapshot.val())))
      ]).then(([similarData, productsData]) => {
        let similarProducts = [];
        let products = [];
        
        if (similarData) {
          similarProducts = Object.entries(similarData).map(([key, value]) => ({
            key,
            ...value,
            mainProductId: value.mainProductId || key
          }));
        }
        
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        const filteredSimilarProducts = filterSimilarProductsList(similarProducts, products);
        const totalPages = Math.ceil(filteredSimilarProducts.length / similarProductsPerPage);
        
        updatePagination('similarProductsPagination', currentSimilarProductsPage, totalPages, 'similar-products');
        
        const startIndex = (currentSimilarProductsPage - 1) * similarProductsPerPage;
        const paginatedSimilarProducts = filteredSimilarProducts.slice(startIndex, startIndex + similarProductsPerPage);
        
        const similarProductsHtml = paginatedSimilarProducts.map(item => {
          const mainProduct = products.find(p => p.id === item.mainProductId);
          const similarCount = item.similarProductIds ? item.similarProductIds.length : 0;
          const images = mainProduct ? (mainProduct.images || []) : [];
          const mainImage = images.length > 0 ? images[0] : '';
          
          return `
            <tr>
              <td>${mainProduct ? mainProduct.title : 'Product ID: ' + item.mainProductId}</td>
              <td>
                ${mainImage ? 
                  `<img src="${mainImage}" class="product-image" onerror="this.src='https://via.placeholder.com/50'">` : 
                  '<div class="product-image" style="background: #f1f5f9; display: flex; align-items: center; justify-content: center;"><i class="fas fa-image"></i></div>'
                }
              </td>
              <td>${similarCount}</td>
              <td>${item.status === 'active' ? '<span class="badge badge-success">Active</span>' : '<span class="badge badge-warning">Inactive</span>'}</td>
              <td>
                <div style="display: flex; gap: 8px;">
                  <button class="btn btn-primary btn-sm" onclick="editSimilarProducts('${item.mainProductId}')"><i class="fas fa-edit"></i></button>
                  <button class="btn btn-danger btn-sm" onclick="deleteSimilarProducts('${item.mainProductId}')"><i class="fas fa-trash"></i></button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
        
        document.getElementById('similarProductsTableBody').innerHTML = 
          similarProductsHtml || '<tr><td colspan="5" style="text-align: center">No similar products configured</td></tr>';
      }).catch(error => {
        console.error('Error loading similar products:', error);
      });
    }

    function filterSimilarProductsList(similarProducts, products) {
      const searchTerm = document.getElementById('similarProductsSearch')?.value.toLowerCase() || '';
      return similarProducts.filter(item => {
        const mainProduct = products.find(p => p.id === item.mainProductId);
        return mainProduct && (mainProduct.title || '').toLowerCase().includes(searchTerm);
      });
    }

    function filterSimilarProducts() {
      currentSimilarProductsPage = 1;
      loadSimilarProducts();
    }

    // Load customers
    function loadCustomers() {
      const ordersRef = database.ref('orders');
      ordersRef.once('value', snapshot => {
        const ordersData = snapshot.val();
        let orders = [];
        
        if (ordersData) {
          orders = Object.values(ordersData);
        }
        
        const customersMap = {};
        orders.forEach(order => {
          if (order.mobile && !customersMap[order.mobile]) {
            customersMap[order.mobile] = {
              name: order.fullname || 'Unknown',
              mobile: order.mobile,
              email: order.email || 'N/A',
              location: `${order.city || ''}, ${order.state || ''}`,
              orderCount: 1,
              lastOrder: order.timestamp
            };
          } else if (order.mobile) {
            customersMap[order.mobile].orderCount++;
            if (new Date(order.timestamp) > new Date(customersMap[order.mobile].lastOrder)) {
              customersMap[order.mobile].lastOrder = order.timestamp;
            }
          }
        });
        
        const customers = Object.values(customersMap);
        const filteredCustomers = filterCustomersList(customers);
        const totalPages = Math.ceil(filteredCustomers.length / customersPerPage);
        
        updatePagination('customersPagination', currentCustomersPage, totalPages, 'customers');
        
        const startIndex = (currentCustomersPage - 1) * customersPerPage;
        const paginatedCustomers = filteredCustomers.slice(startIndex, startIndex + customersPerPage);
        
        const customersHtml = paginatedCustomers.map(customer => `
          <tr>
            <td>${customer.name}</td>
            <td>${customer.mobile}</td>
            <td>${customer.email}</td>
            <td>${customer.location}</td>
            <td>${customer.orderCount}</td>
            <td>${customer.lastOrder ? new Date(customer.lastOrder).toLocaleDateString() : 'N/A'}</td>
          </tr>
        `).join('');
        
        document.getElementById('customersTableBody').innerHTML = customersHtml || '<tr><td colspan="6" style="text-align: center">No customers found</td></tr>';
      }).catch(error => {
        console.error('Error loading customers:', error);
      });
    }

    function filterCustomersList(customers) {
      const searchTerm = document.getElementById('customerSearch')?.value.toLowerCase() || '';
      return customers.filter(customer => 
        (customer.name || '').toLowerCase().includes(searchTerm) || 
        (customer.mobile || '').includes(searchTerm) ||
        (customer.email || '').toLowerCase().includes(searchTerm) ||
        (customer.location || '').toLowerCase().includes(searchTerm)
      );
    }

    function filterCustomers() {
      currentCustomersPage = 1;
      loadCustomers();
    }

    // Load banners
    function loadBanners() {
      const bannersRef = database.ref('banners');
      bannersRef.once('value', snapshot => {
        const bannersData = snapshot.val();
        let banners = [];
        
        if (bannersData) {
          banners = Object.entries(bannersData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        const bannersHtml = banners.map(banner => `
          <tr>
            <td>#${banner.id}</td>
            <td><img src="${banner.image || ''}" width="100" height="50" style="object-fit: cover; border-radius: 6px" onerror="this.src='https://via.placeholder.com/100x50'"></td>
            <td>${banner.title || 'No Title'}</td>
            <td>${banner.status === 'active' ? '<span class="badge badge-success">Active</span>' : '<span class="badge badge-danger">Inactive</span>'}</td>
            <td>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-primary btn-sm" onclick="editBanner('${banner.id}')"><i class="fas fa-edit"></i></button>
                <button class="btn btn-danger btn-sm" onclick="deleteBanner('${banner.id}')"><i class="fas fa-trash"></i></button>
              </div>
            </td>
          </tr>
        `).join('');
        
        document.getElementById('bannersTableBody').innerHTML = bannersHtml || '<tr><td colspan="5" style="text-align: center">No banners found</td></tr>';
      }).catch(error => {
        console.error('Error loading banners:', error);
      });
    }

    // Load policies
    function loadPolicies() {
      const policiesRef = database.ref('policies');
      policiesRef.once('value', snapshot => {
        const policies = snapshot.val() || {};
        
        document.getElementById('aboutContent').value = policies.about || '';
        document.getElementById('refundContent').value = policies.refund || '';
        document.getElementById('termsContent').value = policies.terms || '';
        document.getElementById('shippingContent').value = policies.shipping || '';
        document.getElementById('privacyContent').value = policies.privacy || '';
      }).catch(error => {
        console.error('Error loading policies:', error);
      });
    }

    function savePolicy(policyType) {
      const content = document.getElementById(`${policyType}Content`).value;
      
      database.ref('policies/' + policyType).set(content)
        .then(() => alert(`${policyType} policy saved successfully!`))
        .catch(error => {
          console.error('Error saving policy:', error);
          alert('Error saving policy');
        });
    }

    // Load settings
    function loadSettings() {
      const settingsRef = database.ref('settings');
      settingsRef.once('value', snapshot => {
        const settings = snapshot.val() || {};
        
        if (settings.storeName) document.getElementById('storeName').value = settings.storeName;
        if (settings.storeEmail) document.getElementById('storeEmail').value = settings.storeEmail;
        if (settings.storePhone) document.getElementById('storePhone').value = settings.storePhone;
        if (settings.storeAddress) document.getElementById('storeAddress').value = settings.storeAddress;
        if (settings.shippingCost) document.getElementById('shippingCost').value = settings.shippingCost;
        if (settings.currency) document.getElementById('currency').value = settings.currency;
        if (settings.maxItemsPerOrder) document.getElementById('maxItemsPerOrder').value = settings.maxItemsPerOrder;
        if (settings.freeShippingThreshold) document.getElementById('freeShippingThreshold').value = settings.freeShippingThreshold;
        if (settings.paymentGatewayCharge) document.getElementById('paymentGatewayCharge').value = settings.paymentGatewayCharge;
      }).catch(error => {
        console.error('Error loading settings:', error);
      });
    }

    function saveSettings() {
      const settings = {
        storeName: document.getElementById('storeName').value,
        storeEmail: document.getElementById('storeEmail').value,
        storePhone: document.getElementById('storePhone').value,
        storeAddress: document.getElementById('storeAddress').value,
        shippingCost: document.getElementById('shippingCost').value,
        currency: document.getElementById('currency').value,
        maxItemsPerOrder: document.getElementById('maxItemsPerOrder').value,
        freeShippingThreshold: document.getElementById('freeShippingThreshold').value,
        paymentGatewayCharge: document.getElementById('paymentGatewayCharge').value
      };
      
      database.ref('settings').set(settings)
        .then(() => alert('Settings saved successfully!'))
        .catch(error => {
          console.error('Error saving settings:', error);
          alert('Error saving settings');
        });
    }

    // Show add product modal
    function showAddProductModal() {
      document.getElementById('productName').value = '';
      document.getElementById('productPrice').value = '';
      document.getElementById('productStock').value = '';
      document.getElementById('productCategory').value = '';
      document.getElementById('productDesc').value = '';
      document.getElementById('productFullDesc').value = '';
      document.getElementById('productSizes').value = '';
      document.getElementById('productTrending').checked = false;
      document.getElementById('productStatus').checked = true;
      document.getElementById('productImagePreviews').innerHTML = '';
      uploadedImages = [];
      
      updateCategoryDropdowns();
      document.getElementById('addProductModal').classList.add('active');
    }

    function showAddCategoryModal() {
      document.getElementById('categoryName').value = '';
      document.getElementById('categoryDescription').value = '';
      document.getElementById('categoryStatus').checked = true;
      document.getElementById('categoryImagePreview').innerHTML = '<span>No image selected</span>';
      uploadedCategoryImage = null;
      document.getElementById('addCategoryModal').classList.add('active');
    }

    function showAddBannerModal() {
      document.getElementById('bannerTitle').value = '';
      document.getElementById('bannerLink').value = '';
      document.getElementById('bannerStatus').checked = true;
      document.getElementById('bannerImagePreview').innerHTML = '<span>No image selected</span>';
      uploadedBannerImage = null;
      document.getElementById('addBannerModal').classList.add('active');
    }

    function showAddSimilarProductsModal() {
      const productsRef = database.ref('products');
      productsRef.once('value', snapshot => {
        const productsData = snapshot.val();
        let products = [];
        
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        allProductsForSimilar = products;
        
        const mainProductSelect = document.getElementById('mainProductSelect');
        mainProductSelect.innerHTML = '<option value="">-- Select Product --</option>' +
          products.map(product => 
            `<option value="${product.id}">${product.title || 'No Name'} (₹${product.price || 0})</option>`
          ).join('');
        
        const similarProductsSelect = document.getElementById('similarProductsSelect');
        similarProductsSelect.innerHTML = products.map(product => 
          `<option value="${product.id}">${product.title || 'No Name'} (₹${product.price || 0}) - ${product.category || 'Uncategorized'}</option>`
        ).join('');
        
        document.getElementById('selectedProductInfo').style.display = 'none';
        document.getElementById('selectedSimilarProductsPreview').innerHTML = '';
        document.getElementById('autoSuggestSimilar').checked = true;
        
        document.getElementById('addSimilarProductsModal').classList.add('active');
      }).catch(error => {
        console.error('Error loading products for similar modal:', error);
        alert('Error loading products');
      });
    }

    // FIXED: Handle product image upload
    function handleProductImageUpload(e) {
      const files = e.target.files;
      const previewContainer = document.getElementById('productImagePreviews');
      
      previewContainer.innerHTML = '';
      uploadedImages = [];
      
      if (files.length === 0) return;
      
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        
        // Validate file type
        if (!file.type.startsWith('image/')) {
          alert(`File ${file.name} is not an image. Please select only image files.`);
          continue;
        }
        
        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
          alert(`File ${file.name} is too large. Maximum size is 5MB.`);
          continue;
        }
        
        const reader = new FileReader();
        
        reader.onload = function(e) {
          uploadedImages.push(e.target.result);
          
          const previewItem = document.createElement('div');
          previewItem.className = 'image-preview-item';
          
          const img = document.createElement('img');
          img.src = e.target.result;
          
          const removeBtn = document.createElement('div');
          removeBtn.className = 'remove-image';
          removeBtn.innerHTML = '&times;';
          removeBtn.onclick = function() {
            const index = uploadedImages.indexOf(e.target.result);
            if (index > -1) {
              uploadedImages.splice(index, 1);
            }
            previewItem.remove();
          };
          
          previewItem.appendChild(img);
          previewItem.appendChild(removeBtn);
          previewContainer.appendChild(previewItem);
        };
        
        reader.readAsDataURL(file);
      }
    }

    function handleCategoryImageUpload(e) {
      const files = e.target.files;
      const preview = document.getElementById('categoryImagePreview');
      
      if (files && files.length > 0) {
        const file = files[0];
        
        // Validate file type
        if (!file.type.startsWith('image/')) {
          alert('Please select an image file');
          return;
        }
        
        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
          alert('File is too large. Maximum size is 5MB.');
          return;
        }
        
        const reader = new FileReader();
        
        reader.onload = function(e) {
          uploadedCategoryImage = e.target.result;
          preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 100px;">`;
        };
        
        reader.readAsDataURL(file);
      }
    }

    function handleBannerImageUpload(e) {
      const files = e.target.files;
      const preview = document.getElementById('bannerImagePreview');
      
      if (files && files.length > 0) {
        const file = files[0];
        
        // Validate file type
        if (!file.type.startsWith('image/')) {
          alert('Please select an image file');
          return;
        }
        
        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
          alert('File is too large. Maximum size is 5MB.');
          return;
        }
        
        const reader = new FileReader();
        
        reader.onload = function(e) {
          uploadedBannerImage = e.target.result;
          preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 100px;">`;
        };
        
        reader.readAsDataURL(file);
      }
    }

    // FIXED: Save product with proper validation and error handling
    function saveProduct() {
      const name = document.getElementById('productName').value.trim();
      const price = document.getElementById('productPrice').value.trim();
      const stock = document.getElementById('productStock').value.trim();
      const category = document.getElementById('productCategory').value;
      const desc = document.getElementById('productDesc').value.trim();
      const fullDesc = document.getElementById('productFullDesc').value.trim();
      const sizesInput = document.getElementById('productSizes').value.trim();
      const trending = document.getElementById('productTrending').checked;
      const status = document.getElementById('productStatus').checked ? 'active' : 'inactive';
      
      // Validate required fields
      if (!name) {
        alert('Please enter product name');
        return;
      }
      
      if (!price) {
        alert('Please enter product price');
        return;
      }
      
      if (isNaN(price) || parseFloat(price) <= 0) {
        alert('Please enter a valid price');
        return;
      }
      
      if (!category) {
        alert('Please select a category');
        return;
      }
      
      if (!desc) {
        alert('Please enter product description');
        return;
      }
      
      if (uploadedImages.length === 0) {
        alert('Please upload at least one product image');
        return;
      }
      
      // Process sizes
      const sizes = sizesInput ? sizesInput.split(',').map(s => s.trim()).filter(s => s) : [];
      
      // Disable save button to prevent double submission
      const saveBtn = document.getElementById('saveProductBtn');
      const originalText = saveBtn.innerHTML;
      saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
      saveBtn.disabled = true;
      
      const productsRef = database.ref('products');
      productsRef.once('value', snapshot => {
        const productsData = snapshot.val();
        let products = [];
        
        if (productsData) {
          products = Object.values(productsData);
        }
        
        // Generate next ID
        let nextId = 1;
        if (products.length > 0) {
          const ids = products.map(p => {
            const id = p.id || p.key;
            return parseInt(id);
          }).filter(id => !isNaN(id));
          nextId = ids.length > 0 ? Math.max(...ids) + 1 : 1;
        }
        
        const productId = nextId.toString();
        
        const newProduct = {
          id: productId,
          title: name,
          price: parseFloat(price),
          stock: stock ? parseInt(stock) : 0,
          desc: desc,
          fullDesc: fullDesc,
          images: uploadedImages,
          sizes: sizes,
          category: category,
          trending: trending,
          status: status,
          timestamp: Date.now()
        };
        
        productsRef.child(productId).set(newProduct)
          .then(() => {
            document.getElementById('addProductModal').classList.remove('active');
            loadProducts();
            loadTrendingProducts();
            if (currentAdminTab === 'dashboard') loadDashboardData();
            alert('Product added successfully!');
            
            // Reset button
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
          })
          .catch(error => {
            console.error('Error saving product:', error);
            alert('Error saving product: ' + error.message);
            
            // Reset button
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
          });
      }).catch(error => {
        console.error('Error reading products:', error);
        alert('Error reading products: ' + error.message);
        
        // Reset button
        saveBtn.innerHTML = originalText;
        saveBtn.disabled = false;
      });
    }

    function saveCategory() {
      const name = document.getElementById('categoryName').value.trim();
      const description = document.getElementById('categoryDescription').value.trim();
      const status = document.getElementById('categoryStatus').checked ? 'active' : 'inactive';
      
      if (!name) {
        alert('Please enter category name');
        return;
      }
      
      if (!uploadedCategoryImage) {
        alert('Please upload a category image');
        return;
      }
      
      const existingCategory = allCategories.find(cat => cat.name && cat.name.toLowerCase() === name.toLowerCase());
      if (existingCategory) {
        alert('Category with this name already exists!');
        return;
      }
      
      const categoriesRef = database.ref('categories');
      categoriesRef.once('value', snapshot => {
        const categoriesData = snapshot.val();
        let categories = [];
        
        if (categoriesData) {
          categories = Object.values(categoriesData);
        }
        
        let nextId = 1;
        if (categories.length > 0) {
          const ids = categories.map(c => {
            const id = c.id || c.key;
            return parseInt(id);
          }).filter(id => !isNaN(id));
          nextId = ids.length > 0 ? Math.max(...ids) + 1 : 1;
        }
        
        const categoryId = nextId.toString();
        
        const newCategory = {
          id: categoryId,
          name: name,
          description: description,
          image: uploadedCategoryImage,
          status: status,
          productCount: 0
        };
        
        categoriesRef.child(categoryId).set(newCategory)
          .then(() => {
            allCategories.push(newCategory);
            updateCategoryDropdowns();
            document.getElementById('addCategoryModal').classList.remove('active');
            loadCategories();
            alert('Category added successfully!');
          })
          .catch(error => {
            console.error('Error saving category:', error);
            alert('Error saving category: ' + error.message);
          });
      });
    }

    function saveBanner() {
      const title = document.getElementById('bannerTitle').value.trim();
      const link = document.getElementById('bannerLink').value.trim();
      const status = document.getElementById('bannerStatus').checked ? 'active' : 'inactive';
      
      if (!title) {
        alert('Please enter banner title');
        return;
      }
      
      if (!uploadedBannerImage) {
        alert('Please upload a banner image');
        return;
      }
      
      const bannersRef = database.ref('banners');
      bannersRef.once('value', snapshot => {
        const bannersData = snapshot.val();
        let banners = [];
        
        if (bannersData) {
          banners = Object.values(bannersData);
        }
        
        let nextId = 1;
        if (banners.length > 0) {
          const ids = banners.map(b => {
            const id = b.id || b.key;
            return parseInt(id);
          }).filter(id => !isNaN(id));
          nextId = ids.length > 0 ? Math.max(...ids) + 1 : 1;
        }
        
        const bannerId = nextId.toString();
        
        const newBanner = {
          id: bannerId,
          title: title,
          link: link,
          image: uploadedBannerImage,
          status: status
        };
        
        bannersRef.child(bannerId).set(newBanner)
          .then(() => {
            document.getElementById('addBannerModal').classList.remove('active');
            loadBanners();
            alert('Banner added successfully!');
          })
          .catch(error => {
            console.error('Error saving banner:', error);
            alert('Error saving banner: ' + error.message);
          });
      });
    }

    function loadProductDetails(productId) {
      const product = allProductsForSimilar.find(p => p.id === productId);
      if (!product) return;
      
      const infoDiv = document.getElementById('selectedProductInfo');
      const productImage = document.getElementById('selectedProductImage');
      const productName = document.getElementById('selectedProductName');
      const productDetails = document.getElementById('selectedProductDetails');
      
      const images = product.images || [];
      const mainImage = images.length > 0 ? images[0] : '';
      
      productImage.src = mainImage;
      productName.textContent = product.title || 'No Name';
      productDetails.textContent = `${product.category || 'Uncategorized'} | ₹${product.price || 0} | Stock: ${product.stock || 0}`;
      
      infoDiv.style.display = 'block';
      
      const autoSuggest = document.getElementById('autoSuggestSimilar').checked;
      if (autoSuggest) {
        const similarProductsSelect = document.getElementById('similarProductsSelect');
        const similarProducts = allProductsForSimilar.filter(p => 
          p.id !== productId && p.category === product.category
        );
        
        Array.from(similarProductsSelect.options).forEach(option => {
          const optionProductId = option.value;
          const isSimilar = similarProducts.some(p => p.id === optionProductId);
          option.selected = isSimilar;
        });
        
        updateSelectedSimilarProductsPreview();
      }
    }

    function searchProductsForSimilar() {
      const searchTerm = document.getElementById('searchSimilarProducts').value.toLowerCase();
      const selectElement = document.getElementById('similarProductsSelect');
      
      Array.from(selectElement.options).forEach(option => {
        const text = option.text.toLowerCase();
        option.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    }

    function editSearchProductsForSimilar() {
      const searchTerm = document.getElementById('editSearchSimilarProducts').value.toLowerCase();
      const selectElement = document.getElementById('editSimilarProductsSelect');
      
      Array.from(selectElement.options).forEach(option => {
        const text = option.text.toLowerCase();
        option.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    }

    function updateSelectedSimilarProductsPreview() {
      const selectElement = document.getElementById('similarProductsSelect');
      const selectedOptions = Array.from(selectElement.selectedOptions);
      const previewDiv = document.getElementById('selectedSimilarProductsPreview');
      
      previewDiv.innerHTML = '';
      
      selectedOptions.forEach(option => {
        const productId = option.value;
        const product = allProductsForSimilar.find(p => p.id === productId);
        
        if (product) {
          const images = product.images || [];
          const mainImage = images.length > 0 ? images[0] : '';
          
          const chip = document.createElement('div');
          chip.style.cssText = 'display: inline-flex; align-items: center; gap: 5px; padding: 5px 10px; background: #f1f5f9; border-radius: 30px; margin-right: 5px; margin-bottom: 5px;';
          chip.innerHTML = `
            <img src="${mainImage}" alt="${product.title || 'No Name'}" width="20" height="20" style="border-radius: 50%; object-fit: cover;">
            <span style="font-size: 12px;">${product.title || 'No Name'}</span>
            <span style="cursor: pointer; color: var(--danger);" onclick="removeFromSimilarSelection('${productId}')">&times;</span>
          `;
          previewDiv.appendChild(chip);
        }
      });
    }

    function removeFromSimilarSelection(productId) {
      const selectElement = document.getElementById('similarProductsSelect');
      const option = Array.from(selectElement.options).find(opt => opt.value === productId);
      if (option) {
        option.selected = false;
        updateSelectedSimilarProductsPreview();
      }
    }

    function saveSimilarProducts() {
      const mainProductId = document.getElementById('mainProductSelect').value;
      const similarProductsSelect = document.getElementById('similarProductsSelect');
      const selectedOptions = Array.from(similarProductsSelect.selectedOptions);
      
      if (!mainProductId) {
        alert('Please select a main product');
        return;
      }
      
      if (selectedOptions.length === 0) {
        alert('Please select at least one similar product');
        return;
      }
      
      const similarProductIds = selectedOptions.map(option => option.value);
      
      if (similarProductIds.includes(mainProductId)) {
        alert('Main product cannot be in similar products list');
        return;
      }
      
      const similarProductsRef = database.ref('similarProducts');
      
      const similarProductsEntry = {
        mainProductId: mainProductId,
        similarProductIds: similarProductIds,
        status: 'active',
        createdAt: Date.now(),
        updatedAt: Date.now()
      };
      
      similarProductsRef.child(mainProductId).set(similarProductsEntry)
        .then(() => {
          document.getElementById('addSimilarProductsModal').classList.remove('active');
          loadSimilarProducts();
          alert('Similar products saved successfully!');
        })
        .catch(error => {
          console.error('Error saving similar products:', error);
          alert('Error saving similar products: ' + error.message);
        });
    }

    function editProduct(productId) {
      const productsRef = database.ref('products');
      productsRef.child(productId).once('value', snapshot => {
        const product = snapshot.val();
        if (!product) {
          alert('Product not found');
          return;
        }
        
        updateCategoryDropdowns();
        
        document.getElementById('editProductId').value = productId;
        document.getElementById('editProductName').value = product.title || '';
        document.getElementById('editProductPrice').value = product.price || 0;
        document.getElementById('editProductStock').value = product.stock || 0;
        document.getElementById('editProductCategory').value = product.category || '';
        document.getElementById('editProductDesc').value = product.desc || '';
        document.getElementById('editProductFullDesc').value = product.fullDesc || '';
        document.getElementById('editProductSizes').value = product.sizes ? product.sizes.join(', ') : '';
        document.getElementById('editProductTrending').checked = product.trending || false;
        document.getElementById('editProductStatus').checked = product.status === 'active';
        
        document.getElementById('editProductModal').classList.add('active');
      }).catch(error => {
        console.error('Error loading product for edit:', error);
        alert('Error loading product: ' + error.message);
      });
    }

    function updateProduct() {
      const productId = document.getElementById('editProductId').value;
      const name = document.getElementById('editProductName').value.trim();
      const price = document.getElementById('editProductPrice').value.trim();
      const stock = document.getElementById('editProductStock').value.trim();
      const category = document.getElementById('editProductCategory').value;
      const desc = document.getElementById('editProductDesc').value.trim();
      const fullDesc = document.getElementById('editProductFullDesc').value.trim();
      const sizesInput = document.getElementById('editProductSizes').value.trim();
      const trending = document.getElementById('editProductTrending').checked;
      const status = document.getElementById('editProductStatus').checked ? 'active' : 'inactive';
      
      if (!name || !price || !category || !desc) {
        alert('Please fill in all required fields');
        return;
      }
      
      const sizes = sizesInput ? sizesInput.split(',').map(s => s.trim()).filter(s => s) : [];
      
      const updates = {
        title: name,
        price: parseFloat(price),
        stock: stock ? parseInt(stock) : 0,
        desc: desc,
        fullDesc: fullDesc,
        sizes: sizes,
        category: category,
        trending: trending,
        status: status,
        updatedAt: Date.now()
      };
      
      database.ref('products/' + productId).update(updates)
        .then(() => {
          document.getElementById('editProductModal').classList.remove('active');
          loadProducts();
          loadTrendingProducts();
          if (currentAdminTab === 'dashboard') loadDashboardData();
          alert('Product updated successfully!');
        })
        .catch(error => {
          console.error('Error updating product:', error);
          alert('Error updating product: ' + error.message);
        });
    }

    function deleteProduct(productId) {
      if (confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
        database.ref('products/' + productId).remove()
          .then(() => {
            document.getElementById('editProductModal').classList.remove('active');
            loadProducts();
            loadTrendingProducts();
            if (currentAdminTab === 'dashboard') loadDashboardData();
            alert('Product deleted successfully!');
          })
          .catch(error => {
            console.error('Error deleting product:', error);
            alert('Error deleting product: ' + error.message);
          });
      }
    }

    function editSimilarProducts(mainProductId) {
      const similarProductsRef = database.ref('similarProducts');
      const productsRef = database.ref('products');
      
      Promise.all([
        new Promise(resolve => similarProductsRef.child(mainProductId).once('value', snapshot => resolve(snapshot.val()))),
        new Promise(resolve => productsRef.once('value', snapshot => resolve(snapshot.val())))
      ]).then(([similarProducts, productsData]) => {
        let products = [];
        
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        allProductsForSimilar = products;
        
        if (!similarProducts) {
          alert('Similar products not found for this product');
          return;
        }
        
        document.getElementById('editMainProductId').value = mainProductId;
        
        const mainProduct = products.find(p => p.id === mainProductId);
        const editProductInfo = document.getElementById('editProductInfo');
        
        if (mainProduct) {
          const images = mainProduct.images || [];
          const mainImage = images.length > 0 ? images[0] : '';
          
          editProductInfo.innerHTML = `
            <div style="display: flex; align-items: center; gap: 15px;">
              <img src="${mainImage}" width="60" height="60" style="border-radius: 4px; object-fit: cover;" onerror="this.src='https://via.placeholder.com/60'">
              <div>
                <h4 style="margin: 0 0 5px 0;">${mainProduct.title || 'No Name'}</h4>
                <p style="margin: 0; color: #64748b;">${mainProduct.category || 'Uncategorized'} | ₹${mainProduct.price || 0} | Stock: ${mainProduct.stock || 0}</p>
              </div>
            </div>
          `;
        }
        
        const editSimilarProductsSelect = document.getElementById('editSimilarProductsSelect');
        editSimilarProductsSelect.innerHTML = products
          .filter(p => p.id !== mainProductId)
          .map(product => {
            const isSelected = similarProducts.similarProductIds && similarProducts.similarProductIds.includes(product.id);
            return `<option value="${product.id}" ${isSelected ? 'selected' : ''}>${product.title || 'No Name'} (₹${product.price || 0}) - ${product.category || 'Uncategorized'}</option>`;
          }).join('');
        
        updateEditSelectedSimilarProductsPreview();
        
        document.getElementById('editSimilarProductsModal').classList.add('active');
      }).catch(error => {
        console.error('Error loading similar products for edit:', error);
        alert('Error loading similar products: ' + error.message);
      });
    }

    function updateEditSelectedSimilarProductsPreview() {
      const selectElement = document.getElementById('editSimilarProductsSelect');
      const selectedOptions = Array.from(selectElement.selectedOptions);
      const previewDiv = document.getElementById('editSelectedSimilarProductsPreview');
      
      previewDiv.innerHTML = '';
      
      selectedOptions.forEach(option => {
        const productId = option.value;
        const product = allProductsForSimilar.find(p => p.id === productId);
        
        if (product) {
          const images = product.images || [];
          const mainImage = images.length > 0 ? images[0] : '';
          
          const chip = document.createElement('div');
          chip.style.cssText = 'display: inline-flex; align-items: center; gap: 5px; padding: 5px 10px; background: #f1f5f9; border-radius: 30px; margin-right: 5px; margin-bottom: 5px;';
          chip.innerHTML = `
            <img src="${mainImage}" alt="${product.title || 'No Name'}" width="20" height="20" style="border-radius: 50%; object-fit: cover;" onerror="this.src='https://via.placeholder.com/20'">
            <span style="font-size: 12px;">${product.title || 'No Name'}</span>
            <span style="cursor: pointer; color: var(--danger);" onclick="removeFromEditSimilarSelection('${productId}')">&times;</span>
          `;
          previewDiv.appendChild(chip);
        }
      });
    }

    function removeFromEditSimilarSelection(productId) {
      const selectElement = document.getElementById('editSimilarProductsSelect');
      const option = Array.from(selectElement.options).find(opt => opt.value === productId);
      if (option) {
        option.selected = false;
        updateEditSelectedSimilarProductsPreview();
      }
    }

    function updateSimilarProducts() {
      const mainProductId = document.getElementById('editMainProductId').value;
      const editSimilarProductsSelect = document.getElementById('editSimilarProductsSelect');
      const selectedOptions = Array.from(editSimilarProductsSelect.selectedOptions);
      
      const similarProductIds = selectedOptions.map(option => option.value);
      
      if (similarProductIds.includes(mainProductId)) {
        alert('Main product cannot be in similar products list');
        return;
      }
      
      const similarProductsRef = database.ref('similarProducts');
      
      similarProductsRef.child(mainProductId).update({
        similarProductIds: similarProductIds,
        updatedAt: Date.now()
      })
      .then(() => {
        document.getElementById('editSimilarProductsModal').classList.remove('active');
        loadSimilarProducts();
        alert('Similar products updated successfully!');
      })
      .catch(error => {
        console.error('Error updating similar products:', error);
        alert('Error updating similar products: ' + error.message);
      });
    }

    function deleteSimilarProducts(mainProductId) {
      if (confirm('Are you sure you want to delete all similar product links for this product?')) {
        database.ref('similarProducts/' + mainProductId).remove()
          .then(() => {
            loadSimilarProducts();
            alert('Similar products deleted successfully!');
          })
          .catch(error => {
            console.error('Error deleting similar products:', error);
            alert('Error deleting similar products: ' + error.message);
          });
      }
    }

    function editCategory(categoryId) {
      alert('Edit category functionality coming soon!');
    }

    function deleteCategory(categoryId) {
      if (confirm('Are you sure you want to delete this category?')) {
        database.ref('categories/' + categoryId).remove()
          .then(() => {
            allCategories = allCategories.filter(cat => cat.id !== categoryId);
            updateCategoryDropdowns();
            loadCategories();
            alert('Category deleted successfully!');
          })
          .catch(error => {
            console.error('Error deleting category:', error);
            alert('Error deleting category: ' + error.message);
          });
      }
    }

    function editBanner(bannerId) {
      alert('Edit banner functionality coming soon!');
    }

    function deleteBanner(bannerId) {
      if (confirm('Are you sure you want to delete this banner?')) {
        database.ref('banners/' + bannerId).remove()
          .then(() => {
            loadBanners();
            alert('Banner deleted successfully!');
          })
          .catch(error => {
            console.error('Error deleting banner:', error);
            alert('Error deleting banner: ' + error.message);
          });
      }
    }

    function exportOrders() {
      const ordersRef = database.ref('orders');
      const productsRef = database.ref('products');
      
      Promise.all([
        new Promise(resolve => ordersRef.once('value', snapshot => resolve(snapshot.val()))),
        new Promise(resolve => productsRef.once('value', snapshot => resolve(snapshot.val())))
      ]).then(([ordersData, productsData]) => {
        let orders = [];
        let products = [];
        
        if (ordersData) orders = Object.values(ordersData);
        if (productsData) {
          products = Object.entries(productsData).map(([key, value]) => ({
            ...value,
            id: value.id || key
          }));
        }
        
        if (orders.length === 0) {
          alert('No orders to export');
          return;
        }
        
        let csv = 'Order ID,Customer,Mobile,Product,Quantity,Amount,Status,Date\n';
        
        orders.forEach(order => {
          const product = products.find(p => p.id === order.productId);
          const amount = product ? product.price * (order.qty || 1) : 0;
          csv += `"${order.id || 'N/A'}","${order.fullname || 'N/A'}","${order.mobile || 'N/A'}","${product ? product.title : 'Unknown'}","${order.qty || 1}","${amount}","${order.status || 'Pending'}","${order.timestamp ? new Date(order.timestamp).toLocaleDateString() : 'N/A'}"\n`;
        });
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `buyzo_orders_${new Date().toISOString().slice(0, 10)}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }).catch(error => {
        console.error('Error exporting orders:', error);
        alert('Error exporting orders: ' + error.message);
      });
    }

    function exportCustomers() {
      const ordersRef = database.ref('orders');
      ordersRef.once('value', snapshot => {
        const ordersData = snapshot.val();
        let orders = [];
        
        if (ordersData) orders = Object.values(ordersData);
        
        if (orders.length === 0) {
          alert('No customer data to export');
          return;
        }
        
        const customersMap = {};
        orders.forEach(order => {
          if (order.mobile && !customersMap[order.mobile]) {
            customersMap[order.mobile] = {
              name: order.fullname || 'Unknown',
              mobile: order.mobile,
              email: order.email || 'N/A',
              location: `${order.city || ''}, ${order.state || ''}`,
              orderCount: 1
            };
          } else if (order.mobile) {
            customersMap[order.mobile].orderCount++;
          }
        });
        
        const customers = Object.values(customersMap);
        
        let csv = 'Name,Mobile,Email,Location,Orders\n';
        customers.forEach(customer => {
          csv += `"${customer.name}","${customer.mobile}","${customer.email}","${customer.location}","${customer.orderCount}"\n`;
        });
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `buyzo_customers_${new Date().toISOString().slice(0, 10)}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }).catch(error => {
        console.error('Error exporting customers:', error);
        alert('Error exporting customers: ' + error.message);
      });
    }

    function updatePagination(elementId, currentPage, totalPages, type) {
      const pagination = document.getElementById(elementId);
      if (!pagination) return;
      
      if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }
      
      let html = '';
      
      if (currentPage > 1) {
        html += `<div class="page-item" onclick="changePage('${type}', ${currentPage - 1})">&laquo;</div>`;
      }
      
      const startPage = Math.max(1, currentPage - 2);
      const endPage = Math.min(totalPages, startPage + 4);
      
      for (let i = startPage; i <= endPage; i++) {
        html += `<div class="page-item ${i === currentPage ? 'active' : ''}" onclick="changePage('${type}', ${i})">${i}</div>`;
      }
      
      if (currentPage < totalPages) {
        html += `<div class="page-item" onclick="changePage('${type}', ${currentPage + 1})">&raquo;</div>`;
      }
      
      pagination.innerHTML = html;
    }

    function changePage(type, page) {
      if (type === 'products') {
        currentProductsPage = page;
        loadProducts();
      } else if (type === 'orders') {
        currentOrdersPage = page;
        loadOrders();
      } else if (type === 'customers') {
        currentCustomersPage = page;
        loadCustomers();
      } else if (type === 'similar-products') {
        currentSimilarProductsPage = page;
        loadSimilarProducts();
      }
      
      window.scrollTo(0, 0);
    }

    window.addEventListener('DOMContentLoaded', initAdminPanel);
  </script>
</body>
</html>